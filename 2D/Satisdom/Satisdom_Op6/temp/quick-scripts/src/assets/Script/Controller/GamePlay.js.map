{"version":3,"sources":["assets\\Script\\Controller\\GamePlay.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Constants } from \"../Data/constants\";\r\nimport AudioManager from \"../Plugin/AudioManager\";\r\nimport { GameController } from \"./GameController\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GamePlay extends cc.Component {\r\n\r\n  @property(AudioManager)\r\n  AudioManager: AudioManager = null;\r\n  @property(GameController)\r\n  GameController: GameController = null;\r\n\r\n  // Container\r\n  @property(cc.Node)\r\n  Character: cc.Node = null;\r\n  @property(cc.Node)\r\n  UI_Hrz: cc.Node = null;\r\n  @property(cc.Node)\r\n  UI_Vtc: cc.Node = null;\r\n\r\n  // horizontal ---------------------\r\n  // UI\r\n  // @property([cc.Node])\r\n  // knots: cc.Node[] = [];\r\n  @property([cc.Node])\r\n  Ropes: cc.Node[] = [];\r\n  @property([cc.Node])\r\n  hints: cc.Node[] = [];\r\n\r\n  // effect\r\n  @property([cc.ParticleSystem])\r\n  Effects: cc.ParticleSystem[] = [];\r\n  // ---------------------------------\r\n\r\n\r\n  // Vertical ---------------------\r\n  // UI\r\n  // @property([cc.Node])\r\n  // knots_Vtc: cc.Node[] = [];\r\n  @property([cc.Node])\r\n  Ropes_Vtc: cc.Node[] = [];\r\n  @property([cc.Node])\r\n  hints_Vtc: cc.Node[] = [];\r\n\r\n  // effect\r\n  @property([cc.ParticleSystem])\r\n  Effects_Vtc: cc.ParticleSystem[] = [];\r\n  // ---------------------------------\r\n\r\n\r\n  // Character\r\n  @property(cc.Node)\r\n  Ponmi_Roped: cc.Node = null;\r\n  @property(sp.Skeleton)\r\n  Spine_Rope: sp.Skeleton = null;\r\n  @property(cc.Node)\r\n  Pomi_UnRoped: cc.Node = null;\r\n\r\n  // CTA\r\n  @property(cc.Node)\r\n  CTA: cc.Node = null;\r\n  @property(cc.Node)\r\n  CTA_overlay: cc.Node = null;\r\n  @property(cc.Node)\r\n  CTA_btn: cc.Node = null;\r\n\r\n\r\n  step1Flag: boolean = false;\r\n  step2Flag: boolean = false;\r\n\r\n  protected onLoad(): void {\r\n    cc.director.getPhysicsManager().enabled = true;\r\n    let collisionManager = cc.director.getCollisionManager();\r\n    collisionManager.enabled = true;\r\n    // collisionManager.enabledDrawBoundingBox = true;\r\n    // collisionManager.enabledDebugDraw = true;\r\n\r\n    this.initGame();\r\n  };\r\n\r\n\r\n  private initGame(): void {\r\n    this.Pomi_UnRoped.active = false;\r\n    this.hints.forEach(hint => hint.active = false);\r\n    this.hints_Vtc.forEach(hint => hint.active = false);\r\n    this.CTA.active = false;\r\n  };\r\n\r\n\r\n  protected start(): void {\r\n    this.handleGamePlay();\r\n    // this.AudioManager.playSound(Constants.SoundTrack.bgSound);\r\n  }\r\n\r\n\r\n  private handleGamePlay(): void {\r\n    this.hints[0].active = true;\r\n    this.hints_Vtc[0].active = true;\r\n  }\r\n\r\n\r\n  private showCTA(): void {\r\n    this.CTA.active = true;\r\n    this.CTA_btn.on(cc.Node.EventType.TOUCH_START, this.GameController.installHandle, this);\r\n\r\n    // mtg & applovin\r\n    this.CTA_overlay.on(cc.Node.EventType.TOUCH_START, this.GameController.installHandle, this);\r\n  }\r\n\r\n\r\n  private checkStep(): void {\r\n    switch (Constants.step) {\r\n      case 1:\r\n        this.step1Flag = true;\r\n        this.hints[0].active = false;\r\n        this.hints_Vtc[0].active = false;\r\n        this.scheduleOnce(() => {\r\n          this.Ropes[0].getComponent(cc.Animation).play(\"Rope_BackAnim\");\r\n          this.Ropes_Vtc[0].getComponent(cc.Animation).play(\"Rope_BackAnim\");\r\n        }, 0.5)\r\n\r\n        this.scheduleOnce(() => {\r\n          this.Effects[0].resetSystem();\r\n          this.Effects_Vtc[0].resetSystem();\r\n          this.AudioManager.playSound(Constants.SoundTrack.completeSound);\r\n        }, 1)\r\n\r\n        this.scheduleOnce(() => {\r\n          this.Spine_Rope.setAnimation(0, \"break\", false);\r\n          this.AudioManager.playSound(Constants.SoundTrack.breakRopeSound);\r\n          this.hints[2].active = true;\r\n          this.hints[1].active = false;\r\n\r\n          this.hints_Vtc[2].active = true;\r\n          this.hints_Vtc[1].active = false;\r\n        }, 1.5);\r\n        break;\r\n      case 2:\r\n        this.step2Flag = true;\r\n        this.hints[2].active = false;\r\n        this.hints[1].active = false;\r\n        this.hints_Vtc[2].active = false;\r\n        this.hints_Vtc[1].active = false;\r\n        this.scheduleOnce(() => {\r\n          this.Ropes[1].getComponent(cc.Animation).play(\"Rope_BackAnim\");\r\n          this.Ropes[2].getComponent(cc.Animation).play(\"Rope_BackAnim\");\r\n          this.Ropes_Vtc[1].getComponent(cc.Animation).play(\"Rope_BackAnim\");\r\n          this.Ropes_Vtc[2].getComponent(cc.Animation).play(\"Rope_BackAnim\");\r\n        }, 0.5)\r\n\r\n        this.scheduleOnce(() => {\r\n          this.Effects[0].resetSystem();\r\n          this.Effects[1].resetSystem();\r\n          this.Effects_Vtc[0].resetSystem();\r\n          this.Effects_Vtc[1].resetSystem();\r\n          this.AudioManager.playSound(Constants.SoundTrack.completeSound2);\r\n        }, 1)\r\n\r\n        this.scheduleOnce(() => {\r\n          this.Ponmi_Roped.active = false;\r\n          this.Pomi_UnRoped.active = true;\r\n        }, 1.5);\r\n        this.scheduleOnce(() => {\r\n          this.showCTA();\r\n        }, 2.5)\r\n        break;\r\n      case 3:\r\n        this.GameController.installHandle();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    Constants.step = Constants.step + 1;\r\n  }\r\n\r\n\r\n  protected update(dt: number): void {\r\n    Constants.isCollideKnot1 && !this.step1Flag && this.checkStep();\r\n    Constants.isCollideKnot2 && !this.step2Flag && this.checkStep();\r\n  }\r\n\r\n}\r\n"]}