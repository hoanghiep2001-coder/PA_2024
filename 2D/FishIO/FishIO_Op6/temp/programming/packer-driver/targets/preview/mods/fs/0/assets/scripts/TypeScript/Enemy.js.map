{"version":3,"sources":["file:///D:/PA_2023/2D/FishIO/FishIO_Op6/assets/scripts/TypeScript/Enemy.ts"],"names":["_decorator","Component","Node","Animation","RigidBody2D","Vec2","Vec3","math","sp","tween","toDegree","CircleCollider2D","EnemiesController","Constants","ccclass","property","Enemy","start","originalPosition","node","getPosition","parent","getComponent","GameController","getChildByName","playerController","touchArea","isLive","spine","Skeleton","callBack","schedule","animation","isIdle","random","Math","round","timeScale","console","log","die","body","linearVelocity","radius","play","isAte","to","scale","scheduleOnce","active","destroy","handleFishUI","handleFishAngle","handleFishMovement","angleFish","atan","y","x","angle","setScale","lerpRatio","playerPos","Player_Mouth","currentCameraPos","position","newPosition","lerp","setPosition","isPlayGame","name","startsWith","direction","subtract","normalize","velocity","multiplyScalar","clearFix","isLevelUp","isScaleDownLv2","update","dt"],"mappings":"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","sourcesContent":["import EnemiesController from \"../Controller/EnemiesController\";\r\nimport { Constants } from \"../Data/Constant\";\r\n\r\nimport { _decorator, Component, Node, Prefab,Animation, instantiate, RigidBody2D, Vec2, Vec3, toRadian, math, Skeleton, sp, tween, toDegree, CircleCollider2D } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass\r\nexport default class Enemy extends Component {\r\n\r\n    @property(RigidBody2D)\r\n    body: RigidBody2D = null;\r\n    @property(Node)\r\n    Level: Node = null;\r\n    \r\n    EnemiesController: EnemiesController = null;\r\n\r\n    GameController: Component = null;\r\n    playerController: Node = null;\r\n    touchArea: Node = null;\r\n\r\n    isAte: boolean = false;\r\n    isScaleDownLv2: boolean = false;\r\n    isLive: boolean = false;\r\n    isIdle: boolean = false;\r\n\r\n    randomChangeSpeed: number = 3;\r\n    maxSpeed: number = 1;\r\n    randomVecX: number = 0;\r\n    randomVecY: number = 0;\r\n    \r\n    originalPosition: Vec3;\r\n    moveAmount: number = 3;\r\n    moveDirection: number = 1;\r\n    moveTimer: number = 0;\r\n    moveInterval: number = 0.5;\r\n\r\n\r\n    protected start(): void {\r\n        this.originalPosition = this.node.getPosition();\r\n        this.EnemiesController = this.node.parent.getComponent(EnemiesController);\r\n        this.GameController = this.node.parent.parent.parent.parent.getChildByName(\"GameController\").getComponent(\"GameController\");       \r\n        this.playerController = this.node.parent.parent.getChildByName(\"Player\");\r\n        this.touchArea = this.node.parent.parent.parent.parent.getChildByName(\"TouchArea\");\r\n        this.isLive = true;\r\n        let spine = this.node\r\n            .getChildByName(\"Body\")\r\n            .getChildByName(\"Spine_Fish\")\r\n            .getComponent(sp.Skeleton);\r\n        this.callBack(spine);\r\n        this.schedule(() => {\r\n            this.callBack(spine);\r\n        }, 5);\r\n    }\r\n\r\n\r\n    private callBack(spine: sp.Skeleton): void {\r\n        spine.animation === \"animation\" || spine.animation === \"idle\"\r\n            ? this.isIdle = true\r\n            : this.isIdle = false;\r\n        let random = Math.round(Math.random() * 5) + 1;\r\n        this.isIdle ? spine.timeScale = random : console.log(\"\");\r\n    };\r\n\r\n\r\n    public die() {\r\n        this.body.linearVelocity = new math.Vec2(0, 0);\r\n        this.getComponent(CircleCollider2D).radius = 0;\r\n        this.node.getComponent(Animation).play(\"Enemy_DieAnim\");\r\n        this.isAte = true;\r\n        \r\n        tween(this.node)\r\n        .to(0.02, {scale: new Vec3(0.6, 0.6, 0.6)})\r\n        .start();\r\n\r\n        this.scheduleOnce(() => {\r\n            this.isAte = false;\r\n            this.node.getChildByName(\"Body\").active = false;            \r\n        }, 0.2)\r\n\r\n        this.scheduleOnce(() => {\r\n            this.isLive = false;\r\n            this.node.destroy();\r\n        }, 1);\r\n    }\r\n\r\n\r\n    private handleFishUI(): void {\r\n        this.handleFishAngle();\r\n        this.handleFishMovement();\r\n    }\r\n\r\n\r\n    private handleFishAngle(): void {\r\n        var angleFish =\r\n            toDegree(Math.atan(\r\n                (this.playerController.getPosition().y - this.node.getPosition().y) \r\n                / (this.playerController.getPosition().x - this.node.getPosition().x)\r\n            ));\r\n        this.node.getChildByName(\"Body\").angle = angleFish;\r\n\r\n        if ((this.node.getPosition().x - this.playerController.getPosition().x) > 0) {\r\n            this.node.getChildByName(\"Body\").setScale(new math.Vec3(1, 1, 0));\r\n        } else {\r\n            this.node.getChildByName(\"Body\").setScale(new math.Vec3(-1, 1, 0));\r\n        }\r\n    }\r\n\r\n\r\n    private handleFishMovement(): void {\r\n        if (this.isAte) {\r\n             if(this.getComponent(RigidBody2D)) {\r\n                this.body.destroy();\r\n             }\r\n            const lerpRatio = 0.012; \r\n            const playerPos = this.playerController.getComponent(\"PlayerController\").Player_Mouth.getPosition();\r\n            const currentCameraPos = this.node.position;\r\n    \r\n            const newPosition = new Vec3();\r\n            Vec3.lerp(\r\n                newPosition,\r\n                currentCameraPos,\r\n                new Vec3(playerPos.x, playerPos.y, 0),\r\n                lerpRatio);\r\n            this.node.setPosition(newPosition);\r\n            \r\n            return;\r\n        }\r\n\r\n        if (\r\n            !this.playerController.getComponent(\"PlayerController\").isLive) {\r\n                this.body.linearVelocity = new Vec2(0,0);\r\n                return;\r\n        }\r\n\r\n        if (!Constants.isPlayGame) {\r\n            return;\r\n        }\r\n\r\n        if (this.node.name.startsWith(\"Enemy3_\")) {\r\n            return;\r\n        }\r\n\r\n        if (this.node.name === \"Enemy2_1\" \r\n        || this.node.name === \"Enemy2_28\" \r\n        || this.node.name === \"Enemy2_13\"\r\n        || this.node.name === \"Enemy2_10\"\r\n        || this.node.name === \"Enemy2_12\"\r\n        || this.node.name === \"Enemy2_20\"\r\n        || this.node.name === \"Enemy2_21\"\r\n        ) {\r\n            const direction = this.playerController.getPosition().subtract(this.node.getPosition()).normalize();\r\n            let velocity = direction.multiplyScalar(2.3);\r\n            let clearFix = new math.Vec2(velocity.x, velocity.y);\r\n            this.body.linearVelocity = clearFix;\r\n            return;\r\n        }\r\n        \r\n        \r\n        if (this.node.name.startsWith(\"Enemy2_\")) {\r\n            if (!this.playerController.getComponent(\"PlayerController\").isLevelUp) {\r\n                this.body.linearVelocity = new Vec2(0,0);\r\n                return;\r\n            }\r\n        }\r\n        \r\n\r\n        if (this.node.name.startsWith(\"Enemy1_\") && this.isScaleDownLv2) {\r\n            this.body.linearVelocity = new Vec2(0,0);\r\n            return;\r\n        }\r\n        \r\n\r\n        const direction = this.playerController.getPosition().subtract(this.node.getPosition()).normalize();\r\n        let velocity = direction.multiplyScalar(0.5)\r\n        let clearFix = new math.Vec2(velocity.x, velocity.y);\r\n        this.body.linearVelocity = clearFix;\r\n    }\r\n\r\n\r\n    protected update(dt: number): void {\r\n        this.handleFishUI();\r\n    }\r\n\r\n}\r\n"]}