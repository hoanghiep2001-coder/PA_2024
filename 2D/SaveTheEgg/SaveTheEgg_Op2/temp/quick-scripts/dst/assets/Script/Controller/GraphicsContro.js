
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Controller/GraphicsContro.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '93044ZctVJBYpcfVaP3IJVr', 'GraphicsContro');
// Script/Controller/GraphicsContro.js

"use strict";

var _StateForJS = require("../Data/StateForJS");

cc.Class({
  "extends": cc.Component,
  properties: {
    graphics: null,
    line_point: [cc.Vec2]
  },
  onLoad: function onLoad() {
    this.node.width = 5000;
    this.node.height = 5000;
    this.graphics = this.getComponent(cc.Graphics);
  },
  start: function start() {
    window.PointPos = cc.v2(-50, 100);
    this.onTouch();
  },
  onTouch: function onTouch() {
    this.node.on(cc.Node.EventType.TOUCH_START, this.touch_start, this);
    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touch_move, this);
    this.node.on(cc.Node.EventType.TOUCH_END, this.touch_end, this);
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touch_end, this);
  },
  offTouch: function offTouch() {
    this.node.off(cc.Node.EventType.TOUCH_START);
    this.node.off(cc.Node.EventType.TOUCH_MOVE);
    this.node.off(cc.Node.EventType.TOUCH_END);
    this.node.off(cc.Node.EventType.TOUCH_CANCEL);
  },
  touch_start: function touch_start(event) {
    if (!_StateForJS.StateForJs.isCanDraw) {
      return;
    }

    var pos = this.node.convertToNodeSpaceAR(event.getLocation());
    window.isStartDraw = true;
    window.PointPos = pos;
    this.graphics.moveTo(pos.x, pos.y);
    this.line_point.push(cc.v2(pos.x, pos.y));
  },
  touch_move: function touch_move(event) {
    if (!_StateForJS.StateForJs.isCanDraw) {
      return;
    }

    var pos = this.node.convertToNodeSpaceAR(event.getLocation());
    window.PointPos = pos;
    this.graphics.lineTo(pos.x, pos.y);
    this.line_point.push(cc.v2(pos.x, pos.y));
    this.updateStrokeColor();
    this.graphics.stroke();
  },
  touch_end: function touch_end(event) {
    if (window.isTouchWall) {
      _StateForJS.StateForJs.isCanDraw = true;
      window.isTouchWall = false;
      this.line_point = [];
      this.graphics.clear();
      return;
    }

    if (!_StateForJS.StateForJs.isCanDraw) {
      return;
    } // Rút gọn đường vẽ


    var simplifiedPoints = this.simplifyPath(this.line_point, 2); // Sử dụng độ tolerance phù hợp

    _StateForJS.StateForJs.isCanDraw = false;
    window.isDraw = true;
    window.isTouchWall = false;
    this.createRigibody(simplifiedPoints);
    this.offTouch();
  },
  updateStrokeColor: function updateStrokeColor() {
    if (window.isTouchWall) {
      this.graphics.strokeColor = cc.Color.RED;
    } else {
      this.graphics.strokeColor = cc.Color.BLACK;
    }
  },
  createRigibody: function createRigibody(simplifiedPoints) {
    this.rigibodyLogic = this.addComponent(cc.RigidBody);
    this.rigibodyLogic.gravityScale = 2;
    this.physicsLine = this.addComponent("MyPhysicsCollider");
    this.physicsLine.lineWidth = 7;
    this.physicsLine.points = simplifiedPoints; // Sử dụng điểm đã rút gọn

    this.physicsLine.friction = 0;
    this.physicsLine.density = 100;
    this.physicsLine.tag = 4;
    this.physicsLine.apply();
  },
  checkStraightLine: function checkStraightLine(touchPoints) {
    if (touchPoints.length < 3) {
      return false;
    }

    var A = touchPoints[touchPoints.length - 3];
    var B = touchPoints[touchPoints.length - 2];
    var C = touchPoints[touchPoints.length - 1];
    return (B.x - A.x) * (C.y - A.y) === (B.y - A.y) * (C.x - A.x);
  },
  simplifyPath: function simplifyPath(points, tolerance) {
    if (points.length < 3) return points;
    var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;
    points = this.simplifyDouglasPeucker(points, sqTolerance);
    return points;
  },
  simplifyDouglasPeucker: function simplifyDouglasPeucker(points, sqTolerance) {
    var len = points.length,
        ArrayConstructor = typeof Uint8Array !== 'undefined' ? Uint8Array : Array,
        markers = new ArrayConstructor(len),
        first = 0,
        last = len - 1,
        stack = [],
        newPoints = [],
        i,
        maxSqDist,
        sqDist,
        index;
    markers[first] = markers[last] = 1;

    while (last) {
      maxSqDist = 0;

      for (i = first + 1; i < last; i++) {
        sqDist = this.getSqSegDist(points[i], points[first], points[last]);

        if (sqDist > maxSqDist) {
          index = i;
          maxSqDist = sqDist;
        }
      }

      if (maxSqDist > sqTolerance) {
        markers[index] = 1;
        stack.push(first, index, index, last);
      }

      last = stack.pop();
      first = stack.pop();
    }

    for (i = 0; i < len; i++) {
      if (markers[i]) {
        newPoints.push(points[i]);
      }
    }

    return newPoints;
  },
  getSqSegDist: function getSqSegDist(p, p1, p2) {
    var x = p1.x,
        y = p1.y,
        dx = p2.x - x,
        dy = p2.y - y;

    if (dx !== 0 || dy !== 0) {
      var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);

      if (t > 1) {
        x = p2.x;
        y = p2.y;
      } else if (t > 0) {
        x += dx * t;
        y += dy * t;
      }
    }

    dx = p.x - x;
    dy = p.y - y;
    return dx * dx + dy * dy;
  },
  checkIsCanDraw: function checkIsCanDraw(lastPoint, nowPoint) {
    return lastPoint.sub(nowPoint).mag() >= 20;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxDb250cm9sbGVyXFxHcmFwaGljc0NvbnRyby5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImdyYXBoaWNzIiwibGluZV9wb2ludCIsIlZlYzIiLCJvbkxvYWQiLCJub2RlIiwid2lkdGgiLCJoZWlnaHQiLCJnZXRDb21wb25lbnQiLCJHcmFwaGljcyIsInN0YXJ0Iiwid2luZG93IiwiUG9pbnRQb3MiLCJ2MiIsIm9uVG91Y2giLCJvbiIsIk5vZGUiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsInRvdWNoX3N0YXJ0IiwiVE9VQ0hfTU9WRSIsInRvdWNoX21vdmUiLCJUT1VDSF9FTkQiLCJ0b3VjaF9lbmQiLCJUT1VDSF9DQU5DRUwiLCJvZmZUb3VjaCIsIm9mZiIsImV2ZW50IiwiU3RhdGVGb3JKcyIsImlzQ2FuRHJhdyIsInBvcyIsImNvbnZlcnRUb05vZGVTcGFjZUFSIiwiZ2V0TG9jYXRpb24iLCJpc1N0YXJ0RHJhdyIsIm1vdmVUbyIsIngiLCJ5IiwicHVzaCIsImxpbmVUbyIsInVwZGF0ZVN0cm9rZUNvbG9yIiwic3Ryb2tlIiwiaXNUb3VjaFdhbGwiLCJjbGVhciIsInNpbXBsaWZpZWRQb2ludHMiLCJzaW1wbGlmeVBhdGgiLCJpc0RyYXciLCJjcmVhdGVSaWdpYm9keSIsInN0cm9rZUNvbG9yIiwiQ29sb3IiLCJSRUQiLCJCTEFDSyIsInJpZ2lib2R5TG9naWMiLCJhZGRDb21wb25lbnQiLCJSaWdpZEJvZHkiLCJncmF2aXR5U2NhbGUiLCJwaHlzaWNzTGluZSIsImxpbmVXaWR0aCIsInBvaW50cyIsImZyaWN0aW9uIiwiZGVuc2l0eSIsInRhZyIsImFwcGx5IiwiY2hlY2tTdHJhaWdodExpbmUiLCJ0b3VjaFBvaW50cyIsImxlbmd0aCIsIkEiLCJCIiwiQyIsInRvbGVyYW5jZSIsInNxVG9sZXJhbmNlIiwidW5kZWZpbmVkIiwic2ltcGxpZnlEb3VnbGFzUGV1Y2tlciIsImxlbiIsIkFycmF5Q29uc3RydWN0b3IiLCJVaW50OEFycmF5IiwiQXJyYXkiLCJtYXJrZXJzIiwiZmlyc3QiLCJsYXN0Iiwic3RhY2siLCJuZXdQb2ludHMiLCJpIiwibWF4U3FEaXN0Iiwic3FEaXN0IiwiaW5kZXgiLCJnZXRTcVNlZ0Rpc3QiLCJwb3AiLCJwIiwicDEiLCJwMiIsImR4IiwiZHkiLCJ0IiwiY2hlY2tJc0NhbkRyYXciLCJsYXN0UG9pbnQiLCJub3dQb2ludCIsInN1YiIsIm1hZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLFFBQVEsRUFBRSxJQURGO0FBRVJDLElBQUFBLFVBQVUsRUFBRSxDQUFDTCxFQUFFLENBQUNNLElBQUo7QUFGSixHQUhQO0FBUUxDLEVBQUFBLE1BUkssb0JBUUk7QUFDTCxTQUFLQyxJQUFMLENBQVVDLEtBQVYsR0FBa0IsSUFBbEI7QUFDQSxTQUFLRCxJQUFMLENBQVVFLE1BQVYsR0FBbUIsSUFBbkI7QUFDQSxTQUFLTixRQUFMLEdBQWdCLEtBQUtPLFlBQUwsQ0FBa0JYLEVBQUUsQ0FBQ1ksUUFBckIsQ0FBaEI7QUFDSCxHQVpJO0FBY0xDLEVBQUFBLEtBZEssbUJBY0c7QUFDSkMsSUFBQUEsTUFBTSxDQUFDQyxRQUFQLEdBQWtCZixFQUFFLENBQUNnQixFQUFILENBQU0sQ0FBQyxFQUFQLEVBQVcsR0FBWCxDQUFsQjtBQUNBLFNBQUtDLE9BQUw7QUFDSCxHQWpCSTtBQW1CTEEsRUFBQUEsT0FuQksscUJBbUJLO0FBQ04sU0FBS1QsSUFBTCxDQUFVVSxFQUFWLENBQWFsQixFQUFFLENBQUNtQixJQUFILENBQVFDLFNBQVIsQ0FBa0JDLFdBQS9CLEVBQTRDLEtBQUtDLFdBQWpELEVBQThELElBQTlEO0FBQ0EsU0FBS2QsSUFBTCxDQUFVVSxFQUFWLENBQWFsQixFQUFFLENB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UHpELFFBQUFBLENBQUMsR0FBR3NELEVBQUUsQ0FBQ3RELENBQVA7QUFDQUMsUUFBQUEsQ0FBQyxHQUFHcUQsRUFBRSxDQUFDckQsQ0FBUDtBQUNILE9BSEQsTUFHTyxJQUFJd0QsQ0FBQyxHQUFHLENBQVIsRUFBVztBQUNkekQsUUFBQUEsQ0FBQyxJQUFJdUQsRUFBRSxHQUFHRSxDQUFWO0FBQ0F4RCxRQUFBQSxDQUFDLElBQUl1RCxFQUFFLEdBQUdDLENBQVY7QUFDSDtBQUNKOztBQUVERixJQUFBQSxFQUFFLEdBQUdILENBQUMsQ0FBQ3BELENBQUYsR0FBTUEsQ0FBWDtBQUNBd0QsSUFBQUEsRUFBRSxHQUFHSixDQUFDLENBQUNuRCxDQUFGLEdBQU1BLENBQVg7QUFFQSxXQUFPc0QsRUFBRSxHQUFHQSxFQUFMLEdBQVVDLEVBQUUsR0FBR0EsRUFBdEI7QUFDSCxHQTVMSTtBQThMTEUsRUFBQUEsY0E5TEssMEJBOExVQyxTQTlMVixFQThMcUJDLFFBOUxyQixFQThMK0I7QUFDaEMsV0FBT0QsU0FBUyxDQUFDRSxHQUFWLENBQWNELFFBQWQsRUFBd0JFLEdBQXhCLE1BQWlDLEVBQXhDO0FBQ0g7QUFoTUksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RhdGVGb3JKcyB9IGZyb20gXCIuLi9EYXRhL1N0YXRlRm9ySlNcIjtcclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBncmFwaGljczogbnVsbCxcclxuICAgICAgICBsaW5lX3BvaW50OiBbY2MuVmVjMl0sXHJcbiAgICB9LFxyXG5cclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICB0aGlzLm5vZGUud2lkdGggPSA1MDAwO1xyXG4gICAgICAgIHRoaXMubm9kZS5oZWlnaHQgPSA1MDAwO1xyXG4gICAgICAgIHRoaXMuZ3JhcGhpY3MgPSB0aGlzLmdldENvbXBvbmVudChjYy5HcmFwaGljcyk7XHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIHdpbmRvdy5Qb2ludFBvcyA9IGNjLnYyKC01MCwgMTAwKTtcclxuICAgICAgICB0aGlzLm9uVG91Y2goKTtcclxuICAgIH0sXHJcbiAgICBcclxuICAgIG9uVG91Y2goKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCB0aGlzLnRvdWNoX3N0YXJ0LCB0aGlzKTtcclxuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfTU9WRSwgdGhpcy50b3VjaF9tb3ZlLCB0aGlzKTtcclxuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLnRvdWNoX2VuZCwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTCwgdGhpcy50b3VjaF9lbmQsIHRoaXMpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvZmZUb3VjaCgpIHtcclxuICAgICAgICB0aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJUKTtcclxuICAgICAgICB0aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUpO1xyXG4gICAgICAgIHRoaXMubm9kZS5vZmYoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5EKTtcclxuICAgICAgICB0aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHRvdWNoX3N0YXJ0KGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKCFTdGF0ZUZvckpzLmlzQ2FuRHJhdykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcG9zID0gdGhpcy5ub2RlLmNvbnZlcnRUb05vZGVTcGFjZUFSKGV2ZW50LmdldExvY2F0aW9uKCkpO1xyXG4gICAgICAgIHdpbmRvdy5pc1N0YXJ0RHJhdyA9IHRydWU7XHJcbiAgICAgICAgd2luZG93LlBvaW50UG9zID0gcG9zO1xyXG4gICAgICAgIHRoaXMuZ3JhcGhpY3MubW92ZVRvKHBvcy54LCBwb3MueSk7XHJcbiAgICAgICAgdGhpcy5saW5lX3BvaW50LnB1c2goY2MudjIocG9zLngsIHBvcy55KSk7XHJcbiAgICB9LFxyXG5cclxuICAgIHRvdWNoX21vdmUoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIVN0YXRlRm9ySnMuaXNDYW5EcmF3KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBwb3MgPSB0aGlzLm5vZGUuY29udmVydFRvTm9kZVNwYWNlQVIoZXZlbnQuZ2V0TG9jYXRpb24oKSk7XHJcbiAgICAgICAgd2luZG93LlBvaW50UG9zID0gcG9zO1xyXG4gICAgICAgIHRoaXMuZ3JhcGhpY3MubGluZVRvKHBvcy54LCBwb3MueSk7XHJcbiAgICAgICAgdGhpcy5saW5lX3BvaW50LnB1c2goY2MudjIocG9zLngsIHBvcy55KSk7XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlU3Ryb2tlQ29sb3IoKTtcclxuICAgICAgICB0aGlzLmdyYXBoaWNzLnN0cm9rZSgpO1xyXG4gICAgfSxcclxuXHJcbiAgICB0b3VjaF9lbmQoZXZlbnQpIHtcclxuICAgICAgICBpZiAod2luZG93LmlzVG91Y2hXYWxsKSB7XHJcbiAgICAgICAgICAgIFN0YXRlRm9ySnMuaXNDYW5EcmF3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgd2luZG93LmlzVG91Y2hXYWxsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubGluZV9wb2ludCA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLmdyYXBoaWNzLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghU3RhdGVGb3JKcy5pc0NhbkRyYXcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUsO6dCBn4buNbiDEkcaw4budbmcgduG6vVxyXG4gICAgICAgIGxldCBzaW1wbGlmaWVkUG9pbnRzID0gdGhpcy5zaW1wbGlmeVBhdGgodGhpcy5saW5lX3BvaW50LCAyKTsgIC8vIFPhu60gZOG7pW5nIMSR4buZIHRvbGVyYW5jZSBwaMO5IGjhu6NwXHJcblxyXG4gICAgICAgIFN0YXRlRm9ySnMuaXNDYW5EcmF3ID0gZmFsc2U7XHJcbiAgICAgICAgd2luZG93LmlzRHJhdyA9IHRydWU7XHJcbiAgICAgICAgd2luZG93LmlzVG91Y2hXYWxsID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVSaWdpYm9keShzaW1wbGlmaWVkUG9pbnRzKTtcclxuICAgICAgICB0aGlzLm9mZlRvdWNoKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZVN0cm9rZUNvbG9yKCkge1xyXG4gICAgICAgIGlmICh3aW5kb3cuaXNUb3VjaFdhbGwpIHtcclxuICAgICAgICAgICAgdGhpcy5ncmFwaGljcy5zdHJva2VDb2xvciA9IGNjLkNvbG9yLlJFRDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmdyYXBoaWNzLnN0cm9rZUNvbG9yID0gY2MuQ29sb3IuQkxBQ0s7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBjcmVhdGVSaWdpYm9keShzaW1wbGlmaWVkUG9pbnRzKSB7XHJcbiAgICAgICAgdGhpcy5yaWdpYm9keUxvZ2ljID0gdGhpcy5hZGRDb21wb25lbnQoY2MuUmlnaWRCb2R5KTtcclxuICAgICAgICB0aGlzLnJpZ2lib2R5TG9naWMuZ3Jhdml0eVNjYWxlID0gMjtcclxuXHJcbiAgICAgICAgdGhpcy5waHlzaWNzTGluZSA9IHRoaXMuYWRkQ29tcG9uZW50KFwiTXlQaHlzaWNzQ29sbGlkZXJcIik7XHJcbiAgICAgICAgdGhpcy5waHlzaWNzTGluZS5saW5lV2lkdGggPSA3O1xyXG4gICAgICAgIHRoaXMucGh5c2ljc0xpbmUucG9pbnRzID0gc2ltcGxpZmllZFBvaW50czsgIC8vIFPhu60gZOG7pW5nIMSRaeG7g20gxJHDoyByw7p0IGfhu41uXHJcbiAgICAgICAgdGhpcy5waHlzaWNzTGluZS5mcmljdGlvbiA9IDA7XHJcbiAgICAgICAgdGhpcy5waHlzaWNzTGluZS5kZW5zaXR5ID0gMTAwO1xyXG4gICAgICAgIHRoaXMucGh5c2ljc0xpbmUudGFnID0gNDtcclxuICAgICAgICB0aGlzLnBoeXNpY3NMaW5lLmFwcGx5KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGNoZWNrU3RyYWlnaHRMaW5lKHRvdWNoUG9pbnRzKSB7XHJcbiAgICAgICAgaWYgKHRvdWNoUG9pbnRzLmxlbmd0aCA8IDMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IEEgPSB0b3VjaFBvaW50c1t0b3VjaFBvaW50cy5sZW5ndGggLSAzXTtcclxuICAgICAgICBsZXQgQiA9IHRvdWNoUG9pbnRzW3RvdWNoUG9pbnRzLmxlbmd0aCAtIDJdO1xyXG4gICAgICAgIGxldCBDID0gdG91Y2hQb2ludHNbdG91Y2hQb2ludHMubGVuZ3RoIC0gMV07XHJcblxyXG4gICAgICAgIHJldHVybiAoQi54IC0gQS54KSAqIChDLnkgLSBBLnkpID09PSAoQi55IC0gQS55KSAqIChDLnggLSBBLngpO1xyXG4gICAgfSxcclxuXHJcbiAgICBzaW1wbGlmeVBhdGgocG9pbnRzLCB0b2xlcmFuY2UpIHtcclxuICAgICAgICBpZiAocG9pbnRzLmxlbmd0aCA8IDMpIHJldHVybiBwb2ludHM7XHJcblxyXG4gICAgICAgIGxldCBzcVRvbGVyYW5jZSA9IHRvbGVyYW5jZSAhPT0gdW5kZWZpbmVkID8gdG9sZXJhbmNlICogdG9sZXJhbmNlIDogMTtcclxuICAgICAgICBwb2ludHMgPSB0aGlzLnNpbXBsaWZ5RG91Z2xhc1BldWNrZXIocG9pbnRzLCBzcVRvbGVyYW5jZSk7XHJcblxyXG4gICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICB9LFxyXG5cclxuICAgIHNpbXBsaWZ5RG91Z2xhc1BldWNrZXIocG9pbnRzLCBzcVRvbGVyYW5jZSkge1xyXG4gICAgICAgIGxldCBsZW4gPSBwb2ludHMubGVuZ3RoLFxyXG4gICAgICAgICAgICBBcnJheUNvbnN0cnVjdG9yID0gdHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnID8gVWludDhBcnJheSA6IEFycmF5LFxyXG4gICAgICAgICAgICBtYXJrZXJzID0gbmV3IEFycmF5Q29uc3RydWN0b3IobGVuKSxcclxuICAgICAgICAgICAgZmlyc3QgPSAwLFxyXG4gICAgICAgICAgICBsYXN0ID0gbGVuIC0gMSxcclxuICAgICAgICAgICAgc3RhY2sgPSBbXSxcclxuICAgICAgICAgICAgbmV3UG9pbnRzID0gW10sXHJcbiAgICAgICAgICAgIGksIG1heFNxRGlzdCwgc3FEaXN0LCBpbmRleDtcclxuXHJcbiAgICAgICAgbWFya2Vyc1tmaXJzdF0gPSBtYXJrZXJzW2xhc3RdID0gMTtcclxuXHJcbiAgICAgICAgd2hpbGUgKGxhc3QpIHtcclxuICAgICAgICAgICAgbWF4U3FEaXN0ID0gMDtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaSA9IGZpcnN0ICsgMTsgaSA8IGxhc3Q7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgc3FEaXN0ID0gdGhpcy5nZXRTcVNlZ0Rpc3QocG9pbnRzW2ldLCBwb2ludHNbZmlyc3RdLCBwb2ludHNbbGFzdF0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzcURpc3QgPiBtYXhTcURpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4U3FEaXN0ID0gc3FEaXN0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobWF4U3FEaXN0ID4gc3FUb2xlcmFuY2UpIHtcclxuICAgICAgICAgICAgICAgIG1hcmtlcnNbaW5kZXhdID0gMTtcclxuICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goZmlyc3QsIGluZGV4LCBpbmRleCwgbGFzdCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxhc3QgPSBzdGFjay5wb3AoKTtcclxuICAgICAgICAgICAgZmlyc3QgPSBzdGFjay5wb3AoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBpZiAobWFya2Vyc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgbmV3UG9pbnRzLnB1c2gocG9pbnRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld1BvaW50cztcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0U3FTZWdEaXN0KHAsIHAxLCBwMikge1xyXG4gICAgICAgIGxldCB4ID0gcDEueCxcclxuICAgICAgICAgICAgeSA9IHAxLnksXHJcbiAgICAgICAgICAgIGR4ID0gcDIueCAtIHgsXHJcbiAgICAgICAgICAgIGR5ID0gcDIueSAtIHk7XHJcblxyXG4gICAgICAgIGlmIChkeCAhPT0gMCB8fCBkeSAhPT0gMCkge1xyXG4gICAgICAgICAgICBsZXQgdCA9ICgocC54IC0geCkgKiBkeCArIChwLnkgLSB5KSAqIGR5KSAvIChkeCAqIGR4ICsgZHkgKiBkeSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHggPSBwMi54O1xyXG4gICAgICAgICAgICAgICAgeSA9IHAyLnk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHggKz0gZHggKiB0O1xyXG4gICAgICAgICAgICAgICAgeSArPSBkeSAqIHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGR4ID0gcC54IC0geDtcclxuICAgICAgICBkeSA9IHAueSAtIHk7XHJcblxyXG4gICAgICAgIHJldHVybiBkeCAqIGR4ICsgZHkgKiBkeTtcclxuICAgIH0sXHJcblxyXG4gICAgY2hlY2tJc0NhbkRyYXcobGFzdFBvaW50LCBub3dQb2ludCkge1xyXG4gICAgICAgIHJldHVybiBsYXN0UG9pbnQuc3ViKG5vd1BvaW50KS5tYWcoKSA+PSAyMDtcclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=