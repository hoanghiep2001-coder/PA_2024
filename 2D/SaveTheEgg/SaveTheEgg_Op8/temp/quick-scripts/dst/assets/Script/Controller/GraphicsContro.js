
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Controller/GraphicsContro.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '93044ZctVJBYpcfVaP3IJVr', 'GraphicsContro');
// Script/Controller/GraphicsContro.js

"use strict";

var _StateForJS = require("../Data/StateForJS");

cc.Class({
  "extends": cc.Component,
  properties: {
    graphics: null,
    line_point: [cc.Vec2]
  },
  onLoad: function onLoad() {
    this.node.width = 5000;
    this.node.height = 5000;
    this.graphics = this.getComponent(cc.Graphics);
    this.currentDrawTime = 0;
  },
  start: function start() {
    window.PointPos = cc.v2(0, 0);
    this.onTouch();
  },
  onTouch: function onTouch() {
    this.node.on(cc.Node.EventType.TOUCH_START, this.touch_start, this);
    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touch_move, this);
    this.node.on(cc.Node.EventType.TOUCH_END, this.touch_end, this);
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touch_end, this);
  },
  offTouch: function offTouch() {
    this.node.off(cc.Node.EventType.TOUCH_START);
    this.node.off(cc.Node.EventType.TOUCH_MOVE);
    this.node.off(cc.Node.EventType.TOUCH_END);
    this.node.off(cc.Node.EventType.TOUCH_CANCEL);
  },
  touch_start: function touch_start(event) {
    if (!_StateForJS.StateForJs.isCanDraw || _StateForJS.StateForJs.isToStore) {
      return;
    }

    var pos = this.node.convertToNodeSpaceAR(event.getLocation());
    window.isStartDraw = true;
    window.PointPos = pos;
    this.graphics.moveTo(pos.x, pos.y);
    this.line_point.push(cc.v2(pos.x, pos.y));
  },
  touch_move: function touch_move(event) {
    if (!_StateForJS.StateForJs.isCanDraw || _StateForJS.StateForJs.isToStore) {
      return;
    }

    this.currentDrawTime += 1;

    if (window.currentLv === 2 && this.currentDrawTime >= 8) {
      window.changeEggRigidbodyType = true;
      window.stopDrawSound = true;
      this.touch_end();
      return;
    }

    var pos = this.node.convertToNodeSpaceAR(event.getLocation());
    window.PointPos = pos;
    this.graphics.lineTo(pos.x, pos.y);
    this.line_point.push(cc.v2(pos.x, pos.y));
    this.updateStrokeColor();
    this.graphics.stroke();
  },
  touch_end: function touch_end(event) {
    if (window.isTouchWall) {
      _StateForJS.StateForJs.isCanDraw = true;
      window.isTouchWall = false;
      this.line_point = [];
      this.graphics.clear();
      return;
    }

    if (!_StateForJS.StateForJs.isCanDraw || _StateForJS.StateForJs.isToStore) {
      return;
    } // Rút gọn đường vẽ


    var simplifiedPoints = this.simplifyPath(this.line_point, 4); // Sử dụng độ tolerance phù hợp

    _StateForJS.StateForJs.isCanDraw = false;
    window.isDraw = true;
    window.isTouchWall = false;
    this.createRigibody(simplifiedPoints);
    this.offTouch();
  },
  updateStrokeColor: function updateStrokeColor() {
    if (window.isTouchWall) {
      this.graphics.strokeColor = cc.Color.RED;
    } else {
      this.graphics.strokeColor = cc.Color.BLACK;
    }
  },
  createRigibody: function createRigibody(simplifiedPoints) {
    this.rigibodyLogic = this.addComponent(cc.RigidBody);
    this.rigibodyLogic.gravityScale = 2;
    this.physicsLine = this.addComponent("MyPhysicsCollider");
    this.physicsLine.lineWidth = 7;
    this.physicsLine.points = simplifiedPoints; // Sử dụng điểm đã rút gọn

    this.physicsLine.friction = 0;
    this.physicsLine.density = 1000000;
    this.physicsLine.tag = 4;
    this.physicsLine.apply();
  },
  simplifyPath: function simplifyPath(points, tolerance) {
    if (points.length < 3) return points;
    var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;
    points = this.simplifyDouglasPeucker(points, sqTolerance);
    return points;
  },
  simplifyDouglasPeucker: function simplifyDouglasPeucker(points, sqTolerance) {
    var len = points.length,
        ArrayConstructor = typeof Uint8Array !== 'undefined' ? Uint8Array : Array,
        markers = new ArrayConstructor(len),
        first = 0,
        last = len - 1,
        stack = [],
        newPoints = [],
        i,
        maxSqDist,
        sqDist,
        index;
    markers[first] = markers[last] = 1;

    while (last) {
      maxSqDist = 0;

      for (i = first + 1; i < last; i++) {
        sqDist = this.getSqSegDist(points[i], points[first], points[last]);

        if (sqDist > maxSqDist) {
          index = i;
          maxSqDist = sqDist;
        }
      }

      if (maxSqDist > sqTolerance) {
        markers[index] = 1;
        stack.push(first, index, index, last);
      }

      last = stack.pop();
      first = stack.pop();
    }

    for (i = 0; i < len; i++) {
      if (markers[i]) {
        newPoints.push(points[i]);
      }
    }

    return newPoints;
  },
  getSqSegDist: function getSqSegDist(p, p1, p2) {
    var x = p1.x,
        y = p1.y,
        dx = p2.x - x,
        dy = p2.y - y;

    if (dx !== 0 || dy !== 0) {
      var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);

      if (t > 1) {
        x = p2.x;
        y = p2.y;
      } else if (t > 0) {
        x += dx * t;
        y += dy * t;
      }
    }

    dx = p.x - x;
    dy = p.y - y;
    return dx * dx + dy * dy;
  },
  checkIsCanDraw: function checkIsCanDraw(lastPoint, nowPoint) {
    return lastPoint.sub(nowPoint).mag() >= 20;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxDb250cm9sbGVyXFxHcmFwaGljc0NvbnRyby5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImdyYXBoaWNzIiwibGluZV9wb2ludCIsIlZlYzIiLCJvbkxvYWQiLCJub2RlIiwid2lkdGgiLCJoZWlnaHQiLCJnZXRDb21wb25lbnQiLCJHcmFwaGljcyIsImN1cnJlbnREcmF3VGltZSIsInN0YXJ0Iiwid2luZG93IiwiUG9pbnRQb3MiLCJ2MiIsIm9uVG91Y2giLCJvbiIsIk5vZGUiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsInRvdWNoX3N0YXJ0IiwiVE9VQ0hfTU9WRSIsInRvdWNoX21vdmUiLCJUT1VDSF9FTkQiLCJ0b3VjaF9lbmQiLCJUT1VDSF9DQU5DRUwiLCJvZmZUb3VjaCIsIm9mZiIsImV2ZW50IiwiU3RhdGVGb3JKcyIsImlzQ2FuRHJhdyIsImlzVG9TdG9yZSIsInBvcyIsImNvbnZlcnRUb05vZGVTcGFjZUFSIiwiZ2V0TG9jYXRpb24iLCJpc1N0YXJ0RHJhdyIsIm1vdmVUbyIsIngiLCJ5IiwicHVzaCIsImN1cnJlbnRMdiIsImNoYW5nZUVnZ1JpZ2lkYm9keVR5cGUiLCJzdG9wRHJhd1NvdW5kIiwibGluZVRvIiwidXBkYXRlU3Ryb2tlQ29sb3IiLCJzdHJva2UiLCJpc1RvdWNoV2FsbCIsImNsZWFyIiwic2ltcGxpZmllZFBvaW50cyIsInNpbXBsaWZ5UGF0aCIsImlzRHJhdyIsImNyZWF0ZVJpZ2lib2R5Iiwic3Ryb2tlQ29sb3IiLCJDb2xvciIsIlJFRCIsIkJMQUNLIiwicmlnaWJvZHlMb2dpYyIsImFkZENvbXBvbmVudCIsIlJpZ2lkQm9keSIsImdyYXZpdHlTY2FsZSIsInBoeXNpY3NMaW5lIiwibGluZVdpZHRoIiwicG9pbnRzIiwiZnJpY3Rpb24iLCJkZW5zaXR5IiwidGFnIiwiYXBwbHkiLCJ0b2xlcmFuY2UiLCJsZW5ndGgiLCJzcVRvbGVyYW5jZSIsInVuZGVmaW5lZCIsInNpbXBsaWZ5RG91Z2xhc1BldWNrZXIiLCJsZW4iLCJBcnJheUNvbnN0cnVjdG9yIiwiVWludDhBcnJheSIsIkFycmF5IiwibWFya2VycyIsImZpcnN0IiwibGFzdCIsInN0YWNrIiwibmV3UG9pbnRzIiwiaSIsIm1heFNxRGlzdCIsInNxRGlzdCIsImluZGV4IiwiZ2V0U3FTZWdEaXN0IiwicG9wIiwicCIsInAxIiwicDIiLCJkeCIsImR5IiwidCIsImNoZWNrSXNDYW5EcmF3IiwibGFzdFBvaW50Iiwibm93UG9pbnQiLCJzdWIiLCJtYWciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0FBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxRQUFRLEVBQUUsSUFERjtBQUVSQyxJQUFBQSxVQUFVLEVBQUUsQ0FBQ0wsRUFBRSxDQUFDTSxJQUFKO0FBRkosR0FIUDtBQVFMQyxFQUFBQSxNQVJLLG9CQVFJO0FBQ0wsU0FBS0MsSUFBTCxDQUFVQyxLQUFWLEdBQWtCLElBQWxCO0FBQ0EsU0FBS0QsSUFBTCxDQUFVRSxNQUFWLEdBQW1CLElBQW5CO0FBQ0EsU0FBS04sUUFBTCxHQUFnQixLQUFLTyxZQUFMLENBQWtCWCxFQUFFLENBQUNZLFFBQXJCLENBQWhCO0FBQ0EsU0FBS0MsZUFBTCxHQUF1QixDQUF2QjtBQUNILEdBYkk7QUFlTEMsRUFBQUEsS0FmSyxtQkFlRztBQUNKQyxJQUFBQSxNQUFNLENBQUNDLFFBQVAsR0FBa0JoQixFQUFFLENBQUNpQixFQUFILENBQU0sQ0FBTixFQUFTLENBQVQsQ0FBbEI7QUFDQSxTQUFLQyxPQUFMO0FBQ0gsR0FsQkk7QUFvQkxBLEVBQUFBLE9BcEJLLHFCQW9CSztBQUNOLFNBQUtWLElBQUwsQ0FBVVcsRUFBVixDQUFhbkIsRUFBRSxDQUFDb0IsSUFBSCxDQUFRQyxTQUFSLENBQWtCQyxXQUEvQixFQUE0QyxLQUFL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QUFHQyxDQUFWO0FBQ0g7QUFDSjs7QUFFREYsSUFBQUEsRUFBRSxHQUFHSCxDQUFDLENBQUNsRCxDQUFGLEdBQU1BLENBQVg7QUFDQXNELElBQUFBLEVBQUUsR0FBR0osQ0FBQyxDQUFDakQsQ0FBRixHQUFNQSxDQUFYO0FBRUEsV0FBT29ELEVBQUUsR0FBR0EsRUFBTCxHQUFVQyxFQUFFLEdBQUdBLEVBQXRCO0FBQ0gsR0F6TEk7QUEyTExFLEVBQUFBLGNBM0xLLDBCQTJMVUMsU0EzTFYsRUEyTHFCQyxRQTNMckIsRUEyTCtCO0FBQ2hDLFdBQU9ELFNBQVMsQ0FBQ0UsR0FBVixDQUFjRCxRQUFkLEVBQXdCRSxHQUF4QixNQUFpQyxFQUF4QztBQUNIO0FBN0xJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0YXRlRm9ySnMgfSBmcm9tIFwiLi4vRGF0YS9TdGF0ZUZvckpTXCI7XHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgZ3JhcGhpY3M6IG51bGwsXHJcbiAgICAgICAgbGluZV9wb2ludDogW2NjLlZlYzJdLFxyXG4gICAgfSxcclxuXHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLndpZHRoID0gNTAwMDtcclxuICAgICAgICB0aGlzLm5vZGUuaGVpZ2h0ID0gNTAwMDtcclxuICAgICAgICB0aGlzLmdyYXBoaWNzID0gdGhpcy5nZXRDb21wb25lbnQoY2MuR3JhcGhpY3MpO1xyXG4gICAgICAgIHRoaXMuY3VycmVudERyYXdUaW1lID0gMDtcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICAgICAgd2luZG93LlBvaW50UG9zID0gY2MudjIoMCwgMCk7XHJcbiAgICAgICAgdGhpcy5vblRvdWNoKCk7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICBvblRvdWNoKCkge1xyXG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCwgdGhpcy50b3VjaF9zdGFydCwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIHRoaXMudG91Y2hfbW92ZSwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgdGhpcy50b3VjaF9lbmQsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUwsIHRoaXMudG91Y2hfZW5kLCB0aGlzKTtcclxuICAgIH0sXHJcblxyXG4gICAgb2ZmVG91Y2goKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9NT1ZFKTtcclxuICAgICAgICB0aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUwpO1xyXG4gICAgfSxcclxuXHJcbiAgICB0b3VjaF9zdGFydChldmVudCkge1xyXG4gICAgICAgIGlmICghU3RhdGVGb3JKcy5pc0NhbkRyYXcgfHwgU3RhdGVGb3JKcy5pc1RvU3RvcmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHBvcyA9IHRoaXMubm9kZS5jb252ZXJ0VG9Ob2RlU3BhY2VBUihldmVudC5nZXRMb2NhdGlvbigpKTtcclxuICAgICAgICB3aW5kb3cuaXNTdGFydERyYXcgPSB0cnVlO1xyXG4gICAgICAgIHdpbmRvdy5Qb2ludFBvcyA9IHBvcztcclxuICAgICAgICB0aGlzLmdyYXBoaWNzLm1vdmVUbyhwb3MueCwgcG9zLnkpO1xyXG4gICAgICAgIHRoaXMubGluZV9wb2ludC5wdXNoKGNjLnYyKHBvcy54LCBwb3MueSkpO1xyXG4gICAgfSxcclxuXHJcbiAgICB0b3VjaF9tb3ZlKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKCFTdGF0ZUZvckpzLmlzQ2FuRHJhdyB8fCBTdGF0ZUZvckpzLmlzVG9TdG9yZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmN1cnJlbnREcmF3VGltZSArPSAxO1xyXG5cclxuICAgICAgICBpZih3aW5kb3cuY3VycmVudEx2ID09PSAyICYmIHRoaXMuY3VycmVudERyYXdUaW1lID49IDgpIHtcclxuICAgICAgICAgICAgd2luZG93LmNoYW5nZUVnZ1JpZ2lkYm9keVR5cGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB3aW5kb3cuc3RvcERyYXdTb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMudG91Y2hfZW5kKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBwb3MgPSB0aGlzLm5vZGUuY29udmVydFRvTm9kZVNwYWNlQVIoZXZlbnQuZ2V0TG9jYXRpb24oKSk7XHJcbiAgICAgICAgd2luZG93LlBvaW50UG9zID0gcG9zO1xyXG4gICAgICAgIHRoaXMuZ3JhcGhpY3MubGluZVRvKHBvcy54LCBwb3MueSk7XHJcbiAgICAgICAgdGhpcy5saW5lX3BvaW50LnB1c2goY2MudjIocG9zLngsIHBvcy55KSk7XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlU3Ryb2tlQ29sb3IoKTtcclxuICAgICAgICB0aGlzLmdyYXBoaWNzLnN0cm9rZSgpO1xyXG4gICAgfSxcclxuXHJcbiAgICB0b3VjaF9lbmQoZXZlbnQpIHtcclxuICAgICAgICBpZiAod2luZG93LmlzVG91Y2hXYWxsKSB7XHJcbiAgICAgICAgICAgIFN0YXRlRm9ySnMuaXNDYW5EcmF3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgd2luZG93LmlzVG91Y2hXYWxsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubGluZV9wb2ludCA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLmdyYXBoaWNzLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghU3RhdGVGb3JKcy5pc0NhbkRyYXcgfHwgU3RhdGVGb3JKcy5pc1RvU3RvcmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUsO6dCBn4buNbiDEkcaw4budbmcgduG6vVxyXG4gICAgICAgIGxldCBzaW1wbGlmaWVkUG9pbnRzID0gdGhpcy5zaW1wbGlmeVBhdGgodGhpcy5saW5lX3BvaW50LCA0KTsgIC8vIFPhu60gZOG7pW5nIMSR4buZIHRvbGVyYW5jZSBwaMO5IGjhu6NwXHJcbiAgICAgICAgU3RhdGVGb3JKcy5pc0NhbkRyYXcgPSBmYWxzZTtcclxuICAgICAgICB3aW5kb3cuaXNEcmF3ID0gdHJ1ZTtcclxuICAgICAgICB3aW5kb3cuaXNUb3VjaFdhbGwgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNyZWF0ZVJpZ2lib2R5KHNpbXBsaWZpZWRQb2ludHMpO1xyXG4gICAgICAgIHRoaXMub2ZmVG91Y2goKTtcclxuICAgIH0sXHJcblxyXG4gICAgdXBkYXRlU3Ryb2tlQ29sb3IoKSB7XHJcbiAgICAgICAgaWYgKHdpbmRvdy5pc1RvdWNoV2FsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmdyYXBoaWNzLnN0cm9rZUNvbG9yID0gY2MuQ29sb3IuUkVEO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3Muc3Ryb2tlQ29sb3IgPSBjYy5Db2xvci5CTEFDSztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGNyZWF0ZVJpZ2lib2R5KHNpbXBsaWZpZWRQb2ludHMpIHtcclxuICAgICAgICB0aGlzLnJpZ2lib2R5TG9naWMgPSB0aGlzLmFkZENvbXBvbmVudChjYy5SaWdpZEJvZHkpO1xyXG4gICAgICAgIHRoaXMucmlnaWJvZHlMb2dpYy5ncmF2aXR5U2NhbGUgPSAyO1xyXG5cclxuICAgICAgICB0aGlzLnBoeXNpY3NMaW5lID0gdGhpcy5hZGRDb21wb25lbnQoXCJNeVBoeXNpY3NDb2xsaWRlclwiKTtcclxuICAgICAgICB0aGlzLnBoeXNpY3NMaW5lLmxpbmVXaWR0aCA9IDc7XHJcbiAgICAgICAgdGhpcy5waHlzaWNzTGluZS5wb2ludHMgPSBzaW1wbGlmaWVkUG9pbnRzOyAgLy8gU+G7rSBk4bulbmcgxJFp4buDbSDEkcOjIHLDunQgZ+G7jW5cclxuICAgICAgICB0aGlzLnBoeXNpY3NMaW5lLmZyaWN0aW9uID0gMDtcclxuICAgICAgICB0aGlzLnBoeXNpY3NMaW5lLmRlbnNpdHkgPSAxMDAwMDAwO1xyXG4gICAgICAgIHRoaXMucGh5c2ljc0xpbmUudGFnID0gNDtcclxuICAgICAgICB0aGlzLnBoeXNpY3NMaW5lLmFwcGx5KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHNpbXBsaWZ5UGF0aChwb2ludHMsIHRvbGVyYW5jZSkge1xyXG4gICAgICAgIGlmIChwb2ludHMubGVuZ3RoIDwgMykgcmV0dXJuIHBvaW50cztcclxuXHJcbiAgICAgICAgbGV0IHNxVG9sZXJhbmNlID0gdG9sZXJhbmNlICE9PSB1bmRlZmluZWQgPyB0b2xlcmFuY2UgKiB0b2xlcmFuY2UgOiAxO1xyXG4gICAgICAgIHBvaW50cyA9IHRoaXMuc2ltcGxpZnlEb3VnbGFzUGV1Y2tlcihwb2ludHMsIHNxVG9sZXJhbmNlKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH0sXHJcblxyXG4gICAgc2ltcGxpZnlEb3VnbGFzUGV1Y2tlcihwb2ludHMsIHNxVG9sZXJhbmNlKSB7XHJcbiAgICAgICAgbGV0IGxlbiA9IHBvaW50cy5sZW5ndGgsXHJcbiAgICAgICAgICAgIEFycmF5Q29uc3RydWN0b3IgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gJ3VuZGVmaW5lZCcgPyBVaW50OEFycmF5IDogQXJyYXksXHJcbiAgICAgICAgICAgIG1hcmtlcnMgPSBuZXcgQXJyYXlDb25zdHJ1Y3RvcihsZW4pLFxyXG4gICAgICAgICAgICBmaXJzdCA9IDAsXHJcbiAgICAgICAgICAgIGxhc3QgPSBsZW4gLSAxLFxyXG4gICAgICAgICAgICBzdGFjayA9IFtdLFxyXG4gICAgICAgICAgICBuZXdQb2ludHMgPSBbXSxcclxuICAgICAgICAgICAgaSwgbWF4U3FEaXN0LCBzcURpc3QsIGluZGV4O1xyXG5cclxuICAgICAgICBtYXJrZXJzW2ZpcnN0XSA9IG1hcmtlcnNbbGFzdF0gPSAxO1xyXG5cclxuICAgICAgICB3aGlsZSAobGFzdCkge1xyXG4gICAgICAgICAgICBtYXhTcURpc3QgPSAwO1xyXG5cclxuICAgICAgICAgICAgZm9yIChpID0gZmlyc3QgKyAxOyBpIDwgbGFzdDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBzcURpc3QgPSB0aGlzLmdldFNxU2VnRGlzdChwb2ludHNbaV0sIHBvaW50c1tmaXJzdF0sIHBvaW50c1tsYXN0XSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNxRGlzdCA+IG1heFNxRGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICBtYXhTcURpc3QgPSBzcURpc3Q7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChtYXhTcURpc3QgPiBzcVRvbGVyYW5jZSkge1xyXG4gICAgICAgICAgICAgICAgbWFya2Vyc1tpbmRleF0gPSAxO1xyXG4gICAgICAgICAgICAgICAgc3RhY2sucHVzaChmaXJzdCwgaW5kZXgsIGluZGV4LCBsYXN0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGFzdCA9IHN0YWNrLnBvcCgpO1xyXG4gICAgICAgICAgICBmaXJzdCA9IHN0YWNrLnBvcCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChtYXJrZXJzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdQb2ludHMucHVzaChwb2ludHNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3UG9pbnRzO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXRTcVNlZ0Rpc3QocCwgcDEsIHAyKSB7XHJcbiAgICAgICAgbGV0IHggPSBwMS54LFxyXG4gICAgICAgICAgICB5ID0gcDEueSxcclxuICAgICAgICAgICAgZHggPSBwMi54IC0geCxcclxuICAgICAgICAgICAgZHkgPSBwMi55IC0geTtcclxuXHJcbiAgICAgICAgaWYgKGR4ICE9PSAwIHx8IGR5ICE9PSAwKSB7XHJcbiAgICAgICAgICAgIGxldCB0ID0gKChwLnggLSB4KSAqIGR4ICsgKHAueSAtIHkpICogZHkpIC8gKGR4ICogZHggKyBkeSAqIGR5KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0ID4gMSkge1xyXG4gICAgICAgICAgICAgICAgeCA9IHAyLng7XHJcbiAgICAgICAgICAgICAgICB5ID0gcDIueTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgeCArPSBkeCAqIHQ7XHJcbiAgICAgICAgICAgICAgICB5ICs9IGR5ICogdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZHggPSBwLnggLSB4O1xyXG4gICAgICAgIGR5ID0gcC55IC0geTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5O1xyXG4gICAgfSxcclxuXHJcbiAgICBjaGVja0lzQ2FuRHJhdyhsYXN0UG9pbnQsIG5vd1BvaW50KSB7XHJcbiAgICAgICAgcmV0dXJuIGxhc3RQb2ludC5zdWIobm93UG9pbnQpLm1hZygpID49IDIwO1xyXG4gICAgfSxcclxufSk7XHJcbiJdfQ==