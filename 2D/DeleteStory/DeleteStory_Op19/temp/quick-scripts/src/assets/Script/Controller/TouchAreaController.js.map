{"version":3,"sources":["assets\\Script\\Controller\\TouchAreaController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Constants } from \"../Data/constants\";\r\nimport AudioManager from \"../Plugin/AudioManager\";\r\nimport { GameController } from \"./GameController\";\r\nimport GamePlay from \"./GamePlay\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TouchAreaController extends cc.Component {\r\n    @property(GamePlay)\r\n    GamePlay: GamePlay = null;\r\n    @property(AudioManager)\r\n    AudioManager: AudioManager = null;\r\n    @property(GameController)\r\n    GameController: GameController = null;\r\n\r\n    @property(cc.Node)\r\n    btn_Yes: cc.Node = null;\r\n    @property(cc.Node)\r\n    btn_No: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    hideMask: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    hand: cc.Node = null;\r\n    @property(cc.Node)\r\n    Point: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    CTA_Btn: cc.Node = null;\r\n\r\n    // state\r\n    isTouch: boolean = false;\r\n    isActiveCTA: boolean = false;\r\n\r\n\r\n    protected start(): void {\r\n        this.btn_Yes.on(cc.Node.EventType.TOUCH_START, this.btnYesTouch, this);\r\n        this.btn_No.on(cc.Node.EventType.TOUCH_START, this.GameController.installHandle, this);\r\n\r\n        if(!this.GamePlay.Opening.active) {\r\n            this.registerEvent();\r\n        }\r\n    }\r\n\r\n\r\n    private registerEvent(): void {\r\n        this.hideMask.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);\r\n        this.hideMask.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this);\r\n        this.hideMask.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this);\r\n        this.hideMask.on(cc.Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\r\n    }\r\n\r\n\r\n    private btnYesTouch(): void {\r\n        this.btn_Yes.getChildByName(\"icon\").active = true;\r\n        this.AudioManager.playSound(Constants.SoundTrack.clickSound);\r\n        this.GamePlay.Opening.active = false;\r\n        this.GamePlay.MainContent.active = true;\r\n\r\n        this.GamePlay.handleIronSourcePlaySound();\r\n        this.registerEvent();\r\n    }\r\n\r\n\r\n    private touchStart(e: cc.Touch): void {\r\n\r\n        Constants.life <= 0 && this.GameController.installHandle();\r\n\r\n        if(Constants.ironSource.isEndGame) return;\r\n\r\n        this.GamePlay.handleIronSourcePlaySound();\r\n        \r\n        this.isTouch = true;\r\n        this.hand.active = false;\r\n        this.Point.getComponent(cc.Animation).stop();\r\n        !Constants.isDoneEraser && this.AudioManager.playSound(Constants.SoundTrack.drawSound);\r\n\r\n        let pos = e.getLocation();\r\n        let convertedPos = this.node.convertToNodeSpaceAR(pos);\r\n        this.Point.setPosition(convertedPos);\r\n        Constants.touchPoints.push(convertedPos);\r\n\r\n        // mtg && aplovin\r\n        // this.isActiveCTA && this.GameController.installHandle();\r\n    }\r\n\r\n\r\n    private touchMove(e: cc.Touch): void {\r\n        let pos = e.getLocation();\r\n        let convertedPos = this.node.convertToNodeSpaceAR(pos);\r\n        this.Point.setPosition(convertedPos);\r\n\r\n        Constants.touchPoints.push(convertedPos);\r\n    }\r\n\r\n\r\n    private checkStraightLine(touchPoints: cc.Vec2[]): boolean {\r\n        if (touchPoints.length < 3) {\r\n            return false;\r\n        }\r\n\r\n        let A = touchPoints[touchPoints.length - 3];\r\n        let B = touchPoints[touchPoints.length - 2];\r\n        let C = touchPoints[touchPoints.length - 1];\r\n\r\n        return (B.x - A.x) * (C.y - A.y) === (B.y - A.y) * (C.x - A.x);\r\n    }\r\n\r\n\r\n    private touchEnd(): void {\r\n        this.isTouch = false;\r\n        this.AudioManager.stopSound(Constants.SoundTrack.drawSound);\r\n        this.unActivePoint();\r\n\r\n        // win\r\n        if (this.GamePlay.isDeleteOverHalf() && this.checkStraightLine(Constants.touchPoints)) {\r\n            this.isActiveCTA = true;\r\n            Constants.isDoneEraser = true;\r\n            this.GamePlay.winGame();\r\n            this.GamePlay.ageLabel.node.color = cc.Color.GREEN;\r\n            this.GamePlay.increaseAge(Constants.age, 18);\r\n            this.CTA_Btn.on(cc.Node.EventType.TOUCH_START, this.GameController.installHandle, this);\r\n        }\r\n\r\n        // lose\r\n        if (!Constants.isDoneEraser) {\r\n            Constants.isRestart = true;\r\n            Constants.life -= 1;\r\n            Constants.ageIncrease += 3;\r\n            this.GamePlay.ageLabel.node.color = cc.Color.RED;\r\n            this.GamePlay.increaseAge(Constants.age, Constants.ageIncrease);\r\n            this.AudioManager.playSound(Constants.SoundTrack.LoseSound);\r\n            this.scheduleOnce(() => {\r\n                this.GamePlay.RestartGame();\r\n            }, 1.5)\r\n        }\r\n    }\r\n\r\n\r\n    private unActivePoint(): void {\r\n        this.Point.active = false;\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        this.GamePlay.handleMuteSoundIronSource();\r\n    }\r\n}\r\n"]}