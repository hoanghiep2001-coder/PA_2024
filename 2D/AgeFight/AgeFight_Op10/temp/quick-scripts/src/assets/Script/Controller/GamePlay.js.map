{"version":3,"sources":["assets\\Script\\Controller\\GamePlay.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Constants } from \"../Data/constants\";\r\nimport Army from \"../Other/Army\";\r\nimport AudioManager from \"../Plugin/AudioManager\";\r\nimport ComboController from \"./CmoboController\";\r\nimport { GameController } from \"./GameController\";\r\nimport LoadFoodController from \"./LoadFoodController\";\r\nimport SpawnController from \"./SpawnController\";\r\nimport VFxController from \"./vFxController\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GamePlay extends cc.Component {\r\n  @property(AudioManager)\r\n  AudioManager: AudioManager = null;\r\n  @property(GameController)\r\n  GameController: GameController = null;\r\n  @property(LoadFoodController)\r\n  LoadFoodController: LoadFoodController = null;\r\n  @property(SpawnController)\r\n  SpawnController: SpawnController = null;\r\n\r\n  @property(ComboController)\r\n  ComboController: ComboController = null;\r\n\r\n  @property(VFxController)\r\n  VFxController: VFxController = null;\r\n\r\n  // Node\r\n  @property(cc.Node)\r\n  CTA: cc.Node = null;\r\n\r\n  // state\r\n  isCollideBaseFlag: boolean = false;\r\n\r\n\r\n  protected onLoad(): void {\r\n    cc.director.getPhysicsManager().enabled = true;\r\n    let collisionManager = cc.director.getCollisionManager();\r\n    collisionManager.enabled = true;\r\n    collisionManager.enabledDrawBoundingBox = true;\r\n    // collisionManager.enabledDebugDraw = true;\r\n  }\r\n\r\n\r\n  public resetGame(): void {\r\n    Constants.allyArmies.forEach(army => army.destroy());\r\n    Constants.enemyArmies.forEach(army => army.destroy());\r\n\r\n    Constants.isStartGame = false;\r\n    Constants.isPauseGame = false;\r\n    Constants.isCanBuyArmyLv2 = false;\r\n    Constants.isCanBuyArmyLv3 = false;\r\n    Constants.isUpgrade = false;\r\n    Constants.isWin = false;\r\n    Constants.isLoose = false;\r\n    Constants.isCollideBase = false;\r\n    Constants.isFiveBroInTank = false;\r\n\r\n    Constants.food = 15;\r\n    Constants.enemyDie = 0;\r\n    Constants.currentCoin = 0;\r\n    Constants.EnemyBaseHeal = 1;\r\n    Constants.AllyBaseHeal = 1;\r\n    Constants.comboCount = 0;\r\n\r\n    Constants.allyArmies = [];\r\n    Constants.enemyArmies = [];\r\n\r\n    cc.director.loadScene(\"game_Hor\");\r\n  }\r\n\r\n\r\n  private initGame(): void {\r\n    Constants.allyArmies.forEach(army => army.destroy());\r\n    Constants.enemyArmies.forEach(army => army.destroy());\r\n\r\n    Constants.isStartGame = false;\r\n    Constants.isPauseGame = false;\r\n    Constants.isCanBuyArmyLv2 = false;\r\n    Constants.isCanBuyArmyLv3 = false;\r\n    Constants.isUpgrade = false;\r\n    Constants.isWin = false;\r\n    Constants.isLoose = false;\r\n    Constants.isCollideBase = false;\r\n    Constants.isFiveBroInTank = false;\r\n\r\n    Constants.food = 15;\r\n    Constants.enemyDie = 0;\r\n    Constants.currentCoin = 0;\r\n    Constants.EnemyBaseHeal = 1;\r\n    Constants.AllyBaseHeal = 1;\r\n    Constants.comboCount = 0;\r\n\r\n    Constants.allyArmies = [];\r\n    Constants.enemyArmies = [];\r\n  }\r\n\r\n\r\n  protected start(): void {\r\n    this.AudioManager.playSound(Constants.SoundTrack.bgSound);\r\n    this.AudioManager.bgSound.volume = 0.5;\r\n\r\n    this.initGame();\r\n\r\n    this.node.on('Shooting', () => {\r\n      this.VFxController.handleShooting();\r\n    }, this);\r\n\r\n    this.node.on('ShowSpeedLine', () => {\r\n      this.AudioManager.stopSound(Constants.SoundTrack.bgSound);\r\n      this.AudioManager.playSound(Constants.SoundTrack.Bg_Attack);\r\n      this.AudioManager.Bg_Attack.volume = 0.5;\r\n      this.VFxController.ShowSpeedLine();\r\n    }, this);\r\n\r\n    cc.view.setResizeCallback(() => {\r\n      if(Constants.ironSource.isEndGame || Constants.isWin || Constants.isLoose) return;\r\n      this.resetGame();\r\n    });\r\n  }\r\n\r\n\r\n  public spawnArmy(index: number): void {\r\n    Constants.isPauseGame = false;\r\n    // !Constants.isStartGame && this.LoadFoodController.increaseFood();\r\n    !Constants.isStartGame && this.SpawnController.SpawnEnemies();\r\n    Constants.isStartGame = true;\r\n\r\n    switch (index) {\r\n      case 1:\r\n        // spawn army lv1\r\n        if (Constants.food >= 3) {\r\n          Constants.food -= 3;\r\n          Constants.comboCount += 1;\r\n          this.SpawnController.SpawnPlayerArmy(Constants.ArmySkin.Ally, 1);\r\n          this.ComboController.handleShowCombo();\r\n        }\r\n\r\n        break;\r\n      case 2:\r\n        // spawn army lv2\r\n        if (Constants.food >= 4 && Constants.isCanBuyArmyLv2) {\r\n          Constants.food -= 4;\r\n          this.SpawnController.SpawnPlayerArmy(Constants.ArmySkin.Ally, 2);\r\n        }\r\n        break;\r\n\r\n      case 3:\r\n        // spawn army lv3\r\n        if (Constants.food >= 5 && Constants.isCanBuyArmyLv3) {\r\n          Constants.food -= 5;\r\n          this.SpawnController.SpawnPlayerArmy(Constants.ArmySkin.Ally, 3);\r\n        }\r\n        break;\r\n      default:\r\n        console.log(\"can not spawn\");\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  private HandleFiveBroInTank(): void {\r\n    if (Constants.isFiveBroInTank) return;\r\n\r\n    Constants.isFiveBroInTank = true;\r\n\r\n    // this.AudioManager.playSound(Constants.SoundTrack.bgSound);\r\n\r\n    let Troops: cc.Node[] = [];\r\n    let Tank: cc.Node = null;\r\n\r\n    Constants.allyArmies.forEach(army => {\r\n      if(army.name === \"Army2_Lv1\") Troops.push(army);\r\n      if(army.name === \"Army_Lv3\") Tank = army;\r\n    });\r\n\r\n    // cho mấy thằng lính hợp thể vào tank.\r\n    Troops.forEach(troop => {\r\n      cc.tween(troop)\r\n      .to(0.5, {x: Tank.x, y: Tank.y})\r\n      .call(() => {\r\n        Constants.troopsInTankCount += 1;\r\n\r\n        // set anim run cho lính\r\n        troop.getComponent(Army).spine.setAnimation(0, Constants.ArmyAnim.Run, true);\r\n\r\n        // cho xe tăng chạy nếu đã đủ lính\r\n        if(Constants.troopsInTankCount >= 5) Constants.isTankCanRun = true;\r\n\r\n        troop.active = false;\r\n      })\r\n      .start();\r\n    })\r\n  }\r\n\r\n\r\n  private isSpawn5Troops(): boolean {\r\n    let result: boolean = false;\r\n    if (Constants.troopsSpawnLeftCount < 0) return true;\r\n    return result;\r\n  }\r\n\r\n\r\n  private activeCTA(): void {\r\n    cc.log(\"show CTA\");\r\n    this.CTA.active = true;\r\n    Constants.isActiveCTA = true;\r\n  }\r\n\r\n\r\n  protected update(dt: number): void {\r\n    this.isSpawn5Troops() && this.HandleFiveBroInTank();\r\n    if((Constants.isLoose || Constants.isWin) && !Constants.isActiveCTA) {\r\n      this.activeCTA();\r\n   }\r\n  }\r\n\r\n}\r\n"]}