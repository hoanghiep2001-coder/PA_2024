{"version":3,"sources":["assets\\Script\\Controller\\TankController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Constants } from \"../Data/constants\";\r\nimport Army from \"../Other/Army\";\r\nimport AudioManager from \"../Plugin/AudioManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TankController extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    HealthBar: cc.Node = null;\r\n\r\n    @property(cc.Prefab)\r\n    vFx_Booom: cc.Prefab = null;\r\n\r\n    @property(cc.ParticleSystem)\r\n    FX_Upgrade: cc.ParticleSystem = null;\r\n\r\n    @property(cc.ParticleSystem)\r\n    FX_Blink: cc.ParticleSystem = null;\r\n\r\n    @property([cc.Node])\r\n    TroopsPoints: cc.Node[] = [];\r\n \r\n    AudioManager: AudioManager = null;\r\n    spine: sp.Skeleton = null; \r\n    collider: cc.BoxCollider = null;\r\n\r\n    skin: string = \"\";\r\n    speed: number = 25;\r\n\r\n    isRunning: boolean = false;\r\n    isBase: boolean = false;\r\n    isLive: boolean = true;\r\n\r\n    rigidbody: cc.RigidBody = null;\r\n\r\n\r\n    onCollisionEnter(o: cc.PhysicsCollider, s: cc.Collider) {\r\n        // enemy collide with tank\r\n        if (o) {\r\n            if(o.tag === 0) {\r\n                Constants.isTankCanRun = false;\r\n                this.shoot();\r\n            }\r\n\r\n            let armyComponent = o.getComponent(Army);\r\n            if (armyComponent && Constants.isTankCanRun && s.tag === 18) {\r\n                Constants.shootCount += 1;\r\n\r\n                Constants.isTankCanRun = false;\r\n\r\n                this.spine.setAnimation(0, Constants.ArmyAnim.Attack, false);\r\n\r\n                    // fx blast\r\n                    this.scheduleOnce(() => {\r\n                        this.node.getChildByName(\"Blast\").getComponent(cc.Animation).play(\"Tank_BlastAnim\");\r\n\r\n                        this.AudioManager.playSound(Constants.SoundTrack.Lv2_Tank);\r\n\r\n                        this.shootEnemy(armyComponent);\r\n\r\n                        for (let index = 0; index < Constants.enemyArmies.length; index++) {\r\n                            const element = Constants.enemyArmies[index];\r\n                            const army = element.getComponent(Army);\r\n\r\n                            army.isLive = false;\r\n                            army.spine.setAnimation(0, Constants.ArmyAnim.Die, false);\r\n\r\n                            cc.tween(element)\r\n                            .to(0.5, {opacity: 0})\r\n                            .call(() => {\r\n                                element.active = false;\r\n                                element.destroy();\r\n                            })\r\n                            .start();\r\n                        }\r\n\r\n                        Constants.enemyArmies = [];\r\n                    }, 0.3);\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // onCollisionStay(o: cc.PhysicsCollider, s) {\r\n    //     Constants.isTankCanRun = false\r\n    // }\r\n\r\n\r\n    // onCollisionExit(o, s) {\r\n    //     Constants.isTankCanRun = true;\r\n    // }\r\n\r\n\r\n    private shootEnemy(armyComponent: Army): void {\r\n        cc.log(\"shoot!!!\");\r\n        \r\n        let tankPos = this.node.getPosition();\r\n\r\n        let vFx_Booom = cc.instantiate(this.vFx_Booom);\r\n\r\n        vFx_Booom.parent = this.node;\r\n\r\n        vFx_Booom.setPosition(tankPos.x + 50, tankPos.y + 105);\r\n\r\n        vFx_Booom.active = true;\r\n\r\n        this.scheduleOnce(() => {\r\n            vFx_Booom.active = false;\r\n            Constants.isTankCanRun = true;\r\n        }, 1.5)\r\n    }\r\n\r\n\r\n    protected start(): void {\r\n        this.AudioManager = this.node.parent.parent.parent.parent.parent.parent\r\n            .getChildByName(\"AudioManager\").getComponent(AudioManager);\r\n        this.spine = this.node.getChildByName(\"Spine\").getComponent(sp.Skeleton);\r\n        this.collider = this.getComponent(cc.BoxCollider);\r\n\r\n        this.collider.enabled = false;\r\n\r\n        // active run to Base\r\n        this.scheduleOnce(() => {\r\n            this.runAheadBase();\r\n            this.spine.setAnimation(0, Constants.ArmyAnim.Run, true);\r\n        }, 0.2);\r\n\r\n        Constants.tank_TroopPoints = this.TroopsPoints;\r\n    }\r\n\r\n\r\n    private shoot(): void {\r\n        this.spine.setAnimation(0, Constants.ArmyAnim.Attack, false);\r\n\r\n        // fx blast\r\n        this.scheduleOnce(() => {\r\n            this.node.getChildByName(\"Blast\").getComponent(cc.Animation).play(\"Tank_BlastAnim\");\r\n            this.AudioManager.playSound(Constants.SoundTrack.Lv2_Tank)\r\n            const customEvent = new cc.Event.EventCustom('Shooting', true);\r\n            this.node.dispatchEvent(customEvent);\r\n        }, 0.3);\r\n    }\r\n\r\n\r\n    die(): void {\r\n        this.isLive = false;\r\n        this.spine.timeScale = 0.3;\r\n        this.spine.setAnimation(0, Constants.ArmyAnim.Die, false);\r\n        this.HealthBar.active = false;\r\n\r\n        Constants.isLoose = true;\r\n\r\n        Constants.isPauseGame = true;\r\n\r\n        cc.tween(this.node)\r\n            .to(1, { opacity: 0 })\r\n            .call(() => this.node.destroy())\r\n            .start();\r\n\r\n        this.node.getComponent(cc.Collider).enabled = false;\r\n        this.node.getComponent(cc.Collider).destroy();\r\n    }\r\n\r\n\r\n    private runAheadBase(): void {\r\n        let currentPos = this.node.getPosition();\r\n        this.node.x = currentPos.x + 100;\r\n        Constants.isCanTouch = true;\r\n\r\n\r\n        // cc.tween(this.node)\r\n        //     .to(3, { x: currentPos.x + 100 })\r\n        //     .call(() => {\r\n        //         Constants.isCanTouch = true;\r\n        //         this.spine.setAnimation(0, Constants.ArmyAnim.Idle, true);\r\n        //     })\r\n        //     .start();\r\n    }\r\n\r\n\r\n    private activeAnimRun(): void {\r\n        if(this.isRunning) return;\r\n\r\n        this.spine.node.active = true;\r\n\r\n        this.HealthBar.parent.active = true;\r\n\r\n        this.collider.enabled = true;\r\n\r\n        this.updateTankPremeium();\r\n\r\n        this.registerEvent();\r\n\r\n        this.spine.setAnimation(0, Constants.ArmyAnim.Run, true);\r\n    }\r\n\r\n\r\n    private updateTankPremeium(): void {\r\n        let currentScale = this.node.scale;\r\n\r\n        this.FX_Upgrade.resetSystem();\r\n\r\n        this.FX_Blink.resetSystem();\r\n\r\n        // this.spine.node.color = cc.color(255, 204, 0 ,255);\r\n\r\n        cc.tween(this.node)\r\n        .to(0.5, {scale: currentScale + 0.15}, {easing: cc.easing.elasticOut})\r\n        .start();\r\n    }\r\n\r\n\r\n    private registerEvent(): void {\r\n        const customEvent = new cc.Event.EventCustom('ShowSpeedLine', true);\r\n        this.node.dispatchEvent(customEvent);\r\n    }\r\n\r\n\r\n    private run(): void {\r\n        this.activeAnimRun();\r\n        this.isRunning = true;\r\n        let currentPos = this.node.getPosition();\r\n        let targetPos = new cc.Vec2(currentPos.x + 25 + Constants.Responsive.speedCalculated, currentPos.y);\r\n        this.node.setPosition(currentPos.lerp(targetPos, 0.02, currentPos))\r\n    }\r\n\r\n\r\n    protected update(dt: number): void {\r\n        if (this.HealthBar.scaleX <= 0.05 && this.isLive) this.die();\r\n\r\n        Constants.isTankCanRun && this.run();\r\n    }\r\n}\r\n"]}