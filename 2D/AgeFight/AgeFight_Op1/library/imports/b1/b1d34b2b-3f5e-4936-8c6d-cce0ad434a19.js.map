{"version":3,"sources":["assets\\Script\\Controller\\GamePlay.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Constants } from \"../Data/constants\";\r\nimport AudioManager from \"../Plugin/AudioManager\";\r\nimport { GameController } from \"./GameController\";\r\nimport LoadFoodController from \"./LoadFoodController\";\r\nimport SpawnController from \"./SpawnController\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GamePlay extends cc.Component {\r\n  @property(AudioManager)\r\n  AudioManager: AudioManager = null;\r\n  @property(GameController)\r\n  GameController: GameController = null;\r\n  @property(LoadFoodController)\r\n  LoadFoodController: LoadFoodController = null;\r\n  @property(SpawnController)\r\n  SpawnController: SpawnController = null;\r\n\r\n  // Node\r\n  @property(cc.Node)\r\n  CTA: cc.Node = null;\r\n  @property(cc.Node)\r\n  Boss: cc.Node = null;\r\n\r\n  // state\r\n  isCollideBaseFlag: boolean = false;\r\n\r\n\r\n  protected onLoad(): void {\r\n    let physics = cc.director.getPhysicsManager();\r\n    physics.enabled = true;\r\n    let collisionManager = cc.director.getCollisionManager();\r\n    collisionManager.enabled = true;\r\n    // collisionManager.enabledDrawBoundingBox = true;\r\n    // collisionManager.enabledDebugDraw = true;\r\n  }\r\n\r\n\r\n  protected start(): void {\r\n    this.AudioManager.playSound(Constants.SoundTrack.bgSound);\r\n    this.AudioManager.bgSound.volume = 0.5;\r\n\r\n    cc.view.setResizeCallback(() => {\r\n      this.handleYourOrientation();\r\n    });\r\n  }\r\n\r\n\r\n  private handleYourOrientation() {\r\n    if (cc.view.getFrameSize().width > cc.view.getFrameSize().height) {\r\n      cc.director.loadScene(\"game_Horizontal\");\r\n      Constants.scaleArmy = 0.5;\r\n    } else {\r\n      let width = cc.view.getFrameSize().width;\r\n      let height = cc.view.getFrameSize().height;\r\n      if (width / height < 0.5) {\r\n        // IPX\r\n        cc.director.loadScene(\"game_IPX\");\r\n        Constants.scaleArmy = 0.3;\r\n      } else {\r\n        // other\r\n        if (height / width > 1.5) {\r\n          cc.director.loadScene(\"game_Vertical\");\r\n          Constants.scaleArmy = 0.3;\r\n        } else {\r\n          cc.director.loadScene(\"game_VerticalIpad\");\r\n          Constants.scaleArmy = 0.35;\r\n        }\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n\r\n  public spawnArmy(index: number): void {\r\n    switch (index) {\r\n      case 1:\r\n        !Constants.isStartGame && this.LoadFoodController.increaseFood();\r\n        !Constants.isStartGame && this.SpawnController.SpawnEnemies();\r\n        Constants.isStartGame = true;\r\n\r\n        // spawn army lv1\r\n        if (Constants.food >= 3) {\r\n          Constants.food -= 3;\r\n          this.SpawnController.SpawnPlayerArmy(Constants.ArmySkin.Ally, 1);\r\n        }\r\n\r\n        break;\r\n      case 2:\r\n        // spawn army lv2\r\n        if (Constants.food >= 4 && Constants.isCanBuyArmyLv2) {\r\n          Constants.food -= 4;\r\n          this.SpawnController.SpawnPlayerArmy(Constants.ArmySkin.Ally, 2);\r\n        }\r\n        break;\r\n\r\n      case 3:\r\n        // spawn army lv3\r\n        if (Constants.food >= 5 && Constants.isCanBuyArmyLv3) {\r\n          Constants.food -= 5;\r\n          this.SpawnController.SpawnPlayerArmy(Constants.ArmySkin.Ally, 3);\r\n        }\r\n        break;\r\n      default:\r\n        console.log(\"can not spawn\");\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  protected update(dt: number): void {\r\n    if (Constants.isCollideBase && !this.isCollideBaseFlag) {\r\n      this.isCollideBaseFlag = true;\r\n      this.Boss.active = true;\r\n      this.scheduleOnce(() => {\r\n        this.CTA.active = true;\r\n      }, 1.5)\r\n    }\r\n  }\r\n\r\n}\r\n"]}