{"version":3,"sources":["assets\\Script\\Controller\\KingController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Constants } from \"../Data/constants\";\r\nimport AudioManager from \"../Plugin/AudioManager\";\r\nimport Responsive from \"../Plugin/Responsive\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class KingController extends cc.Component {\r\n    @property(cc.Node)\r\n    Base: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    HealthBar: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    CTA: cc.Node = null;\r\n\r\n    @property(Responsive)\r\n    Responsive: Responsive = null;\r\n\r\n    AudioManager: AudioManager = null;\r\n    spine: sp.Skeleton = null;\r\n    collider: cc.BoxCollider = null;\r\n\r\n    skin: string = \"\";\r\n    speed: number = 25;\r\n\r\n    canRun: boolean = true;\r\n    isBase: boolean = false;\r\n    isLive: boolean = true;\r\n    isAttacking: boolean = false;\r\n    isReadyToFight: boolean = false;\r\n\r\n    pauseFlag: boolean = false;\r\n    rigidbody: cc.RigidBody = null;\r\n\r\n\r\n    protected start(): void {\r\n        this.AudioManager = this.node.parent.parent.parent.parent\r\n            .getChildByName(\"AudioManager\").getComponent(AudioManager);\r\n        this.spine = this.node.getChildByName(\"Spine\").getComponent(sp.Skeleton);\r\n        this.collider = this.getComponent(cc.BoxCollider);\r\n\r\n        // active run to Base\r\n        this.scheduleOnce(() => {\r\n            this.AudioManager.playSound(Constants.SoundTrack.HelpMe);\r\n            this.runToBase();\r\n            this.spine.setAnimation(0, Constants.ArmyAnim.Run, true);\r\n        }, 0.2);\r\n\r\n        this.schedule(() => {\r\n            if (Constants.isLoose || Constants.isWin) return;\r\n            this.playSoundHelpMe();\r\n        }, 2);\r\n    }\r\n\r\n\r\n    private playSoundHelpMe(): void {\r\n        this.AudioManager.playSound(Constants.SoundTrack.HelpMe);\r\n    }\r\n\r\n\r\n    private runToBase(): void {\r\n        let basePos = this.Base.getPosition();\r\n        let currentDevice = this.Responsive.device;\r\n        let calculateTime: number = null;\r\n\r\n        switch (currentDevice) {\r\n            case \"horizontal_IPX\":\r\n                calculateTime = 23;\r\n                break;\r\n            case \"horizontal_Tablet\":\r\n                calculateTime = 13.5;\r\n                break;\r\n            case \"vertical_IPX\":\r\n                calculateTime = 13;\r\n                break;\r\n            case \"vertical_Mobile\":\r\n                calculateTime = 13;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        cc.tween(this.node)\r\n            .to(calculateTime, { x: basePos.x }, { easing: cc.easing.smooth })\r\n            .call(() => {\r\n                // run to base Successfully\r\n                cc.tween(this.node)\r\n                    .to(0.5, { opacity: 0 })\r\n                    .start();\r\n\r\n                if (this.isLive) {\r\n                    Constants.isPauseGame = true;\r\n                    Constants.isWin = true;\r\n                    this.CTA.active = true;\r\n                }\r\n            })\r\n            .start();\r\n    }\r\n\r\n\r\n    private die(): void {\r\n        Constants.isLoose = true;\r\n        Constants.isPauseGame = true;\r\n        this.CTA.active = true;\r\n\r\n        this.node.getComponent(cc.Collider).enabled = false;\r\n        this.node.getComponent(cc.Collider).destroy();\r\n        this.node.getComponent(KingController).enabled = false;\r\n    }\r\n\r\n\r\n    private checkDie(): void {\r\n        this.isLive = false;\r\n        this.spine.timeScale = 0.3;\r\n        this.spine.setAnimation(0, Constants.ArmyAnim.Die, false);\r\n        this.HealthBar.active = false;\r\n\r\n        cc.tween(this.node)\r\n            .to(1, { opacity: 0 })\r\n            .call(() => this.node.destroy())\r\n            .start();\r\n\r\n        this.die();\r\n    }\r\n\r\n\r\n    public decreaseHealth(): void {\r\n\r\n        let random = cc.math.randomRangeInt(0, 4);\r\n\r\n        switch (random) {\r\n            case 0:\r\n                this.spine.node.getChildByName(\"Vfx_1\").getComponent(cc.Animation).play(\"VFx_Bleeding\");\r\n                break;\r\n            case 1:\r\n                this.spine.node.getChildByName(\"Vfx_2\").getComponent(cc.Animation).play(\"VFx_Bleeding\");\r\n                break;\r\n            case 2:\r\n                this.spine.node.getChildByName(\"Vfx_3\").getComponent(cc.Animation).play(\"VFx_Bleeding\");\r\n                break;\r\n            case 3:\r\n                this.spine.node.getChildByName(\"Vfx_4\").getComponent(cc.Animation).play(\"VFx_Bleeding\");\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        this.HealthBar.scaleX -= 0.05;\r\n        this.AudioManager.playSound(Constants.SoundTrack.ArmyLv1HitSound);\r\n    }\r\n\r\n\r\n    protected update(dt: number): void {\r\n        // this.checkPause();\r\n        if (this.HealthBar.scaleX <= 0.1 && this.isLive) {\r\n            this.checkDie();\r\n        }\r\n        // this.checkRun();\r\n    }\r\n}\r\n"]}