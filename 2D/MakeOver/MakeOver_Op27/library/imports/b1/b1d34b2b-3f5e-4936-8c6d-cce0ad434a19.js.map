{"version":3,"sources":["assets\\Script\\Controller\\GamePlay.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Constants } from \"../Data/constants\";\r\nimport AudioManager from \"../Plugin/AudioManager\";\r\nimport { GameController } from \"./GameController\";\r\nimport NodeContainer from \"./NodeContanier\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GamePlay extends cc.Component {\r\n\r\n  @property(AudioManager)\r\n  AudioManager: AudioManager = null;\r\n  @property(GameController)\r\n  GameController: GameController = null;\r\n  @property(NodeContainer)\r\n  NodeContainer: NodeContainer = null;\r\n\r\n\r\n  // state\r\n  checkCleanserFlag: boolean = false;\r\n  checkshowTweezersFlag: boolean = false;\r\n  isRemovingMaggot: boolean = false;\r\n\r\n  \r\n  protected onLoad(): void {\r\n    \r\n  }\r\n\r\n\r\n  protected start(): void {\r\n    this.handleGamePlay();\r\n    this.NodeContainer.Tweezers.opacity = 0;\r\n    this.NodeContainer.Circle_1.active = false;\r\n    this.NodeContainer.Circle_2.active = false;\r\n  }\r\n\r\n\r\n  private handleGamePlay(): void {\r\n    // this.AudioManager.playSound(Constants.SoundTrack.bgSound);\r\n    this.AudioManager.playSound(Constants.SoundTrack.dirtySound);\r\n\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.girlScreamSound)}, 0.5);\r\n    this.scheduleOnce(() => {this.getComponent(cc.Animation).play(\"GamePlay_SwtichStep\")}, 2);\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.wormBgSound)}, 3);\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.moveItemSound); }, 4.3);\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.xitNuocSound); Constants.isCanTouch = true }, 5.8);\r\n    this.scheduleOnce(() => {\r\n      Constants.isRotate \r\n      ? this.NodeContainer.Hand_1.getComponent(cc.Animation).play(\"Hand_HrzHintAnim\")\r\n      : this.NodeContainer.Hand_1.getComponent(cc.Animation).play(\"Hand_VtcHintAnim\");\r\n    }, 7);\r\n  }\r\n\r\n\r\n  public activeCleanSound(): void {\r\n    this.AudioManager.playSound(Constants.SoundTrack.cleanSound);\r\n    this.AudioManager.cleanSound.loop = true;\r\n  }\r\n\r\n\r\n  public handleDoneCleanser(): void {\r\n    if(this.NodeContainer.Scratchable.getComponent(\"Scratchable\").isWin) {\r\n      this.checkCleanserFlag = true;\r\n      this.NodeContainer.Scratchable.active = false;\r\n      this.NodeContainer.Cleanser_Point.active = false;\r\n      this.AudioManager.playSound(Constants.SoundTrack.completeSound);\r\n      this.NodeContainer.Cleanser.getComponent(cc.Animation).play(\"Cleanser_HideAnim\");\r\n      this.NodeContainer.Star_1.getComponent(cc.Animation).play(\"Star_BlinkAnim\");\r\n      this.AudioManager.stopSound(Constants.SoundTrack.cleanSound)\r\n      this.AudioManager.cleanSound.loop = false;\r\n    } \r\n  }\r\n\r\n\r\n  private showTweezers(): void {\r\n    this.checkshowTweezersFlag = true;\r\n    this.scheduleOnce(() => {\r\n      Constants.isDoneCleanser = true;\r\n      this.NodeContainer.Circle_1.active = true;\r\n      this.NodeContainer.Circle_2.active = true;\r\n      this.NodeContainer.Tweezers.getComponent(cc.Animation).play(\"Tweezers_ShowAnim\");\r\n      this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.moveItemSound)}, 0.2);\r\n      this.scheduleOnce(() => {\r\n        this.NodeContainer.Hand_2.active = true;\r\n        Constants.isRotate \r\n        ? this.NodeContainer.Hand_2.getComponent(cc.Animation).play(\"Hand_HrzHintAnim\")\r\n        : this.NodeContainer.Hand_2.getComponent(cc.Animation).play(\"Hand_VtcHintAnim\");\r\n      }, 1.5);\r\n    }, 1.5)\r\n  }\r\n\r\n\r\n  public handleCheckRemoveMaggots(): void {\r\n    let tweezersBdx = this.NodeContainer.Tweezers_HeadPoint.getBoundingBox();\r\n    let points = [this.NodeContainer.Tweezers_InteractPoint1, this.NodeContainer.Tweezers_InteractPoint2];\r\n    for (let i = 0; i < points.length; i++) {\r\n      let PointBdx = points[i].getBoundingBox();\r\n      let pointName = points[i].name;\r\n      if(tweezersBdx.intersects(PointBdx)) {\r\n        this.handleRemoveMaggot(pointName)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  public handleRemoveMaggot(maggotName: string): void {\r\n    this.NodeContainer.Tweezers.opacity = 0;\r\n    this.NodeContainer.Circle_1.active = false;\r\n    this.NodeContainer.Circle_2.active = false;\r\n    this.isRemovingMaggot = true;\r\n    switch (maggotName) {\r\n      case \"Tws_InteractPoint1\":\r\n          Constants.maggotRemoved += 1;\r\n          this.NodeContainer.Spine_Maggot1.setAnimation(0, \"idle01\", false);\r\n          this.NodeContainer.Spine_RMMG1.node.active = true;\r\n          this.NodeContainer.Circle_1.opacity = 0;\r\n          this.scheduleOnce(() => { this.NodeContainer.Spine_Maggot1.node.active = false}, 0.75);\r\n          this.activeRemoveMaggotSound();\r\n          this.setCompleteSpine(this.NodeContainer.Spine_RMMG1);\r\n        break;\r\n        case \"Tws_InteractPoint2\":\r\n          Constants.maggotRemoved += 1;\r\n          this.NodeContainer.Spine_Maggot2.setAnimation(0, \"idle01\", false);\r\n          this.NodeContainer.Spine_RMMG2.node.active = true;\r\n          this.NodeContainer.Circle_2.opacity = 0;\r\n          this.scheduleOnce(() => { this.NodeContainer.Spine_Maggot2.node.active = false}, 0.75);\r\n          this.activeRemoveMaggotSound();\r\n          this.setCompleteSpine(this.NodeContainer.Spine_RMMG2);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  private activeRemoveMaggotSound(): void {\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.nhoMun1Sound);}, 0.75);\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.nhoMun2Sound);}, 1.5);\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.nhoMun2Sound);}, 2.2);\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.nhoMun2Sound);}, 2.8);\r\n    this.scheduleOnce(() => {this.AudioManager.playSound(Constants.SoundTrack.nhoMun3Sound);}, 4);\r\n  }\r\n\r\n\r\n  public setCompleteSpine(spine:sp.Skeleton): void {\r\n    spine.setCompleteListener((trackEntry: sp.spine.TrackEntry) => {\r\n      if(trackEntry.animation.name === \"Action\") {\r\n        this.AudioManager.playSound(Constants.SoundTrack.completeSound);\r\n          this.showTweezers();\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n\r\n  protected update(dt: number): void {\r\n      !this.checkCleanserFlag && this.handleDoneCleanser();\r\n      this.checkCleanserFlag && !this.checkshowTweezersFlag && this.showTweezers();\r\n      this.checkshowTweezersFlag && !this.isRemovingMaggot && this.handleCheckRemoveMaggots();\r\n  }\r\n\r\n}\r\n"]}