{"version":3,"sources":["file:///D:/PA_2024/3D/MergeCraft/MergeCraft_Op7/assets/Script/Controller/TouchAreaController.ts"],"names":["_decorator","Component","Node","Vec3","Constants","NodesController","GameController","AudioManager","IronSource","GamePlay","ccclass","property","TouchAreaController","start","registerEvent","hideMask","on","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","Popup_Btns","forEach","btn","nuggetShoot","CTA_btn","installHandle","isDonePA","isCanTouch","ironSource","isEndGame","isTouching","hint","active","handleIronSourcePlaySound","event","screenPos","getUILocation","pos","convertToLocalLocation","point","setPosition","isMerged","checkMerge","resetNuggetMerge","value","localX","x","node","getPosition","localY","y","result","update","dt","handleMuteSoundIronSource"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec2, EventTouch, Vec3, UITransform } from \"cc\";\r\nimport { Constants } from \"../Data/Constant\";\r\nimport { NodesController } from \"./NodesController\";\r\nimport { GameController } from \"./GameController\";\r\nimport { AudioManager } from \"../Plugin/AudioManager\";\r\nimport { IronSource } from \"../Plugin/IronSource\";\r\nimport { GamePlay } from \"./GamePlay\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"TouchAreaController\")\r\nexport class TouchAreaController extends Component {\r\n  @property(IronSource)\r\n  IronSource: IronSource = null;\r\n  @property(GamePlay)\r\n  GamePlay: GamePlay = null;\r\n  @property(AudioManager)\r\n  AudioManager: AudioManager = null;\r\n  @property(NodesController)\r\n  NodesController: NodesController = null;\r\n  @property(GameController)\r\n  GameController: GameController = null;\r\n\r\n  // state\r\n  pos: Vec3 = null;\r\n\r\n\r\n  isDoneMergeStep1: boolean = false;\r\n  isDoneMergeStep2: boolean = false;\r\n\r\n\r\n  protected start(): void {\r\n    this.registerEvent();\r\n  }\r\n\r\n\r\n  private registerEvent(): void {\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_START, this.touchStart, this);\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_END, this.touchEnd, this);\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\r\n\r\n    this.NodesController.Popup_Btns.forEach(btn => {\r\n      btn.on(Node.EventType.TOUCH_START, this.GamePlay.nuggetShoot, this);\r\n    })\r\n    this.NodesController.CTA_btn.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\r\n\r\n    // mtg & applovin\r\n    // this.NodesController.CTA_overlay.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\r\n  }\r\n\r\n\r\n  private touchStart(): void {\r\n    Constants.isDonePA && this.GameController.installHandle();\r\n    if (!Constants.isCanTouch || Constants.ironSource.isEndGame) return;\r\n    Constants.isTouching = true;    \r\n    this.NodesController.hint.active = false;\r\n    this.IronSource.handleIronSourcePlaySound();\r\n  }\r\n\r\n\r\n  private touchMove(event: EventTouch) {\r\n    if (!Constants.isCanTouch) return;\r\n    const screenPos = event.getUILocation();\r\n    this.pos = this.convertToLocalLocation(screenPos);\r\n    this.NodesController.point.setPosition(this.pos);\r\n\r\n    !Constants.isMerged && this.GamePlay.checkMerge();\r\n  }\r\n\r\n\r\n  private touchEnd(): void {\r\n    if (!Constants.isCanTouch) return;\r\n    Constants.isTouching = false;\r\n    !Constants.isMerged && this.GamePlay.resetNuggetMerge(false);\r\n  }\r\n\r\n\r\n  private convertToLocalLocation(value: Vec2): Vec3 {\r\n    const localX = value.x - 160 - this.node.getPosition().x;\r\n    const localY = value.y - 240 - this.node.getPosition().y;\r\n    const result = new Vec3(localX, localY, 0);\r\n    return result;\r\n  }\r\n\r\n\r\n  protected update(dt: number): void {\r\n    this.IronSource.handleMuteSoundIronSource();\r\n  }\r\n}\r\n"]}