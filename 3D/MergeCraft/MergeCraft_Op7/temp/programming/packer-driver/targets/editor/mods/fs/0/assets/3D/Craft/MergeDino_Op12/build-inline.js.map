{"version":3,"sources":["file:///D:/PA_2024/3D/MergeCraft/MergeCraft_Op7/assets/3D/Craft/MergeDino_Op12/build-inline.js"],"names":["path","require","fs","buildPathCocos","buildPathTarget","exiapiPath","dapiPath","mraidFixPath","mindworkApiPath","tiktokApiPath","ironsourceApiPath","args","process","argv","slice","adsNetwork","undefined","console","log","buildInlineHTML","existsSync","mkdirSync","recursive","htmlFileContent","promises","readFile","replace","dapiContent","addScriptContentToHTML","apiContent2","mraidFixContent","apiContent","injectCustomScript","toString","writeFile","setTimeout","window","boot","CustomCreateScript","scriptElement","document","createElement","removeEventListener","addEventListener","eventName","cb","src","xmlHttp","CustomXMLHttpRequest","prototype","send","open","method","url","self","status","isloaded","jsonExtension","match","imageExtension","audioExtension","response","atob","bundleAsset","fetch","then","res","blob","onload","Uint8Array","from","c","charCodeAt","buffer","setRequestHeader","addScriptToHTML","scriptPath","htmlTag","scriptContent","scriptTag","lastIndex","lastIndexOf","substr","addScriptSourceToHTML","scriptSrc"],"mappings":"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","sourcesContent":["const path = require(\"path\");\r\nconst fs = require('fs')\r\n\r\nconst buildPathCocos = './build/'\r\nconst buildPathTarget = './build-inline/'\r\nconst exiapiPath = './plugin-ads/exitapi.js'\r\nconst dapiPath = './plugin-ads/dapi.js'\r\nconst mraidFixPath = './plugin-ads/fixmraid.js'\r\nconst mindworkApiPath = './plugin-ads/mindworkapi.js'\r\nconst tiktokApiPath = './plugin-ads/playable-sdk.js'\r\nconst ironsourceApiPath = './plugin-ads/ironsource_api.js'\r\n\r\nlet args = process.argv.slice(2);\r\nlet adsNetwork;\r\nif (typeof(args[0]) == undefined) {\r\n    adsNetwork = 'google';\r\n} else {\r\n    adsNetwork = args[0];\r\n}\r\n\r\nconsole.log(`Build html file for ads network ${adsNetwork}\\n`);\r\n\r\nbuildInlineHTML()\r\n\r\nasync function buildInlineHTML(){\r\n    if (!fs.existsSync(buildPathTarget)) fs.mkdirSync(buildPathTarget, { recursive: true });\r\n\r\n    let htmlFileContent = await fs.promises.readFile(`${buildPathCocos}index.html`, 'utf8');\r\n    // Remove CSS & favicon\r\n    htmlFileContent = htmlFileContent.replace(/<link(.+?)\\/>/gs, '')\r\n    \r\n    if (adsNetwork == \"google\") {\r\n        console.log(`--- Add google ads script`);\r\n        // htmlFileContent = await addScriptSourceToHTML(htmlFileContent, 'https://tpc.googlesyndication.com/pagead/gadgets/html5/api/exitapi.js', 'head')\r\n\r\n        let dapiContent = await fs.promises.readFile(`${exiapiPath}`, 'utf8')\r\n        htmlFileContent = await addScriptContentToHTML(htmlFileContent, dapiContent)\r\n    }\r\n\r\n    if (adsNetwork == \"ironsource\") {\r\n        console.log(`--- Add ironsources ads script`);\r\n        let dapiContent = await fs.promises.readFile(`${dapiPath}`, 'utf8')\r\n        htmlFileContent = await addScriptContentToHTML(htmlFileContent, dapiContent)\r\n        let apiContent2 = await fs.promises.readFile(`${ironsourceApiPath}`, 'utf8')\r\n        htmlFileContent = await addScriptContentToHTML(htmlFileContent, apiContent2)\r\n    }\r\n\r\n    if (adsNetwork == \"unity\" || adsNetwork == \"applovin\") {\r\n        console.log(`--- Fix mraid For Unity & Applovin script`);\r\n        let mraidFixContent = await fs.promises.readFile(`${mraidFixPath}`, 'utf8')\r\n        htmlFileContent = await addScriptContentToHTML(htmlFileContent, mraidFixContent)\r\n    }\r\n\r\n    if (adsNetwork == \"mindwork\") {\r\n        console.log(`--- Add mindwork ads script`);\r\n        let apiContent = await fs.promises.readFile(`${mindworkApiPath}`, 'utf8')\r\n        htmlFileContent = await addScriptContentToHTML(htmlFileContent, apiContent)\r\n    }\r\n\r\n    if (adsNetwork == \"tiktok\") {\r\n        console.log(`--- Add tiktok ads script`);\r\n        let apiContent = await fs.promises.readFile(`${tiktokApiPath}`, 'utf8')\r\n        htmlFileContent = await addScriptContentToHTML(htmlFileContent, apiContent, \"body\")\r\n    }\r\n\r\n    htmlFileContent = await addScriptContentToHTML(htmlFileContent, `${injectCustomScript.toString()};injectCustomScript();`, 'body')\r\n    htmlFileContent = htmlFileContent.replace(/<\\/script><script>/g, ';')\r\n\r\n    // add this to the end to increase confusion while reading html file\r\n    //htmlFileContent = await addScriptContentToHTML(htmlFileContent, await bundleAssetToScript(), 'body')\r\n    \r\n    console.log('\\n')\r\n\r\n    htmlFileContent = htmlFileContent.replace(/<\\/script><script>/g, ';')\r\n    await fs.promises.writeFile(`${buildPathTarget}index_${adsNetwork}.html`, htmlFileContent, 'utf8');\r\n    console.log(`Output saved to: ${buildPathTarget}index_${adsNetwork}.html`)\r\n\r\n    // const minifyOptions = {\r\n    //     html: {\r\n    //         removeOptionalTags: false\r\n    //     },\r\n    // };\r\n    // const minifyFileContent = await minify(`${buildPathTarget}index-full.html`, minifyOptions)\r\n\r\n    // await fs.promises.writeFile(`${buildPathTarget}index.html`, minifyFileContent, 'utf8');\r\n    // console.log(`Minify File saved to: ${buildPathTarget}index.html (${await formatBytes(minifyFileContent.length)})`)\r\n\r\n}\r\n\r\nfunction injectCustomScript(){\r\n    setTimeout(window.boot, 1)\r\n\r\n    window.CustomCreateScript = function(){\r\n        var scriptElement = document.createElement('script')\r\n        scriptElement.removeEventListener = function(){}\r\n        scriptElement.addEventListener = function(eventName, cb){\r\n            this.src = ''\r\n            if(eventName === 'load') setTimeout(() => {cb && cb()}, 10)\r\n        }\r\n        return scriptElement\r\n    }\r\n\r\n    var xmlHttp = window.CustomXMLHttpRequest = function(){}\r\n    xmlHttp.prototype.send = function(){}\r\n    xmlHttp.prototype.open = function(method, url){\r\n        const self = this\r\n        this.status = 200\r\n        this.url = url\r\n        this.isloaded = true\r\n        \r\n        const jsonExtension = url.match(/\\.(json)(\\?[a-z0-9=&.]+)?$/)\r\n        const imageExtension = url.match(/\\.(jpe?g|png|svg|bmp|gif)(\\?[a-z0-9=&.]+)?$/)\r\n        const audioExtension = url.match(/\\.(wav|mp3|ogg)(\\?[a-z0-9=&.]+)?$/)\r\n\r\n        if(jsonExtension) {\r\n            this.response = atob(window.bundleAsset[url])\r\n        }\r\n        else if(imageExtension){\r\n            this.isloaded = false\r\n            fetch(window.bundleAsset[url]).then(res => res.blob()).then(res => {\r\n                self.response = res\r\n                self.onload && self.onload()\r\n            })\r\n        }\r\n        else if(audioExtension){\r\n            this.response = Uint8Array.from(atob(window.bundleAsset[url]), c => c.charCodeAt(0)).buffer\r\n        }\r\n    }\r\n    xmlHttp.prototype.setRequestHeader = function(){}\r\n    xmlHttp.prototype.send = function(){this.isloaded && this.onload && this.onload()}\r\n}\r\nasync function addScriptToHTML(htmlFileContent, scriptPath, htmlTag = 'head'){\r\n    const scriptContent = await fs.promises.readFile(scriptPath, 'utf8');\r\n    return addScriptContentToHTML(htmlFileContent, scriptContent, htmlTag)\r\n    \r\n} \r\nasync function addScriptContentToHTML(htmlFileContent, scriptContent, htmlTag = 'head', scriptTag = 'script'){\r\n    // console.log(`Add ${scriptTag} to HTML <${htmlTag}>: ` + (scriptContent.substr(0, 50)))\r\n    const lastIndex = htmlFileContent.lastIndexOf(`</${htmlTag}>`);\r\n    return `${htmlFileContent.substr(0, lastIndex)}<${scriptTag}>${scriptContent}</${scriptTag}>${htmlFileContent.substr(lastIndex)}`\r\n}\r\nasync function addScriptSourceToHTML(htmlFileContent, scriptSrc, htmlTag = 'head', scriptTag = 'script'){\r\n    // console.log(`Add ${scriptTag} to HTML <${htmlTag}>: ` + scriptSrc)\r\n    const lastIndex = htmlFileContent.lastIndexOf(`</${htmlTag}>`);\r\n    return `${htmlFileContent.substr(0, lastIndex)}<${scriptTag} type=\"text/javascript\" src=\"${scriptSrc}\"></${scriptTag}>${htmlFileContent.substr(lastIndex)}`\r\n}"]}