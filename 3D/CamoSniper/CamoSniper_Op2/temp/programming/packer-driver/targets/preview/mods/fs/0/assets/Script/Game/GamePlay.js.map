{"version":3,"sources":["file:///D:/PA_2024/3D/CamoSniper/CamoSniper_Op2/assets/Script/Game/GamePlay.ts"],"names":["_decorator","Animation","Component","Camera","tween","Vec3","SkeletalAnimation","UITransform","GameController","AudioManager","Constants","UIController","ccclass","property","GamePlay","start","Aim","active","EnemyStatus","activeAimTargets","index","AimTargets","length","node","getComponent","play","shoot","isCanClick","countShoot","Gun_Blast","setAnimation","playSound","SoundTrack","k98Sound","BaseGun","scheduleOnce","pauseSound","Gun","background","to","position","reloadGun","handleZoomCamera","isZoomIn","fov","checkHitEnemy","pointBdx","point","getBoundingBoxToWorld","Enemies","enemyBdx","intersects","isHit","enemyLife","EnemyCounts","getChildByName","countScore","activeCombo","splice","find","item","shootMiss","resetHitStatus","ShootMiss","score","GreatSound1","Combo","setSkin","GreatSound2","GreatSound3","handleMuteSoundIronSource","ironSource","State","parseInt","localStorage","getItem","SoundState","isEndGame","stopAllSound","handleIronSourcePlaySound","isPlayBgSound","bgSound","update","dt"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Component, Node, Camera, tween, Vec2, Vec3, director, SkeletalAnimation, Rect, UITransform, math } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { GameController } from './GameController';\nimport { AudioManager } from './AudioManager';\nimport { Constants } from '../Data/constants';\nimport { UIController } from './UIController';\n\n@ccclass('GamePlay')\nexport class GamePlay extends Component {\n    // Component\n    @property(UIController)\n    UIController: UIController = null;\n    @property(GameController)\n    GameController: GameController = null;\n    @property(AudioManager)\n    AudioManager: AudioManager = null;\n\n    @property(Camera)\n    Camera: Camera = null;\n\n\n    isHit: boolean[] = [false, false, false, false, false];\n\n    protected start(): void {\n        // this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        this.UIController.Aim.active = false;\n        this.UIController.EnemyStatus.active = false;\n    }\n\n\n    public activeAimTargets(): void {\n        for (let index = 0; index < this.UIController.AimTargets.length; index++) {\n            const node = this.UIController.AimTargets[index];\n            node.getComponent(Animation).play();\n        }\n    }\n\n\n    public shoot(): void {\n        Constants.isCanClick = false;\n        Constants.countShoot += 1;\n        this.UIController.Gun_Blast.node.active = true;\n        this.UIController.Gun_Blast.setAnimation(0, \"2\", false);\n        this.AudioManager.playSound(Constants.SoundTrack.k98Sound);\n        this.UIController.BaseGun.getComponent(Animation).play(\"Gun_ShootAnim\");\n        this.scheduleOnce(() => {\n            this.AudioManager.pauseSound(Constants.SoundTrack.k98Sound);\n            this.UIController.Aim.active = false;\n            this.UIController.Gun.active = true;\n            tween(this.UIController.background)\n            .to(0.2, {position: new Vec3(0,0,0)})\n            .start()\n        }, 0.8);\n        this.scheduleOnce(() => { this.reloadGun() }, 1);\n    }\n\n\n    public handleZoomCamera(isZoomIn: boolean) {\n        let fov: number;\n        isZoomIn ? fov = 9 : fov = 30;\n        tween(this.UIController.Camera)\n            .to(0.2, { fov: fov })\n            .start();\n    }\n\n\n    private reloadGun(): void {\n        this.handleZoomCamera(false);\n        this.AudioManager.playSound(Constants.SoundTrack.k98Sound);\n        this.UIController.BaseGun.getComponent(Animation).play(\"Gun_ReloadAnim\");\n        this.UIController.Gun.getComponent(SkeletalAnimation).play(\"reload\");\n        this.scheduleOnce(() => { Constants.isCanClick = true; }, 1)\n    }\n\n\n    public checkHitEnemy(): void {\n        let pointBdx: Rect = this.UIController.point.getComponent(UITransform).getBoundingBoxToWorld();\n        for (let index = 0; index < this.UIController.Enemies.length; index++) {\n            const node = this.UIController.Enemies[index];\n            let enemyBdx = node.getComponent(UITransform).getBoundingBoxToWorld();\n            if (pointBdx.intersects(enemyBdx)) {\n                \n                node.active = false;\n                this.isHit[index] = true;\n                \n                let enemyLife = this.UIController.EnemyCounts[index];\n                enemyLife.getChildByName(\"ic_enemy_off\").active = true;\n                Constants.countScore += 1;\n\n                this.activeCombo(Constants.countScore)\n                this.UIController.EnemyCounts.splice(index, 1);\n                this.UIController.Enemies.splice(index, 1);\n                this.UIController.AimTargets.splice(index, 1);\n            }\n        }\n\n        let isHit = this.isHit.find(item => item === true);\n        !isHit && this.shootMiss();\n        this.resetHitStatus();\n    }\n\n\n    private resetHitStatus(): void {\n        this.isHit[0] = false;\n        this.isHit[1] = false;\n        this.isHit[2] = false;\n        this.isHit[3] = false;\n        this.isHit[4] = false;\n    }\n\n\n    private shootMiss(): void {\n        this.UIController.ShootMiss.getComponent(Animation).play(\"ShootMiss_Anim\");\n    }\n\n\n    private activeCombo(score: number): void {\n        switch (score) {\n            case 1:\n                this.AudioManager.playSound(Constants.SoundTrack.GreatSound1);\n                this.UIController.Combo.setSkin(\"Combo 1\");\n                this.UIController.Combo.setAnimation(0, \"action\", false);\n                break;\n            case 2:\n                this.AudioManager.playSound(Constants.SoundTrack.GreatSound2);\n                this.UIController.Combo.setSkin(\"Combo 2\");\n                this.UIController.Combo.setAnimation(0, \"action\", false);\n                break;\n            case 3:\n                this.AudioManager.playSound(Constants.SoundTrack.GreatSound3);\n                this.UIController.Combo.setSkin(\"Combo 3\");\n                this.UIController.Combo.setAnimation(0, \"action\", false);\n                break;\n            default:\n                break;\n        }\n    }\n\n\n    private handleMuteSoundIronSource(): void {\n        Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n        if (Constants.ironSource.State) {\n            if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n                Constants.ironSource.SoundState = true;\n            }\n\n            if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n                Constants.ironSource.SoundState = false;\n                this.AudioManager.stopAllSound();\n            }\n        }\n    }\n\n\n    public handleIronSourcePlaySound(): void {\n        if (Constants.ironSource.isPlayBgSound) {\n            return;\n        }\n\n        if (Constants.ironSource.SoundState) {\n            this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        }\n\n        Constants.ironSource.isPlayBgSound = true;\n    }\n\n\n    protected update(dt: number): void {\n        // ironsource\n        this.handleMuteSoundIronSource();\n    }\n}\n"]}