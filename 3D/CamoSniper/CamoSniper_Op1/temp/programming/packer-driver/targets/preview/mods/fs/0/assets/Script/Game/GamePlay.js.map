{"version":3,"sources":["file:///D:/PA_2024/3D/CamoSniper/CamoSniper_Op1/assets/Script/Game/GamePlay.ts"],"names":["_decorator","Animation","Component","Node","Camera","tween","Vec3","director","GameController","AudioManager","Constants","UIController","ccclass","property","GamePlay","start","playSound","SoundTrack","bgSound","Gun","active","registerEvent","HideMask","on","EventType","TOUCH_START","handlePlayGame","isToStore","installHandle","isCanClick","ironSource","isEndGame","isFirstClick","handleIronSourcePlaySound","getComponent","play","Aim","k98Sound","Bullets","Text_1","Text_2","scheduleOnce","pauseSound","reloadGun","Canvas","background","to","scale","call","BaseGun","node","loadScene","handleMuteSoundIronSource","State","parseInt","localStorage","getItem","SoundState","stopAllSound","isPlayBgSound","update","dt"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Component, Node, Camera, tween, Vec2, Vec3, director } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { GameController } from './GameController';\nimport { AudioManager } from './AudioManager';\nimport { Constants } from '../Data/constants';\nimport { UIController } from './UIController';\n\n@ccclass('GamePlay')\nexport class GamePlay extends Component {\n    // Component\n    @property(UIController)\n    UIController: UIController = null;\n    @property(GameController)\n    GameController: GameController = null;\n    @property(AudioManager)\n    AudioManager: AudioManager = null;\n    \n    @property(Camera)\n    Camera: Camera = null;\n\n\n    protected start(): void {\n        this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        this.UIController.Gun.active = false;\n\n        this.registerEvent();\n    }\n\n\n    private registerEvent(): void {\n        this.UIController.HideMask.on(Node.EventType.TOUCH_START, this.handlePlayGame, this);\n    }\n\n\n    private handlePlayGame(): void {\n        Constants.isToStore && this.GameController.installHandle();\n        if(!Constants.isCanClick || Constants.ironSource.isEndGame) return;\n        Constants.isFirstClick && this.GameController.installHandle();\n        if(Constants.isFirstClick) return;\n\n        this.handleIronSourcePlaySound();\n        Constants.isCanClick = false;\n        Constants.isFirstClick = true;\n        this.Camera.getComponent(Animation).play(\"Camera_ShakeAnim\");\n        this.UIController.Aim.getComponent(Animation).play(\"Aim_MissShootAnim\");\n        this.AudioManager.playSound(Constants.SoundTrack.k98Sound);\n        this.UIController.Aim.getComponent(Animation).play(\"Aim_WrongAnim\");\n        this.UIController.Bullets[0].active = false;\n        this.UIController.Text_1.active = false;\n        this.UIController.Text_2.active = true;\n        this.scheduleOnce(() => {this.AudioManager.pauseSound(Constants.SoundTrack.k98Sound);}, 0.8);\n        this.scheduleOnce(() => {this.reloadGun()}, 1.5);\n    }\n\n\n    private reloadGun(): void {\n        this.UIController.Canvas.getComponent(Animation).play(\"Canvas_HideUI\");\n\n        tween(this.UIController.background)\n        .to(0.2, {scale: new Vec3(0.7, 0.7, 0.7)})\n        .call(() => {\n            this.AudioManager.playSound(Constants.SoundTrack.k98Sound);\n            this.UIController.BaseGun.getComponent(Animation).play(\"Gun_ReloadAnim\");\n            this.UIController.Gun.active = true;\n        })\n        .start();\n\n        tween(this.UIController.node)\n        .to(0.2, {scale: new Vec3(0.7, 0.7, 0.7)})\n        .start();\n\n        this.scheduleOnce(() => {\n            Constants.isCanClick = true;\n            director.loadScene(\"Scene_NextMap\")\n        }, 1.5);\n    }\n\n\n    private handleMuteSoundIronSource(): void {\n        Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n        if (Constants.ironSource.State) {\n            if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n                Constants.ironSource.SoundState = true;\n            }\n\n            if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n                Constants.ironSource.SoundState = false;\n                this.AudioManager.stopAllSound();\n            }\n        }\n    }\n\n\n    public handleIronSourcePlaySound(): void {\n        if (Constants.ironSource.isPlayBgSound) {\n          return;\n        }\n    \n        if (Constants.ironSource.SoundState) {\n          this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        }\n    \n        Constants.ironSource.isPlayBgSound = true;\n      }\n\n\n    protected update(dt: number): void {\n        // ironsource\n        // this.handleMuteSoundIronSource();\n    }\n}\n"]}