{"version":3,"sources":["file:///D:/PA_2024/3D/MergeRobo/MergeRobo_Op8/assets/assets/script/orbitCamera.ts"],"names":["_decorator","Component","Node","math","CameraComponent","ModelComponent","geometry","sys","ccclass","property","RAD_TO_DEG","Math","PI","DEG_TO_RAD","OrbitCamera","Vec3","Quat","distance","_targetDistance","value","_clampDistance","pitch","_targetPitch","_clampPitchAngle","yaw","_targetYaw","diff","_yaw","reminder","pivotPoint","_pivotPoint","copy","focus","focusEntity","_modelsAdded","_buildAabb","halfExtents","_modelsAabb","radius","max","x","y","z","sin","camera","fov","_removeInertia","center","resetAndLookAtPoint","resetPoint","lookAtPoint","node","setPosition","lookAt","distanceBetween","subtract","length","cameraQuat","getRotation","_calcYaw","_calcPitch","_updatePosition","resetAndLookAtEntity","entity","reset","start","self","onWindowResize","_checkAspectRatio","isBrowser","window","addEventListener","aabb","_pitch","setRotationFromEuler","_distance","frameOnStart","getPosition","update","dt","t","inertiaFactor","min","lerp","nodeLight","position","forward","scaleAndAdd","height","cc","winSize","width","fovAxis","FOVAxis","VERTICAL","HORIZONTAL","quat","transformedForward","transformVector","FORWARD","atan2","distanceMax","clamp","distanceMin","pitchAngleMax","pitchAngleMin","quatWithoutYaw","yawOffset","fromEuler","multiply","q","vec","res","undefined","qx","qy","qz","qw","w","ix","iy","iz","iw","modelsAdded","models","getComponentsInChildren","i","model","bound","modelBounds","merge"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, math, CameraComponent, ModelComponent, geometry, Quat, sys } from 'cc';\nconst { ccclass, property } = _decorator;\n\nconst RAD_TO_DEG = 180 / Math.PI;\nconst DEG_TO_RAD =  Math.PI / 180;\n@ccclass('OrbitCamera')\nexport class OrbitCamera extends Component {\n    \n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n    @property\n    distanceMax = 0;\n    @property\n    distanceMin = 0;\n    @property\n    pitchAngleMax = 90;\n    @property\n    pitchAngleMin = -90;\n    @property\n    inertiaFactor = 0;\n    @property(Node)\n    focusEntity: Node = null;\n    @property\n    frameOnStart = true;\n    @property(CameraComponent)\n    camera: CameraComponent = null;\n    @property(Node)\n    nodeLight: Node = null;\n\n    get distance() {\n        return this._targetDistance;\n    }\n    set distance(value: number) {\n        this._targetDistance = this._clampDistance(value);\n    }\n\n    get pitch () {\n        return this._targetPitch;\n    }\n    set pitch(value) {\n\n        this._targetPitch = this._clampPitchAngle(value);\n    }\n\n    get yaw () {\n        return this._targetYaw;\n    }\n    set yaw (value) {\n        this._targetYaw = value;\n\n        // Ensure that the yaw takes the shortest route by making sure that\n        // the difference between the targetYaw and the actual is 180 degrees\n        // in either direction\n        var diff = this._targetYaw - this._yaw;\n        var reminder = diff % 360;\n        if (reminder > 180) {\n            this._targetYaw = this._yaw - (360 - reminder);\n        } else if (reminder < -180) {\n            this._targetYaw = this._yaw + (360 + reminder);\n        } else {\n            this._targetYaw = this._yaw + reminder;\n        }\n    }\n\n    get pivotPoint () {\n        return this._pivotPoint;\n    }\n\n    set pivotPoint (value) {\n        math.Vec3.copy(this._pivotPoint, value);\n    }\n\n    _targetDistance: number = 0;\n    _targetPitch: number = 0;\n    _targetYaw: number = 0;\n    _yaw: number = 0;\n    _pivotPoint: math.Vec3 = new math.Vec3();\n    distanceBetween = new math.Vec3();\n    quatWithoutYaw = new math.Quat();\n    yawOffset = new math.Quat();\n    _pitch: number = 0;\n    _distance: number = 0; \n    _modelsAabb: any;\n    _modelsAdded: number = 0;\n    isLock: boolean = false;\n\n    focus(focusEntity) {\n        // Calculate an bounding box that encompasses all the models to frame in the camera view\n        this._modelsAdded = this._buildAabb(focusEntity, 0);\n    \n        var halfExtents = this._modelsAabb.halfExtents;\n        var radius = Math.max(halfExtents.x, Math.max(halfExtents.y, halfExtents.z));\n    \n        this.distance = (radius * 1.5) / Math.sin(0.5 * this.camera.fov * DEG_TO_RAD);\n    \n        this._removeInertia();\n    \n        math.Vec3.copy(this._pivotPoint, this._modelsAabb.center);\n    }\n\n    resetAndLookAtPoint (resetPoint, lookAtPoint) {\n        math.Vec3.copy(this.pivotPoint, lookAtPoint);\n        this.node.setPosition(resetPoint);\n    \n        this.node.lookAt(lookAtPoint);\n    \n        var distance = this.distanceBetween;\n        math.Vec3.subtract(distance, lookAtPoint, resetPoint);\n        this.distance = distance.length();\n    \n        math.Vec3.copy(this.pivotPoint, lookAtPoint);\n    \n        var cameraQuat = this.node.getRotation();\n        this.yaw = this._calcYaw(cameraQuat);\n        this.pitch = this._calcPitch(cameraQuat, this.yaw);\n    \n        this._removeInertia();\n        this._updatePosition();\n    }\n\n    resetAndLookAtEntity (resetPoint, entity) {\n        this._modelsAdded = this._buildAabb(entity, 0);\n        this.resetAndLookAtPoint(resetPoint, this._modelsAabb.center);\n    }\n\n    reset (yaw, pitch, distance) {\n        this.pitch = pitch;\n        this.yaw = yaw;\n        this.distance = distance;\n    \n        this._removeInertia();\n    }\n\n    start () {\n        var self = this;\n        var onWindowResize = function () {\n            self._checkAspectRatio();\n        };\n        \n        if (sys.isBrowser) {\n            window.addEventListener('resize', onWindowResize, true);\n        }\n\n        this._checkAspectRatio();\n    \n        // Find all the models in the scene that are under the focused entity\n        this._modelsAabb = new geometry.aabb();\n        this._modelsAdded = this._buildAabb(this.focusEntity, 0);\n    \n        this.node.lookAt(this._modelsAabb.center);\n    \n        this._pivotPoint = new math.Vec3();\n        math.Vec3.copy(this._pivotPoint, this._modelsAabb.center);\n    \n        // Calculate the camera euler angle rotation around x and y axes\n        // This allows us to place the camera at a particular rotation to begin with in the scene\n        var cameraQuat = this.node.getRotation();\n    \n        // Preset the camera\n        this._yaw = this._calcYaw(cameraQuat);\n        this._pitch = this._clampPitchAngle(this._calcPitch(cameraQuat, this._yaw));\n        this.node.setRotationFromEuler(this._pitch, this._yaw, 0);\n    \n        this._distance = 0;\n    \n        this._targetYaw = this._yaw;\n        this._targetPitch = this._pitch;\n    \n        // If we have ticked focus on start, then attempt to position the camera where it frames\n        // the focused entity and move the pivot point to entity's position otherwise, set the distance\n        // to be between the camera position in the scene and the pivot point\n        if (this.frameOnStart) {\n            this.focus(this.focusEntity);\n        } else {\n            var distanceBetween = new math.Vec3();\n            math.Vec3.subtract(distanceBetween,this.node.getPosition(), this._pivotPoint);\n            this._distance = this._clampDistance(distanceBetween.length());\n        }\n    \n        this._targetDistance = this._distance;\n        //this._distance = this.distanceMin;\n        this._distance = this._clampDistance(this._distance);\n        this._pitch = this._clampPitchAngle(this._pitch);\n        if (this.frameOnStart) {\n            this.focus(this.focusEntity);\n        } else {\n            this.resetAndLookAtEntity(this.node.getPosition(), this.focusEntity);\n        }\n    }\n\n    update (dt) {\n        // // Add inertia, if any\n        \n        var t = this.inertiaFactor === 0 ? 1 : Math.min(dt / this.inertiaFactor, 1);\n        this._distance = math.lerp(this._distance, this._targetDistance, t);\n        this._yaw = math.lerp(this._yaw, this._targetYaw, t);\n        this._pitch = math.lerp(this._pitch, this._targetPitch, t);\n    \n        this._updatePosition();\n    }\n\n    _updatePosition () {\n        // Work out the camera position based on the pivot point, pitch, yaw and distance\n        this.node.setPosition(0, 0, 0);\n        this.node.setRotationFromEuler(this._pitch, this._yaw, 0);\n        \n        this.nodeLight.setRotationFromEuler(this._pitch, this._yaw, 0);\n    \n        var position = this.node.getPosition();\n        math.Vec3.copy(position, this.node.forward);\n        math.Vec3.scaleAndAdd(position, this.pivotPoint, position, -this._distance);\n        this.node.setPosition(position);\n    }\n    \n    \n    _removeInertia () {\n        this._yaw = this._targetYaw;\n        this._pitch = this._targetPitch;\n        this._distance = this._targetDistance;\n    }\n    \n    _checkAspectRatio () {\n        var height = cc.winSize.height;\n        var width = cc.winSize.width;\n    \n        // Match the axis of FOV to match the aspect ratio of the canvas so\n        // the focused entities is always in frame\n        this.camera.fovAxis = height > width ? CameraComponent.FOVAxis.VERTICAL : CameraComponent.FOVAxis.HORIZONTAL;\n    }\n     \n    _calcYaw (quat) {\n        var transformedForward = new math.Vec3();\n        this.transformVector(quat, math.Vec3.FORWARD, transformedForward);\n    \n        return Math.atan2(-transformedForward.x, -transformedForward.z) * RAD_TO_DEG;\n    }\n     \n    _clampDistance (distance) {\n        if (this.distanceMax > 0) {\n            return math.clamp(distance, this.distanceMin, this.distanceMax);\n        }\n        return Math.max(distance, this.distanceMin);\n    \n    }\n    \n    _clampPitchAngle (pitch) {\n        // Negative due as the pitch is inversed since the camera is orbiting the entity\n        return math.clamp(pitch, -this.pitchAngleMax, -this.pitchAngleMin);\n    }\n\n    _calcPitch (quat, yaw) {\n        var quatWithoutYaw = this.quatWithoutYaw;\n        var yawOffset = this.yawOffset;\n    \n        math.Quat.fromEuler(yawOffset, 0, -yaw, 0);\n        math.Quat.multiply(quatWithoutYaw, yawOffset, quat);\n    \n        var transformedForward = new math.Vec3();\n    \n        this.transformVector(quatWithoutYaw, math.Vec3.FORWARD, transformedForward);\n    \n        return Math.atan2(transformedForward.y, -transformedForward.z) * RAD_TO_DEG;\n    }\n\n    transformVector(q, vec, res) {\n        if (res === undefined) {\n            res = new math.Vec3();\n        }\n\n        var x = vec.x, y = vec.y, z = vec.z;\n        var qx = q.x, qy = q.y, qz = q.z, qw = q.w;\n\n        // calculate quat * vec\n        var ix = qw * x + qy * z - qz * y;\n        var iy = qw * y + qz * x - qx * z;\n        var iz = qw * z + qx * y - qy * x;\n        var iw = -qx * x - qy * y - qz * z;\n\n        // calculate result * inverse quat\n        res.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n        res.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n        res.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n\n        return res;\n    }\n\n    _buildAabb (entity, modelsAdded) {\n        let models: ModelComponent[] = entity.getComponentsInChildren(ModelComponent);\n        for (let i = 0; i < models.length; i++) {\n            if (!models[i].model) return;\n\n            let bound = models[i].model.modelBounds;\n            if (modelsAdded === 0) {\n                this._modelsAabb.copy(bound);\n            } else {\n                geometry.aabb.merge(this._modelsAabb, this._modelsAabb, bound);\n            }\n            modelsAdded += 1;\n        }\n    \n        return modelsAdded;\n    };\n}\n"]}