{"version":3,"sources":["file:///D:/PA_2024/3D/MergeRobo/MergeRobo_Op8/assets/assets/script/orbitCameraInputMouse.ts"],"names":["_decorator","Component","math","systemEvent","SystemEvent","CameraComponent","EventMouse","view","OrbitCamera","ccclass","property","OrbitCameraInputMouse","Vec2","Vec3","start","orbitCamera","distance","onDestroy","_removeEvents","onEnable","_addEvents","onDisable","on","EventType","MOUSE_WHEEL","onMouseWheel","MOUSE_LEAVE","onMouseOut","off","pan","screenPoint","fromWorldPoint","toWorldPoint","worldDiff","camera","screenToWorld","getLocationX","getLocationY","lastPoint","x","y","subtract","pivotPoint","add","onMouseDown","event","getButton","BUTTON_LEFT","lookButtonDown","BUTTON_MIDDLE","BUTTON_RIGHT","panButtonDown","onMouseUp","onMouseMove","pitch","getDeltaY","orbitSensitivity","yaw","getDeltaX","set","console","log","size","getCanvasSize","center","width","height","touchPos","_x","_y","isLock","wheel","getScrollY","distanceSensitivity","update","deltaTime"],"mappings":"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","sourcesContent":["import { Vec2 } from 'cc';\nimport { _decorator, Component, Node, math, systemEvent, SystemEvent, CameraComponent, EventMouse, Vec3, cclegacy, view } from 'cc';\nimport { OrbitCamera } from './orbitCamera';\nconst { ccclass, property } = _decorator;\n\n@ccclass('OrbitCameraInputMouse')\nexport class OrbitCameraInputMouse extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n    @property\n    orbitSensitivity = 0.3;\n    @property\n    distanceSensitivity = 0.15;\n    @property(OrbitCamera)\n    orbitCamera: OrbitCamera = null;\n    @property(CameraComponent)\n    camera: CameraComponent = null;\n\n    lookButtonDown: boolean = false;\n    panButtonDown: boolean = false;\n    lastPoint = new math.Vec2();\n    fromWorldPoint = new math.Vec3();\n    toWorldPoint = new math.Vec3();\n    worldDiff = new math.Vec3();\n    center = null;\n    touchPos = null;\n\n\n    start () {\n        // Your initialization goes here.\n\n        this.orbitCamera.distance = 200;\n        //最多300\n    }\n\n    onDestroy () {\n\t\tthis._removeEvents();\n\t}\n\n\tonEnable () {\n\t\tthis._addEvents();\n\t}\n\n\tonDisable () {\n        this._removeEvents();\n    }\n    \n    private _addEvents () {\n\t\tsystemEvent.on(SystemEvent.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\n\t\t// systemEvent.on(SystemEvent.EventType.MOUSE_MOVE, this.onMouseMove, this);\n\t\t// systemEvent.on(SystemEvent.EventType.MOUSE_UP, this.onMouseUp, this);\n        // systemEvent.on(SystemEvent.EventType.MOUSE_DOWN, this.onMouseDown, this);\n        systemEvent.on(SystemEvent.EventType.MOUSE_LEAVE, this.onMouseOut, this);\n\t}\n\n\tprivate _removeEvents () {\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\n\t\t// systemEvent.off(SystemEvent.EventType.MOUSE_MOVE, this.onMouseMove, this);\n\t\t// systemEvent.off(SystemEvent.EventType.MOUSE_UP, this.onMouseUp, this);\n\t\t// systemEvent.off(SystemEvent.EventType.MOUSE_DOWN, this.onMouseDown, this);\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_LEAVE, this.onMouseOut, this);\n\t}\n    \n    pan (screenPoint) {\n        var fromWorldPoint = this.fromWorldPoint;\n        var toWorldPoint = this.toWorldPoint;\n        var worldDiff = this.worldDiff;\n    \n        // For panning to work at any zoom level, we use screen point to world projection\n        // to work out how far we need to pan the pivotEntity in world space\n        var distance = this.orbitCamera.distance;\n    \n        this.camera.screenToWorld(new math.Vec3(screenPoint.getLocationX(), screenPoint.getLocationY(), distance), fromWorldPoint);\n        this.camera.screenToWorld(new math.Vec3(this.lastPoint.x, this.lastPoint.y, distance), toWorldPoint);\n    \n        math.Vec3.subtract(worldDiff, toWorldPoint, fromWorldPoint);\n    \n        this.orbitCamera.pivotPoint.add(worldDiff);\n    };\n    \n    \n    onMouseDown (event) {\n        switch (event.getButton()) {\n            case EventMouse.BUTTON_LEFT:\n                this.lookButtonDown = true;\n                break;\n            case EventMouse.BUTTON_MIDDLE:\n            case EventMouse.BUTTON_RIGHT:\n                this.panButtonDown = true;\n                break;\n        }\n    };\n    \n    \n    onMouseUp (event) {\n        switch (event.getButton()) {\n            case EventMouse.BUTTON_LEFT:\n                this.lookButtonDown = false;\n                break;\n            case EventMouse.BUTTON_MIDDLE:\n            case EventMouse.BUTTON_RIGHT:\n                this.panButtonDown = false;\n                break;\n        }\n    };\n    \n    \n    onMouseMove (event: EventMouse) {\n        if (this.lookButtonDown) {\n            this.orbitCamera.pitch -= event.getDeltaY() * this.orbitSensitivity;\n            this.orbitCamera.yaw -= event.getDeltaX() * this.orbitSensitivity;\n    \n        } else if (this.panButtonDown) {\n            this.pan(event);\n        }\n    \n        this.lastPoint.set(event.getLocationX(), event.getLocationY());\n    }\n    \n    \n    onMouseWheel (event) {\n        console.log(\"###onMouseWheel\", event);\n        let size = view.getCanvasSize();\n        this.center = {x: size.width/2, y: size.height/2};\n        this.touchPos = {x: event._x, y: event._y};\n\n        if (this.orbitCamera.isLock) {\n            return;\n        }\n\n        let wheel = 0;\n        if (event.getScrollY() > 0) {\n            wheel = -1 * -2;\n            // console.log(\"放大\");\n        } else if (event.getScrollY() < 0) {\n            wheel = +1 * -2;\n            // console.log(\"缩小\");\n        }\n\n        // console.log(\"wheel: \", wheel, \"this.distanceSensitivity: \",this.distanceSensitivity, \"this.orbitCamera.distance\",  this.orbitCamera.distance );\n\n        this.orbitCamera.distance -= wheel * this.distanceSensitivity * (this.orbitCamera.distance * 0.1);       \n        //event.event.preventDefault();\n    }\n    \n    onMouseOut (event) {\n        this.lookButtonDown = false;\n        this.panButtonDown = false;\n    }\n    \n    update (deltaTime: number) {\n        // Your update function goes here.\n    }\n}\n"]}