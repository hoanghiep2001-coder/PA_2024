{"version":3,"sources":["file:///D:/PA_2024/3D/CatEscape/CatEscape_OP17_1/assets/Script/Game/BossAction.ts"],"names":["_decorator","Component","Node","tween","Quat","Vec3","SkeletalAnimation","Collider","Constants","Game","AudioManager","ccclass","property","BossAction","start","node","name","runTweenOfBossFirstScene","runTweenOfBossSecondScene","collide","getComponent","handleCollide","tweenState","by","position","to","rotation","fromEuler","union","repeatForever","on","e","otherCollider","laser","isElectricFlag","die","vision","active","stop","play","playSound","SoundTrack","electric2Sound","isCatCatched","ironSource","isEndGame","isStopFlag","scheduleOnce","fakeCat","catAngrySound","EndGame","update","dt","isCatched","isCatLive","bossCatchedName"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, tween, Quat, ICollisionEvent, Vec3, Tween, TweenAction, TweenSystem, SkeletalAnimation, RigidBody, Collider } from \"cc\";\nimport { Constants } from \"../Data/Constant\";\nimport { Game } from \"./Game\";\nimport AudioManager from \"../Plugin/AudioManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"BossAction\")\nexport class BossAction extends Component {\n  @property(AudioManager)\n  AudioManager: AudioManager = null;\n  @property(Game)\n  Game: Game = null;\n  @property(Node)\n  fakeCat: Node = null;\n  @property(Node)\n  vision: Node = null;\n\n  tweenState = null;\n  isElectricFlag: boolean = false;\n  isStopFlag: boolean = false;\n  rigidbody: RigidBody = null;\n  collide: Collider = null;\n\n  protected start(): void {\n    \n    this.node.name === \"Boss\" && this.runTweenOfBossFirstScene();\n    this.node.name === \"Boss_2\" && this.runTweenOfBossSecondScene();\n   \n    this.collide = this.getComponent(Collider);\n    this.handleCollide();\n  }\n\n\n  private runTweenOfBossFirstScene(): void {\n    this.tweenState = tween(this.node)\n    .by(3, { position: new Vec3(6, 0, 0) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, -90, 0) })\n    .by(3, { position: new Vec3(-6, 0, 0) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, 90, 0) })\n    .union()\n    .repeatForever()\n    .start();\n  }\n\n  private runTweenOfBossSecondScene(): void {\n    this.tweenState = tween(this.node)\n    .by(3, { position: new Vec3(0, 0, 6) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, 180, 0) })\n    .by(3, { position: new Vec3(0, 0, -6) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, 0, 0) })\n    .union()\n    .repeatForever()\n    .start();\n  }\n\n\n  private handleCollide(): void {\n    if(this.collide) {\n      this.collide.on(\"onCollisionEnter\", (e: ICollisionEvent) => {\n        if(e.otherCollider.node.name === \"Electro_vfx_mesh\" && Constants.laser && !this.isElectricFlag) {\n          this.die();\n        }\n      })\n    }\n  }\n\n\n  private die(): void {\n    if(this.isElectricFlag) {\n      return;\n    }\n\n    this.isElectricFlag = true;\n    this.vision.active = false;\n    this.tweenState.stop();\n    this.getComponent(SkeletalAnimation).play(\"police_die\");\n    this.AudioManager.playSound(Constants.SoundTrack.electric2Sound);\n  }\n\n\n  private isCatCatched(): void {\n    Constants.ironSource.isEndGame = true;\n    this.isStopFlag = true;\n    this.tweenState.stop();\n    this.getComponent(SkeletalAnimation).play(\"police_atk\");\n\n    this.scheduleOnce(() => {\n      this.fakeCat.active = true;\n      this.AudioManager.playSound(Constants.SoundTrack.catAngrySound);\n    }, 0.5);\n\n    this.scheduleOnce(() => {\n      this.Game.EndGame(false);\n    }, 2.5)\n  }\n\n\n  protected update(dt: number): void {\n      !this.isStopFlag \n      && Constants.isCatched \n      && Constants.isCatLive \n      && Constants.bossCatchedName === this.node.name \n      && this.isCatCatched();\n  }\n}\n"]}