{"version":3,"sources":["file:///D:/PA_2024/3D/CatEscape/CatEscape_OP17_1/assets/Script/Game/Game.ts"],"names":["_decorator","Component","Node","Vec3","CCFloat","v3","screen","Animation","GameController","JoyStick","Constants","AudioManager","ccclass","property","Game","start","reset","Cat","active","canvas2D","text","navigate","on","EventType","TOUCH_START","managerScene","isCollideDoor","laser","wallLaser","isEatFood","isWinGame","HideMask","installHandle","countDown","isTouch","isCatched","isCatLive","scheduleOnce","ironSource","isEndGame","EndGame","handleCountingTime","countingTime","isRing","timeline","setScale","playSound","SoundTrack","clockSound","bool","CTA","getComponent","play","title","icon","CTA_Download","CTA_tryBtn","stopSound","electric2Sound","electricSound","loseSound","catAngrySound","handleIronSourceSound","e","step","pos","getUILocation","localPos","x","y","JoyStickComponent","node","setPosition","stick","handleMuteSoundIronSource","State","parseInt","localStorage","getItem","SoundState","bgSound","stopAllSound","update","deltaTime","responsive","windowSize","width","height","camera","_realHeight","_realWidth"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  Vec3,\n  CCFloat,\n  v3,\n  EventTouch,\n  screen,\n  Animation,\n  director,\n} from \"cc\";\nimport { GameController } from \"./GameController\";\nimport { JoyStick } from \"./JoyStick\";\nimport { Constants } from \"../Data/Constant\";\nimport AudioManager from \"../Plugin/AudioManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"Game\")\nexport class Game extends Component {\n\n\n\n  // component\n  @property(JoyStick)\n  JoyStickComponent: JoyStick = null;\n  @property(GameController)\n  GameController: GameController = null;\n  @property(AudioManager)\n  AudioManager: AudioManager = null;\n\n  //3D\n  @property(Node)\n  Cat: Node = null;\n\n  // 2D\n  @property(Node)\n  canvas2D: Node;\n  @property(Node)\n  icon: Node;\n  @property(Node)\n  navigate: Node;\n  @property(Node)\n  text: Node;\n  @property(Node)\n  title: Node;\n  @property(Node)\n  joyStick: Node;\n  @property(Node)\n  camera: Node = null;\n  @property\n  step: number = 1;\n\n\n  @property(Node)\n  HideMask: Node = null;\n  @property(Node)\n  CTA: Node = null;\n  @property(Node)\n  CTA_btn: Node = null;\n  @property(Node)\n  CTA_tryBtn: Node;\n  @property(Node)\n  CTA_Download: Node;\n\n\n  @property(CCFloat)\n  _realHeight: number = null;\n  @property(CCFloat)\n  _realWidth: number = null;\n\n  // state\n  meowSoundState: number = null;\n\n  // ironsource\n  ironSourceState: number = 1;\n  ironSourceSoundState: boolean = true;\n  isEndGame: boolean = false;\n  endGame: boolean = false;\n\n\n  start() {\n    this.reset();\n    // this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n    // this.AudioManager.playSound(Constants.SoundTrack.catAngrySound);\n\n    this.Cat.active = true;\n    this.canvas2D.active = true;\n    this.text.active = true;\n    this.navigate.active = true;\n\n    this.canvas2D.on(Node.EventType.TOUCH_START, this.managerScene, this);\n  }\n\n\n  private reset(): void {\n    Constants.isCollideDoor = false;\n    Constants.laser = false;\n    Constants.wallLaser = true;\n    Constants.isEatFood = false;\n\n     // mtg & applovin\n     Constants.isWinGame && this.HideMask.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n  }\n\n\n  public countDown(): void {\n    if (Constants.isTouch || Constants.isCatched || !Constants.isCatLive) {\n      return;\n    }\n\n\n\n    this.scheduleOnce(() => {\n      if (Constants.ironSource.isEndGame) {\n        return;\n      }\n      this.EndGame(false);\n    }, 6);\n  }\n\n\n  private handleCountingTime(): void {\n    if (Constants.countingTime < 0 && Constants.isRing) {\n      this.timeline.setScale(0, 1, 1);\n      return;\n    }\n\n\n    if (Constants.countingTime < 0.5 && !Constants.isRing) {\n      this.AudioManager.playSound(Constants.SoundTrack.clockSound);\n      Constants.isRing = true;\n    }\n\n    if (!Constants.ironSource.isEndGame) {\n      Constants.countingTime -= 0.0017;\n\n      this.timeline.setScale(Constants.countingTime, 1, 1);\n    }\n  }\n\n\n  public EndGame(bool: boolean): void {\n    this.CTA.active = true;\n    // Constants.ironSource.isEndGame = true;\n    Constants.isCatched \n    ? this.CTA.getComponent(Animation).play(\"CTA_Anim\")\n    : this.CTA.getComponent(Animation).play(\"CTA_Anim_NoLose\");\n    \n    this.title.active = false;\n    this.icon.active = false;\n    this.CTA_Download.active = true;\n    this.CTA_tryBtn.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n    this.CTA_Download.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n    this.AudioManager.stopSound(Constants.SoundTrack.electric2Sound);\n    this.AudioManager.stopSound(Constants.SoundTrack.electricSound);\n\n    this.AudioManager.playSound(Constants.SoundTrack.loseSound);\n    this.AudioManager.stopSound(Constants.SoundTrack.catAngrySound);\n\n    // mtg & applovin\n    //  this.HideMask.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n\n     \n  }\n\n\n  private handleIronSourceSound(): void {\n    // if (this.isPlayBgSound) {\n    //   return;\n    // }\n\n    // if (this.ironSourceSoundState) {\n    //   this.catSound.setLoop(true);\n    //   this.catSound.play();\n    //   this.bg.setLoop(true);\n    //   this.bg.play();\n    // }\n\n    // this.isPlayBgSound = true;\n  }\n\n\n  managerScene(e: EventTouch) {\n    this.step++;\n    if (this.step === 2) {\n      let pos = e.getUILocation();\n      let localPos = new Vec3(pos.x - 160, pos.y - 240, 0);\n\n      // if (this.ironSourceSoundState) {\n      //   this.click.play();\n      // }\n\n      this.JoyStickComponent.node.setPosition(localPos);\n      this.JoyStickComponent.stick.setPosition(localPos);\n\n      this.text.active = false;\n      this.navigate.active = false;\n    }\n  }\n\n\nprivate handleMuteSoundIronSource(): void {\n    Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n    if (Constants.ironSource.State) {\n        if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n            Constants.ironSource.SoundState = true;\n            this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        }\n\n        if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n            Constants.ironSource.SoundState = false;\n            this.AudioManager.stopAllSound();\n        }\n    }\n}\n\n\n  update(deltaTime: number) {\n    this.responsive();\n    // Constants.isTouch && !Constants.ironSource.isEndGame && this.handleCountingTime();\n    this.handleMuteSoundIronSource();\n  }\n\n\n  private responsive(): void {\n    if (screen.windowSize.width > screen.windowSize.height) {\n      this.camera.setPosition(v3(-14.8, 24, 0));\n      this._realHeight = 480;\n      this._realWidth =\n        320 * (screen.windowSize.width / screen.windowSize.height);\n      // console.log(this._realWidth);\n      this.icon.setPosition((this._realWidth - 320) / 2 + 160, 0, 0);\n      this.title.setPosition((320 - this._realWidth) / 2 - 160, 0, 0);\n\n      this.icon.setScale(0.9, 0.9, 0.9);\n      this.title.setScale(0.35, 0.35, 0.35);\n    } else {\n      this.camera.setPosition(v3(-13, 24, 0));\n      if (screen.windowSize.height / screen.windowSize.width < 1.4) {\n        this._realWidth = 370;\n      } else {\n        this._realWidth = 320;\n      }\n      this._realHeight =\n        this._realWidth *\n        (screen.windowSize.height / screen.windowSize.width);\n\n      // this.title.y = (this._realHeight - 480) / 2 + 207;\n      // this.icon.y = (this._realHeight - 480) / 2 + 207;\n\n      this.icon.setPosition(56, 207 + (this._realHeight - 480) / 2, 0);\n      this.title.setPosition(-40, 207 + (this._realHeight - 480) / 2, 0);\n      this.icon.setScale(0.25, 0.25, 0.25);\n      this.title.setScale(0.2, 0.2, 0.2);\n    }\n  }\n}\n"]}