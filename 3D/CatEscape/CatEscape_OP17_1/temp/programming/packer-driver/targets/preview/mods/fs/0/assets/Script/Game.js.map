{"version":3,"sources":["file:///D:/PA_2024/3D/CatEscape/CatEscape_OP15/assets/Script/Game.ts"],"names":["_decorator","Component","Node","Vec3","AudioClip","Button","director","CCFloat","v3","screen","JoyStick","ccclass","property","Game","start","Cat","active","canvas2D","text","navigate","title","icon","hideMask","node","tryBtn","loadMap","fail","scheduleOnce","on","EventType","TOUCH_START","managerScene","TOUCH_END","handleIronSourceSound","onLoad","isPlayBgSound","ironSourceSoundState","catSound","setLoop","play","bg","e","step","pos","getUILocation","localPos","x","y","click","JoyStickComponent","setPosition","stick","endGame","win","joyStick","isEndGame","setTimeout","loadScene","handleEndGame","update","deltaTime","windowSize","width","height","camera","_realHeight","_realWidth","setScale"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  tween,\n  Vec3,\n  Quat,\n  math,\n  AudioClip,\n  Button,\n  director,\n  CCFloat,\n  v3,\n  EventTouch,\n  screen,\n} from \"cc\";\nimport { GameController } from \"./GameController\";\nimport { JoyStick } from \"./JoyStick\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"Game\")\nexport class Game extends Component {\n\n  // component\n  @property(JoyStick)\n  JoyStickComponent: JoyStick = null;\n\n  //3D\n  @property(Node)\n  Cat: Node = null;\n  @property(Node)\n  Door: Node = null;\n  @property(Node)\n  Boss: Node = null;\n\n  // 2D\n  @property(Node)\n  canvas2D: Node;\n  @property(Node)\n  icon: Node;\n  @property(Node)\n  navigate: Node;\n  @property(Node)\n  text: Node;\n  @property(Node)\n  title: Node;\n  @property(Node)\n  joyStick: Node;\n  @property(Button)\n  tryBtn: Button;\n  @property(Button)\n  hideMask: Button;\n  @property(Node)\n  loadMap: Node = null;\n  @property(Node)\n  fail: Node = null;\n  @property(Node)\n  mask: Node = null;\n  @property(Node)\n  camera: Node = null;\n  @property\n  step: number = 1;\n  @property(CCFloat)\n  _realHeight: number = null;\n  @property(CCFloat)\n  _realWidth: number = null;\n\n  // audio\n  @property(AudioClip)\n  bg: AudioClip = null;\n  @property(AudioClip)\n  click: AudioClip = null;\n  @property(AudioClip)\n  lose: AudioClip = null;\n  @property(AudioClip)\n  win: AudioClip = null;\n  @property(AudioClip)\n  catSound: AudioClip = null;\n\n  // state\n  meowSoundState: number = null;\n\n    // ironsource\n    ironSourceState: number = 1;\n    ironSourceSoundState: boolean = true;\n    isEndGame: boolean = false;\n    endGame: boolean = false;\n\n  start() {\n    // this.catSound.setLoop(true);\n    // this.catSound.play();\n    // this.bg.setLoop(true);\n    // this.bg.play();\n\n\n    this.Cat.active = true;\n    this.canvas2D.active = true;\n    this.text.active = true;\n    this.navigate.active = true;\n    this.title.active = true;\n    this.icon.active = true;\n    this.hideMask.node.active = false;\n    this.tryBtn.node.active = false;\n    this.loadMap.active = false;\n    this.fail.active = false;\n \n\n    this.scheduleOnce(() => {\n      this.canvas2D.on(Node.EventType.TOUCH_START, this.managerScene, this);\n      this.canvas2D.on(Node.EventType.TOUCH_END, this.handleIronSourceSound, this);\n    }, 0.5)\n  }\n\n  onLoad() {\n    \n  }\n\n\n  private handleIronSourceSound(): void {\n    if (this.isPlayBgSound) {\n        return;\n    }\n\n    if (this.ironSourceSoundState) {\n        this.catSound.setLoop(true);\n        this.catSound.play();\n        this.bg.setLoop(true);\n        this.bg.play();\n    }\n\n    this.isPlayBgSound = true;\n}\n\n\n  managerScene(e: EventTouch) {\n    this.step++;\n    if (this.step === 2) {\n      let pos = e.getUILocation();\n      let localPos = new Vec3(pos.x - 160, pos.y - 240, 0);\n\n      if (this.ironSourceSoundState) {\n        this.click.play();\n      }\n\n      this.JoyStickComponent.node.setPosition(localPos);\n      this.JoyStickComponent.stick.setPosition(localPos);\n\n      this.text.active = false;\n      this.navigate.active = false;\n    }\n\n    if (this.step > 0) {\n      if (this.endGame) {\n        this.step = -9999;\n\n        if (this.ironSourceSoundState) {\n          this.win.play();\n        }\n\n        this.joyStick.active = false;\n        this.loadMap.active = true;\n        this.isEndGame = true;\n        setTimeout(() => {\n          director.loadScene(\"CatEscapeNext\");\n        }, 1000);\n      }\n    }\n  }\n\n\n  public handleEndGame(): void {\n    if (this.step > 0) {\n      if (this.endGame) {\n        this.step = -9999;\n\n        if (this.ironSourceSoundState) {\n          this.win.play();\n        }\n\n        this.joyStick.active = false;\n        this.loadMap.active = true;\n        this.isEndGame = true;\n        setTimeout(() => {\n          director.loadScene(\"CatEscapeNext\");\n        }, 1000);\n      }\n    }\n  }\n\n\n  update(deltaTime: number) {\n    // ironsource\n    // this.ironSourceState = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n    // if (this.ironSourceState) {\n    //     if (this.ironSourceState === 1 && !this.ironSourceSoundState && !this.isEndGame) {\n    //         this.ironSourceSoundState = true;\n    //         this.bg.play();\n    //         this.catSound.play();\n    //     }\n\n    //     if (this.ironSourceState === 2 && this.ironSourceSoundState) {\n    //         this.ironSourceSoundState = false;\n    //         this.bg.stop();\n    //         this.catSound.stop();\n    //     }\n    // }\n\n    // if (this.endGame === false) {\n    //   const x = Vec3.distance(this.Cat.getPosition(), this.Door.getPosition());\n\n    //   const y = Vec3.distance(this.Cat.getPosition(), this.Boss.getPosition());\n    //   if (x <= 1.5) {\n    //     console.log(\"end\");\n    //     this.bg.stop();\n    //     this.catSound.stop();\n    //     this.Cat.active = false;\n    //     this.Boss.active = false;\n    //     this.endGame = true;\n    //     this.managerScene();\n    //   }\n    // }\n\n    if (screen.windowSize.width > screen.windowSize.height) {\n      this.camera.setPosition(v3(-14.8, 24, 0));\n      this._realHeight = 480;\n      this._realWidth =\n        320 * (screen.windowSize.width / screen.windowSize.height);\n      // console.log(this._realWidth);\n      this.icon.setPosition((this._realWidth - 320) / 2 + 160, 0, 0);\n      this.title.setPosition((320 - this._realWidth) / 2 - 160, 0, 0);\n\n      this.icon.setScale(0.9, 0.9, 0.9);\n      this.title.setScale(0.35, 0.35, 0.35);\n    } else {\n      this.camera.setPosition(v3(-13, 24, 0));\n      if (screen.windowSize.height / screen.windowSize.width < 1.4) {\n        this._realWidth = 370;\n      } else {\n        this._realWidth = 320;\n      }\n      this._realHeight =\n        this._realWidth *\n        (screen.windowSize.height / screen.windowSize.width);\n\n      this.title.y = (this._realHeight - 480) / 2 + 207;\n      this.icon.y = (this._realHeight - 480) / 2 + 207;\n\n      this.icon.setPosition(56, 207 + (this._realHeight - 480) / 2, 0);\n      this.title.setPosition(-40, 207 + (this._realHeight - 480) / 2, 0);\n      this.icon.setScale(0.25, 0.25, 0.25);\n      this.title.setScale(0.2, 0.2, 0.2);\n    }\n  }\n}\n"]}