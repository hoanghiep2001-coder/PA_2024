{"version":3,"sources":["file:///D:/PA_2024/3D/CatEscape/CatEscape_OP20/assets/Script/Game/BossAction.ts"],"names":["_decorator","Component","Node","tween","Quat","Vec3","SkeletalAnimation","RigidBody","Collider","Constants","Game","AudioManager","ccclass","property","BossAction","start","node","name","runTweenOfBossFirstScene","runTweenOfBossSecondScene","collide","getComponent","handleCollide","tweenState","by","position","to","rotation","fromEuler","union","repeatForever","on","e","otherCollider","laser","isElectricFlag","die","rigidbody","mass","vision","active","stop","play","playSound","SoundTrack","electric2Sound","isCatCatched","isStopFlag","scheduleOnce","fakeCat","catAngrySound","EndGame","update","dt","isCatched","isCatLive","bossCatchedName"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, tween, Quat, ICollisionEvent, Vec3, SkeletalAnimation, RigidBody, Collider } from \"cc\";\nimport { Constants } from \"../Data/Constant\";\nimport { Game } from \"./Game\";\nimport AudioManager from \"../Plugin/AudioManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"BossAction\")\nexport class BossAction extends Component {\n  @property(AudioManager)\n  AudioManager: AudioManager = null;\n  @property(Game)\n  Game: Game = null;\n  @property(Node)\n  fakeCat: Node = null;\n  @property(Node)\n  vision: Node = null;\n\n  tweenState = null;\n  isElectricFlag: boolean = false;\n  isStopFlag: boolean = false;\n  rigidbody: RigidBody = null;\n  collide: Collider = null;\n\n  protected start(): void {\n    \n    this.node.name === \"Boss\" && this.runTweenOfBossFirstScene();\n    this.node.name === \"Boss_2\" && this.runTweenOfBossSecondScene();\n   \n    this.collide = this.getComponent(Collider);\n    this.handleCollide();\n  }\n\n\n  private runTweenOfBossFirstScene(): void {\n    this.tweenState = tween(this.node)\n    .by(2.6, { position: new Vec3(5, 0, 0) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, -90, 0) })\n    .by(2.6, { position: new Vec3(-5, 0, 0) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, 90, 0) })\n    .union()\n    .repeatForever()\n    .start();\n  }\n\n  private runTweenOfBossSecondScene(): void {\n    this.tweenState = tween(this.node)\n    .by(1.5, { position: new Vec3(0, 0, 3) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, 180, 0) })\n    .by(1.5, { position: new Vec3(0, 0, -3) })\n    .to(0, { rotation: Quat.fromEuler(new Quat(), 0, 0, 0) })\n    .union()\n    .repeatForever()\n    .start();\n  }\n\n\n  private handleCollide(): void {\n    if(this.collide) {\n      this.collide.on(\"onCollisionEnter\", (e: ICollisionEvent) => {\n        if(e.otherCollider.node.name === \"Electro_vfx_mesh\" && Constants.laser && !this.isElectricFlag) {\n          this.die();\n        }\n      })\n    }\n  }\n\n\n  private die(): void {\n    if(this.isElectricFlag) {\n      return;\n    }\n\n    this.rigidbody = this.getComponent(RigidBody);\n    this.rigidbody.mass = 1;\n    this.isElectricFlag = true;\n    this.vision.active = false;\n    this.tweenState.stop();\n    this.getComponent(SkeletalAnimation).play(\"CE_police_electrizied\");\n    this.AudioManager.playSound(Constants.SoundTrack.electric2Sound);\n  }\n\n\n  private isCatCatched(): void {\n    this.isStopFlag = true;\n    this.tweenState.stop();\n    this.getComponent(SkeletalAnimation).play(\"CE_police_Catch\");\n    \n    this.scheduleOnce(() => {\n      this.fakeCat.active = true;\n      this.AudioManager.playSound(Constants.SoundTrack.catAngrySound);\n    }, 0.5);\n    \n    this.scheduleOnce(() => {\n      this.Game.EndGame(false);\n    }, 2.5)\n  }\n\n\n  protected update(dt: number): void {\n    !this.isStopFlag \n    && Constants.isCatched \n    && Constants.isCatLive \n    && Constants.bossCatchedName === this.node.name \n    && this.isCatCatched();\n  }\n}\n"]}