{"version":3,"sources":["file:///D:/PA_2024/3D/CatEscape/CatEscape_OP15/assets/Script/Game/JoyStick.ts"],"names":["_decorator","Component","Node","Vec3","CCBoolean","Constants","AudioManager","ccclass","property","JoyStick","start","controlCat","controlCubeBox","getComponent","fakeBg","on","cc","EventType","TOUCH_START","stickStart","TOUCH_MOVE","stickMove","TOUCH_CANCEL","stickEnd","TOUCH_END","onLoad","stick","setPosition","event","isCatLive","isCatched","ironSource","isEndGame","Game","countDown","isTouch","screenPos","getUILocation","pos","x","y","node","opacity","handleIronSourcePlaySound","distance","clone","subtract","position","length","max_r","normalize","multiplyScalar","add","localPos","isMoving","handleAngleCat","offEvent","active","isPlayBgSound","SoundState","playSound","SoundTrack","bgSound","update","dt"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  Vec2,\n  EventTouch,\n  Vec3,\n  CCBoolean,\n} from \"cc\";\nimport { Constants } from \"../Data/Constant\";\nimport AudioManager from \"../Plugin/AudioManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"JoyStick\")\nexport class JoyStick extends Component {\n  @property(AudioManager)\n  AudioManager: AudioManager = null;\n  @property(Node)\n  Game: Node = null;\n  @property(Node)\n  controlCubeBox: Node = null;\n  @property(Node)\n  stick: cc.Node = null;\n  @property(Node)\n  fakeBg: Node = null;\n  @property\n  public max_r: number = 40;\n  @property(CCBoolean)\n  public isTouch: boolean = false;\n  @property\n  public angleMove: number | null = null;\n\n  controlCat: Component = null;\n  setTimeOut: any;\n  currentPos: Vec2 = null;\n\n  start() {\n    this.controlCat = this.controlCubeBox.getComponent(\"CatController\");\n    this.fakeBg.on(cc.Node.EventType.TOUCH_START, this.stickStart, this);\n    this.fakeBg.on(cc.Node.EventType.TOUCH_MOVE, this.stickMove, this);\n    this.fakeBg.on(cc.Node.EventType.TOUCH_CANCEL, this.stickEnd, this);\n    this.fakeBg.on(cc.Node.EventType.TOUCH_END, this.stickEnd, this);\n  }\n\n\n  onLoad() {\n    this.stick.setPosition(0, 0, 0);\n  }\n\n\n  private stickStart(event: EventTouch): void {\n    if(!Constants.isCatLive || Constants.isCatched || Constants.ironSource.isEndGame) {\n      return;\n    }\n\n    this.Game.getComponent(\"Game\").countDown();\n    Constants.isTouch = true;\n    this.isTouch = true;\n\n    const screenPos = event.getUILocation();\n    let pos = new Vec3(screenPos.x - 160, screenPos.y - 240, 0);\n    this.node.setPosition(pos);\n    this.node.getComponent(\"cc.UIOpacity\").opacity = 120;\n    this.stick.getComponent(\"cc.UIOpacity\").opacity = 120;\n    this.stick.setPosition(pos);\n    this.handleIronSourcePlaySound();\n  }\n\n\n  private stickMove(event: EventTouch): void {\n    if(!Constants.isCatLive || Constants.isCatched || Constants.ironSource.isEndGame) {\n      return;\n    }\n\n    const screenPos = event.getUILocation();\n    let pos = new Vec3(screenPos.x - 160, screenPos.y - 240, 0);\n\n    const distance = pos.clone().subtract(this.node.position);\n\n    if (distance.length() > this.max_r) {\n      // Chuyển vị trí stick về ranh giới của joystick\n      distance.normalize().multiplyScalar(this.max_r);\n      pos = this.node.position.clone().add(distance);\n  }\n\n    this.stick.setPosition(pos);\n    Constants.localPos = pos;\n    this.controlCat.isMoving = true;\n    this.controlCat.handleAngleCat();\n  }\n\n\n  private stickEnd(event: cc.Touch): void {\n    if(!Constants.isCatLive || Constants.isCatched  || Constants.ironSource.isEndGame) {\n      return;\n    }\n    this.isTouch = false;\n    this.stick.setPosition(0, 0, 0);\n    this.controlCat.isMoving = false;\n    this.stick.getComponent(\"cc.UIOpacity\").opacity  = 0;\n    this.node.getComponent(\"cc.UIOpacity\").opacity  = 0;\n  }\n\n\n  private offEvent(): void {\n    this.stick.getComponent(\"cc.UIOpacity\").opacity  = 0;\n    this.node.getComponent(\"cc.UIOpacity\").opacity  = 0;\n    this.fakeBg.active = false;\n    this.controlCat.isMoving = false;\n  }\n\n\n  public handleIronSourcePlaySound(): void {\n    if (Constants.ironSource.isPlayBgSound) {\n        return;\n    }\n\n    if (Constants.ironSource.SoundState) {\n        this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n    }\n\n    Constants.ironSource.isPlayBgSound = true;\n}\n\n\n  protected update(dt: number): void {\n    Constants.ironSource.isEndGame && this.offEvent();\n  }\n}\n"]}