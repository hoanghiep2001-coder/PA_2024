{"version":3,"sources":["file:///D:/PA_2024/3D/CatEscape/CatEscape_OP15/assets/Script/Game/Game.ts"],"names":["_decorator","Component","Node","Vec3","CCFloat","v3","screen","Animation","GameController","JoyStick","Constants","AudioManager","ccclass","property","Game","start","Cat","active","canvas2D","text","navigate","on","EventType","TOUCH_START","managerScene","countDown","isTouch","isCatched","isCatLive","scheduleOnce","ironSource","isEndGame","EndGame","handleCountingTime","countingTime","isRing","timeline","setScale","playSound","SoundTrack","clockSound","bool","CTA","getComponent","play","title","icon","clock","CTA_tryBtn","CTA_Download","installHandle","winSound","loseSound","stopSound","catAngrySound","handleIronSourceSound","e","step","pos","getUILocation","localPos","x","y","JoyStickComponent","node","setPosition","stick","handleMuteSoundIronSource","State","parseInt","localStorage","getItem","SoundState","bgSound","stopAllSound","update","deltaTime","responsive","windowSize","width","height","camera","_realHeight","_realWidth"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  Vec3,\n  CCFloat,\n  v3,\n  EventTouch,\n  screen,\n  Animation,\n} from \"cc\";\nimport { GameController } from \"./GameController\";\nimport { JoyStick } from \"./JoyStick\";\nimport { Constants } from \"../Data/Constant\";\nimport AudioManager from \"../Plugin/AudioManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"Game\")\nexport class Game extends Component {\n\n\n\n  // component\n  @property(JoyStick)\n  JoyStickComponent: JoyStick = null;\n  @property(GameController)\n  GameController: GameController = null;\n  @property(AudioManager)\n  AudioManager: AudioManager = null;\n\n  //3D\n  @property(Node)\n  Cat: Node = null;\n\n  // 2D\n  @property(Node)\n  canvas2D: Node;\n  @property(Node)\n  icon: Node;\n  @property(Node)\n  navigate: Node;\n  @property(Node)\n  text: Node;\n  @property(Node)\n  title: Node;\n  @property(Node)\n  joyStick: Node;\n  @property(Node)\n  camera: Node = null;\n  @property\n  step: number = 1;\n\n  @property(Node)\n  clock: Node = null;\n  @property(Node)\n  timeline: Node = null;\n\n  @property(Node)\n  HideMask: Node = null;\n  @property(Node)\n  CTA: Node = null;\n  @property(Node)\n  CTA_tryBtn: Node;\n  @property(Node)\n  CTA_Download: Node;\n\n\n  @property(CCFloat)\n  _realHeight: number = null;\n  @property(CCFloat)\n  _realWidth: number = null;\n\n  // state\n  meowSoundState: number = null;\n\n  // ironsource\n  ironSourceState: number = 1;\n  ironSourceSoundState: boolean = true;\n  isEndGame: boolean = false;\n  endGame: boolean = false;\n\n  start() {\n\n    // this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n    // this.AudioManager.playSound(Constants.SoundTrack.catAngrySound);\n\n    this.Cat.active = true;\n    this.canvas2D.active = true;\n    this.text.active = true;\n    this.navigate.active = true;\n\n    this.canvas2D.on(Node.EventType.TOUCH_START, this.managerScene, this);\n  }\n\n\n  public countDown(): void {\n    if (Constants.isTouch || Constants.isCatched || !Constants.isCatLive) {\n      return;\n    }\n\n    this.scheduleOnce(() => {\n      if (Constants.ironSource.isEndGame) {\n        return;\n      }\n      this.EndGame(false);\n    }, 10);\n  }\n\n\n  private handleCountingTime(): void {\n    if (Constants.countingTime < 0 && Constants.isRing) {\n      this.timeline.setScale(0, 1, 1);\n      return;\n    }\n\n\n    if (Constants.countingTime < 0.5 && !Constants.isRing) {\n      this.AudioManager.playSound(Constants.SoundTrack.clockSound);\n      Constants.isRing = true;\n    }\n\n    if (!Constants.ironSource.isEndGame) {\n      Constants.countingTime -= 0.0017;\n\n      this.timeline.setScale(Constants.countingTime, 1, 1);\n    }\n  }\n\n\n  public EndGame(bool: boolean): void {\n    Constants.ironSource.isEndGame = true;\n    this.CTA.getComponent(Animation).play(\"CTA_Anim\");\n    this.title.active = false;\n    this.icon.active = false;\n    this.clock.active = false;\n    // mtg & applovin\n    // this.HideMask.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n\n    if (bool) {\n      this.CTA_tryBtn.active = false;\n      this.CTA_Download.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n      this.AudioManager.playSound(Constants.SoundTrack.winSound);\n    } else {\n      this.CTA_Download.active = false;\n      this.CTA_tryBtn.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n      this.AudioManager.playSound(Constants.SoundTrack.loseSound);\n      this.AudioManager.stopSound(Constants.SoundTrack.catAngrySound);\n    }\n  }\n\n\n  private handleIronSourceSound(): void {\n    // if (this.isPlayBgSound) {\n    //   return;\n    // }\n\n    // if (this.ironSourceSoundState) {\n    //   this.catSound.setLoop(true);\n    //   this.catSound.play();\n    //   this.bg.setLoop(true);\n    //   this.bg.play();\n    // }\n\n    // this.isPlayBgSound = true;\n  }\n\n\n  managerScene(e: EventTouch) {\n    this.step++;\n    if (this.step === 2) {\n      let pos = e.getUILocation();\n      let localPos = new Vec3(pos.x - 160, pos.y - 240, 0);\n\n      // if (this.ironSourceSoundState) {\n      //   this.click.play();\n      // }\n\n      this.JoyStickComponent.node.setPosition(localPos);\n      this.JoyStickComponent.stick.setPosition(localPos);\n\n      this.text.active = false;\n      this.navigate.active = false;\n    }\n  }\n\n\nprivate handleMuteSoundIronSource(): void {\n    Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n    if (Constants.ironSource.State) {\n        if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n            Constants.ironSource.SoundState = true;\n            this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        }\n\n        if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n            Constants.ironSource.SoundState = false;\n            this.AudioManager.stopAllSound();\n        }\n    }\n}\n\n\n  update(deltaTime: number) {\n    this.responsive();\n    Constants.isTouch && !Constants.ironSource.isEndGame && this.handleCountingTime();\n    this.handleMuteSoundIronSource();\n  }\n\n\n  private responsive(): void {\n    if (screen.windowSize.width > screen.windowSize.height) {\n      this.camera.setPosition(v3(-14.8, 24, 0));\n      this._realHeight = 480;\n      this._realWidth =\n        320 * (screen.windowSize.width / screen.windowSize.height);\n      // console.log(this._realWidth);\n      this.icon.setPosition((this._realWidth - 320) / 2 + 160, 0, 0);\n      this.title.setPosition((320 - this._realWidth) / 2 - 160, 0, 0);\n\n      this.icon.setScale(0.9, 0.9, 0.9);\n      this.title.setScale(0.35, 0.35, 0.35);\n    } else {\n      this.camera.setPosition(v3(-13, 24, 0));\n      if (screen.windowSize.height / screen.windowSize.width < 1.4) {\n        this._realWidth = 370;\n      } else {\n        this._realWidth = 320;\n      }\n      this._realHeight =\n        this._realWidth *\n        (screen.windowSize.height / screen.windowSize.width);\n\n      // this.title.y = (this._realHeight - 480) / 2 + 207;\n      // this.icon.y = (this._realHeight - 480) / 2 + 207;\n\n      this.icon.setPosition(56, 207 + (this._realHeight - 480) / 2, 0);\n      this.title.setPosition(-40, 207 + (this._realHeight - 480) / 2, 0);\n      this.icon.setScale(0.25, 0.25, 0.25);\n      this.title.setScale(0.2, 0.2, 0.2);\n    }\n  }\n}\n"]}