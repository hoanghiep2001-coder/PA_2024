{"version":3,"sources":["file:///D:/PA_2024/3D/CatEscape/CatEscape_OP18/assets/Script/Game/Game.ts"],"names":["_decorator","Component","Node","Vec3","CCFloat","v3","screen","Animation","tween","GameController","JoyStick","Constants","AudioManager","ccclass","property","Game","start","reset","Cat","active","canvas2D","text","navigate","on","EventType","TOUCH_START","managerScene","isCollideDoor","laser","wallLaser","isEatFood","isWinGame","HideMask","installHandle","countDown","isTouch","isCatched","isCatLive","handleCountingTime","countingTime","isRing","timeline","setScale","playSound","SoundTrack","clockSound","ironSource","isEndGame","EndGame","bool","CTA","getComponent","play","title","icon","CTA_tryBtn","repeatForever","to","scale","easing","stopSound","electric2Sound","electricSound","loseSound","catAngrySound","e","step","pos","getUILocation","localPos","x","y","JoyStickComponent","node","setPosition","stick","handleMuteSoundIronSource","State","parseInt","localStorage","getItem","SoundState","bgSound","stopAllSound","update","deltaTime","responsive","windowSize","width","height","camera","_realHeight","_realWidth"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  Vec3,\n  CCFloat,\n  v3,\n  EventTouch,\n  screen,\n  Animation,\n  director,\n  tween,\n} from \"cc\";\nimport { GameController } from \"./GameController\";\nimport { JoyStick } from \"./JoyStick\";\nimport { Constants } from \"../Data/Constant\";\nimport AudioManager from \"../Plugin/AudioManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"Game\")\nexport class Game extends Component {\n  // component\n  @property(JoyStick)\n  JoyStickComponent: JoyStick = null;\n  @property(GameController)\n  GameController: GameController = null;\n  @property(AudioManager)\n  AudioManager: AudioManager = null;\n\n  //3D\n  @property(Node)\n  Cat: Node = null;\n\n  // 2D\n  @property(Node)\n  canvas2D: Node;\n  @property(Node)\n  icon: Node;\n  @property(Node)\n  navigate: Node;\n  @property(Node)\n  text: Node;\n  @property(Node)\n  title: Node;\n  @property(Node)\n  joyStick: Node;\n  @property(Node)\n  camera: Node = null;\n  @property\n  step: number = 1;\n\n\n  @property(Node)\n  HideMask: Node = null;\n  @property(Node)\n  CTA: Node = null;\n  @property(Node)\n  CTA_tryBtn: Node;\n  @property(Node)\n  CTA_Download: Node;\n\n\n  @property(CCFloat)\n  _realHeight: number = null;\n  @property(CCFloat)\n  _realWidth: number = null;\n\n  // state\n  meowSoundState: number = null;\n\n  // ironsource\n  ironSourceState: number = 1;\n  ironSourceSoundState: boolean = true;\n  isEndGame: boolean = false;\n  endGame: boolean = false;\n\n  start() {\n    this.reset();\n    // this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n    // this.AudioManager.playSound(Constants.SoundTrack.catAngrySound);\n\n    this.Cat.active = true;\n    this.canvas2D.active = true;\n    this.text.active = true;\n    this.navigate.active = true;\n\n    this.canvas2D.on(Node.EventType.TOUCH_START, this.managerScene, this);\n  }\n\n\n  private reset(): void {\n    Constants.isCollideDoor = false;\n    Constants.laser = false;\n    Constants.wallLaser = true;\n    Constants.isEatFood = false;\n\n    // mtg & applovin\n    Constants.isWinGame && this.HideMask.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n  }\n\n\n  public countDown(): void {\n    if (Constants.isTouch || Constants.isCatched || !Constants.isCatLive) {\n      return;\n    }\n\n    // this.scheduleOnce(() => {\n    //   if (Constants.ironSource.isEndGame) {\n    //     return;\n    //   }\n    //   this.EndGame(false);\n    // }, 6);\n  }\n\n\n  private handleCountingTime(): void {\n    if (Constants.countingTime < 0 && Constants.isRing) {\n      this.timeline.setScale(0, 1, 1);\n      return;\n    }\n\n\n    if (Constants.countingTime < 0.5 && !Constants.isRing) {\n      this.AudioManager.playSound(Constants.SoundTrack.clockSound);\n      Constants.isRing = true;\n    }\n\n    if (!Constants.ironSource.isEndGame) {\n      Constants.countingTime -= 0.0017;\n\n      this.timeline.setScale(Constants.countingTime, 1, 1);\n    }\n  }\n\n\n  public EndGame(bool: boolean): void {\n    if(Constants.ironSource.isEndGame) return;\n\n    this.CTA.active = true;\n    Constants.ironSource.isEndGame = true;\n    this.CTA.getComponent(Animation).play(\"CTA_Anim\");\n    this.title.active = true;\n    this.icon.active = true;\n    this.CTA_tryBtn.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n\n    tween(this.CTA_tryBtn)\n      .repeatForever(\n        tween(this.CTA_tryBtn)\n          .to(0.5, { scale: new Vec3(0.45, 0.45, 0.45) })\n          .to(0.5, { scale: new Vec3(0.4, 0.4, 0.4) }, { easing: 'elasticOut' })\n      ).start();\n\n    // mtg & applovin\n    // this.HideMask.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n\n    this.AudioManager.stopSound(Constants.SoundTrack.electric2Sound);\n    this.AudioManager.stopSound(Constants.SoundTrack.electricSound);\n\n    this.AudioManager.playSound(Constants.SoundTrack.loseSound);\n    this.AudioManager.stopSound(Constants.SoundTrack.catAngrySound);\n  }\n\n\n  managerScene(e: EventTouch) {\n    this.step++;\n    if (this.step === 2) {\n      let pos = e.getUILocation();\n      let localPos = new Vec3(pos.x - 160, pos.y - 240, 0);\n\n      this.JoyStickComponent.node.setPosition(localPos);\n      this.JoyStickComponent.stick.setPosition(localPos);\n\n      this.text.active = false;\n      this.navigate.active = false;\n    }\n  }\n\n\n  private handleMuteSoundIronSource(): void {\n    Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n    if (Constants.ironSource.State) {\n      if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n        Constants.ironSource.SoundState = true;\n        this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n      }\n\n      if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n        Constants.ironSource.SoundState = false;\n        this.AudioManager.stopAllSound();\n      }\n    }\n  }\n\n\n  update(deltaTime: number) {\n    this.responsive();\n    // this.handleMuteSoundIronSource();\n  }\n\n\n  private responsive(): void {\n    if (screen.windowSize.width > screen.windowSize.height) {\n      this.camera.setPosition(v3(-14.8, 24, 0));\n      this._realHeight = 480;\n      this._realWidth =\n        320 * (screen.windowSize.width / screen.windowSize.height);\n      // console.log(this._realWidth);\n      this.icon.setPosition((this._realWidth - 320) / 2 + 160, 0, 0);\n      this.title.setPosition((320 - this._realWidth) / 2 - 160, 0, 0);\n\n      this.icon.setScale(0.9, 0.9, 0.9);\n      this.title.setScale(0.35, 0.35, 0.35);\n    } else {\n      this.camera.setPosition(v3(-13, 24, 0));\n      if (screen.windowSize.height / screen.windowSize.width < 1.4) {\n        this._realWidth = 370;\n      } else {\n        this._realWidth = 320;\n      }\n      this._realHeight =\n        this._realWidth *\n        (screen.windowSize.height / screen.windowSize.width);\n\n      // this.title.y = (this._realHeight - 480) / 2 + 207;\n      // this.icon.y = (this._realHeight - 480) / 2 + 207;\n\n      this.icon.setPosition(56, 207 + (this._realHeight - 480) / 2, 0);\n      this.title.setPosition(-40, 207 + (this._realHeight - 480) / 2, 0);\n      this.icon.setScale(0.25, 0.25, 0.25);\n      this.title.setScale(0.2, 0.2, 0.2);\n    }\n  }\n}\n"]}