{"version":3,"sources":["file:///D:/PA_2024/3D/SantaCall/SantaCall_Op2/assets/Script/Game/GamePlay.ts"],"names":["_decorator","Component","Node","VideoPlayer","GameController","AudioManager","Constants","UIController","ccclass","property","GamePlay","onLoad","CTA","active","start","isCanClick","video","node","registerEvent","HideMask","on","EventType","TOUCH_START","handleIronSourcePlaySound","btn_accept","handleVideo","btn_decline","handleInstall","isFirstClick","isRotate","layer","READY_TO_PLAY","initVideo","COMPLETED","endVideo","hand","stopSound","SoundTrack","iphoneSound","playSound","bgSound","handleMuteSoundIronSource","ironSource","State","parseInt","localStorage","getItem","SoundState","isEndGame","stopAllSound","play","volume","layer_icon","off","CTA_btn","installHandle","isPlayBgSound","switchVolume","update","dt"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Component, EventTouch, Node, PhysicsSystem, SkeletalAnimation, Vec2, Vec3, ParticleSystem, log, sp, view, UITransform, Label, Sprite, VideoPlayer, director, Button, ParticleSystem2D } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { GameController } from './GameController';\nimport { AudioManager } from './AudioManager';\nimport { Constants } from '../Data/constants';\nimport { UIController } from './UIController';\n\n@ccclass('GamePlay')\nexport class GamePlay extends Component {\n    // Component\n    @property(UIController)\n    UIController: UIController = null;\n    @property(GameController)\n    GameController: GameController = null;\n    @property(AudioManager)\n    AudioManager: AudioManager = null;\n\n\n    @property(VideoPlayer)\n    video: VideoPlayer = null;\n    @property(Node)\n    HideMask: Node = null;\n    @property(Node)\n    hand: Node = null;\n    @property(Node)\n    btn_accept: Node = null;\n    @property(Node)\n    btn_decline: Node = null;\n\n\n    @property(Node)\n    CTA: Node = null;\n    @property(Node)\n    CTA_overlay: Node = null;\n    @property(Node)\n    CTA_icon: Node = null;\n    @property(Node)\n    CTA_btn: Node = null;\n\n\n    @property(Node)\n    layer: Node = null;\n    @property(Node)\n    layer_icon: Node = null;\n\n\n    protected onLoad(): void {\n        this.CTA.active = false;\n    }\n    \n    \n    protected start(): void {\n        Constants.isCanClick = true;\n        this.video.node.active = false;\n        // this.AudioManager.playSound(Constants.SoundTrack.iphoneSound);\n        // this.AudioManager.switchVolume(Constants.SoundTrack.iphoneSound, 0.7);\n        this.registerEvent();\n    }\n\n\n    private registerEvent(): void {\n        this.HideMask.on(Node.EventType.TOUCH_START, this.handleIronSourcePlaySound, this);\n        this.btn_accept.on(Node.EventType.TOUCH_START, this.handleVideo, this);\n        this.btn_decline.on(Node.EventType.TOUCH_START, this.handleInstall, this);\n    }\n\n\n    private handleVideo(): void {\n        if(!Constants.isCanClick) {\n            return;\n        }\n\n        Constants.isCanClick = false;  \n        Constants.isFirstClick = true;\n        Constants.isRotate ? this.layer.active = true : this.layer.active = false; \n\n        this.UIController.node.active = false;\n        this.video.node.active = true;\n        this.video.node.on(VideoPlayer.EventType.READY_TO_PLAY, this.initVideo, this);\n        this.video.node.on(VideoPlayer.EventType.COMPLETED, this.endVideo, this);\n        this.hand.active = false;\n        this.AudioManager.stopSound(Constants.SoundTrack.iphoneSound);\n        this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n    }\n\n\n    private handleMuteSoundIronSource(): void {\n        Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n        if (Constants.ironSource.State) {\n            if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n                Constants.ironSource.SoundState = true;\n            }\n\n            if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n                Constants.ironSource.SoundState = false;\n                this.AudioManager.stopAllSound();\n            }\n        }\n    }\n\n\n    private initVideo(video: VideoPlayer) {\n        video.play();\n        video.volume = 0;\n    }\n\n\n    private endVideo(): void {\n        this.AudioManager.stopSound(Constants.SoundTrack.iphoneSound);\n        this.CTA.active = true;\n        this.layer_icon.active = false;\n\n        this.btn_accept.off(Node.EventType.TOUCH_START);\n        this.btn_decline.off(Node.EventType.TOUCH_START);\n        this.CTA_btn.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n\n        // mtg & applovin\n        // this.CTA_overlay.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n    }\n\n\n    private handleInstall(): void {\n        this.btn_accept.off(Node.EventType.TOUCH_START);\n        this.btn_decline.off(Node.EventType.TOUCH_START);\n        this.GameController.installHandle();\n    }\n\n\n    public handleIronSourcePlaySound(): void {\n        if (Constants.ironSource.isPlayBgSound) {\n          return;\n        }\n    \n        if (Constants.ironSource.SoundState) {\n          this.AudioManager.playSound(Constants.SoundTrack.iphoneSound);\n          this.AudioManager.switchVolume(Constants.SoundTrack.iphoneSound, 0.7);\n        }\n    \n        Constants.ironSource.isPlayBgSound = true;\n      }\n\n\n    protected update(dt: number): void {\n        // ironsource\n        this.handleMuteSoundIronSource();\n    }\n}\n"]}