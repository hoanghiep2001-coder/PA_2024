{"version":3,"sources":["file:///D:/PA_2024/3D/MergeDino/MergeDino_Op12/assets/Script/Controller/TouchAreaController.ts"],"names":["_decorator","Component","Node","Vec3","Constants","NodesController","GameController","AudioManager","IronSource","GamePlay","ccclass","property","TouchAreaController","start","registerEvent","hideMask","on","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","Btn_AddDino","BtnTouchStart","Btn_Install","installHandle","isDonePA","isCanTouch","ironSource","isEndGame","isTouching","event","stick","screenPos","getUILocation","pos","convertToLocalLocation","point","setPosition","isDoneAddDino","isMerged","checkMergeDino","unActiveDinoLines","value","localX","x","node","getPosition","localY","y","result","countClick","handleBuyDino","showDino"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec2, EventTouch, Vec3, UITransform } from \"cc\";\r\nimport { Constants } from \"../Data/Constant\";\r\nimport { NodesController } from \"./NodesController\";\r\nimport { GameController } from \"./GameController\";\r\nimport { AudioManager } from \"../Plugin/AudioManager\";\r\nimport { IronSource } from \"../Plugin/IronSource\";\r\nimport { GamePlay } from \"./GamePlay\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"TouchAreaController\")\r\nexport class TouchAreaController extends Component {\r\n  @property(IronSource)\r\n  IronSource: IronSource = null;\r\n  @property(GamePlay)\r\n  GamePlay: GamePlay = null;\r\n  @property(AudioManager)\r\n  AudioManager: AudioManager = null;\r\n  @property(NodesController)\r\n  NodesController: NodesController = null;\r\n  @property(GameController)\r\n  GameController: GameController = null;\r\n\r\n  // state\r\n  pos: Vec3 = null;\r\n\r\n\r\n  isDoneMergeStep1: boolean = false;\r\n  isDoneMergeStep2: boolean = false;\r\n\r\n\r\n  protected start(): void {\r\n    this.registerEvent();\r\n  }\r\n\r\n\r\n  private registerEvent(): void {\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_START, this.touchStart, this);\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_END, this.touchEnd, this);\r\n    this.NodesController.hideMask.on(Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\r\n\r\n    this.NodesController.Btn_AddDino.on(Node.EventType.TOUCH_START, this.BtnTouchStart, this);\r\n    this.NodesController.Btn_Install.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\r\n  }\r\n\r\n\r\n  private touchStart(): void {\r\n    Constants.isDonePA && this.GameController.installHandle();\r\n    if (!Constants.isCanTouch || Constants.ironSource.isEndGame) return;\r\n    Constants.isTouching = true;\r\n\r\n    // this.IronSource.handleIronSourcePlaySound();\r\n  }\r\n\r\n\r\n  private touchMove(event: EventTouch, stick: Node) {\r\n    if (!Constants.isCanTouch) return;\r\n    const screenPos = event.getUILocation();\r\n    this.pos = this.convertToLocalLocation(screenPos);\r\n    this.NodesController.point.setPosition(this.pos);\r\n    Constants.isDoneAddDino && !Constants.isMerged && this.GamePlay.checkMergeDino();\r\n  }\r\n\r\n\r\n  private touchEnd(): void {\r\n    if (!Constants.isCanTouch) return;\r\n    Constants.isTouching = false;\r\n    !Constants.isMerged && this.GamePlay.unActiveDinoLines();\r\n  }\r\n\r\n\r\n  private convertToLocalLocation(value: Vec2): Vec3 {\r\n    const localX = value.x - 160 - this.node.getPosition().x;\r\n    const localY = value.y - 240 - this.node.getPosition().y;\r\n    const result = new Vec3(localX, localY, 0);\r\n    return result;\r\n  }\r\n\r\n\r\n  private BtnTouchStart(): void {\r\n    // this.IronSource.handleIronSourcePlaySound();\r\n    Constants.countClick <= 3 && this.GamePlay.handleBuyDino();\r\n    Constants.countClick <= 3 && this.GamePlay.showDino();\r\n  }\r\n\r\n  // protected update(dt: number): void {\r\n  //   this.IronSource.handleMuteSoundIronSource();\r\n  // }\r\n}\r\n"]}