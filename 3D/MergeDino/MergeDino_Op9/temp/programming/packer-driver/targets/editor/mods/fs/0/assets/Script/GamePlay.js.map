{"version":3,"sources":["file:///D:/PA_2024/3D/MergeDino/MergeDino_Op9/assets/Script/GamePlay.ts"],"names":["_decorator","Animation","Camera","Component","Graphics","math","Node","PhysicsSystem","SkeletalAnimation","Vec3","UITransform","ParticleSystem","CharacterControl","RangerControl","GameController","AudioManager","JoyStick","ccclass","property","GamePlay","x","y","z","instance","onLoad","enable","text","active","Lines","forEach","line","TryAgain","start","handleGamePlay","registerEvent","scheduleOnce","node","getComponent","play","isPlayed","SmallUnitMerge","baby","index","MergeUnit","Boss","SmallUnit","ranger","handleFight","isFighting","HideMask","off","EventType","TOUCH_START","attackSound","loop","Spine_Blast2","setAnimation","blastSound","Spine_Blast","Spine_Blast3","stop","handleEndGame","loseSound","on","onHideMaskTouchStart","TOUCH_MOVE","onHideMaskTouchMove","TOUCH_END","onHideMaskTouchEnd","TOUCH_CANCEL","handleIronSource","isPlayBgSound","bgSound","isTouch","isMerged","ParentSmallUnit","unit","setPosition","RoboStates","setScale","redLines","hand","e","stickMove","Point","currentPos","pos","initPos","handleCheckCollideRoboPoint","result","isDoneMerge","find","status","String","mergeFail","mergeSuccess","PointRobos","point","getBoundingBox","intersects","handleCancelCallBack","line_white","isRun","RangerControls","component","text_90Per","FX_Merge","mergeSound","console","log","installHandle","update","dt","isFight"],"mappings":"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","sourcesContent":["import { _decorator, Animation, AudioSource, Camera, view, Vec2, Component, EventTouch, Graphics, log, math, Node, PhysicsSystem, quat, RigidBody, SkeletalAnimation, Skeleton, Vec3, UITransform, ParticleSystem } from 'cc';\nimport { CharacterControl } from './CharacterControl';\nimport { RangerControl } from './RangerControl';\nimport { GameController } from './GameController';\nimport { AudioManager } from './AudioManager';\nimport { JoyStick } from './JoyStick';\nconst { ccclass, property } = _decorator;\n@ccclass('GamePlay')\nexport class GamePlay extends Component {\n    // Camera\n    @property(Camera)\n    Camera: Camera = null;\n\n    // component\n    @property(GameController)\n    GameController: GameController;\n    @property(AudioManager)\n    AudioManager: AudioManager;\n    @property(CharacterControl)\n    CharacterControl: CharacterControl;\n    @property(JoyStick)\n    JoyStick: JoyStick = null;\n    @property(Graphics)\n    Graphics: Graphics = null;\n    @property(Node)\n    Point: Node = null;\n    @property(Node)\n    HideMask: Node = null;\n\n\n    // FX\n    @property(ParticleSystem)\n    FX_FireBall: ParticleSystem = null;\n    @property(ParticleSystem)\n    FX_Explosion: ParticleSystem = null;\n    @property(ParticleSystem)\n    FX_Merge: ParticleSystem = null;\n\n    // Node 3D\n    @property(Node)\n    Boss: Node = null;\n    @property(Node)\n    line_white: Node = null;\n    @property(Node)\n    MergeUnit: Node = null;\n    @property(Node)\n    text: Node = null;\n    @property(Node)\n    text_90Per: Node = null;\n    @property(Node)\n    hand: Node = null;\n\n\n    // array\n    @property([Node])\n    ParentSmallUnit: Node[] = [];\n    @property([Node])\n    SmallUnit: Node[] = [];\n    @property([Node])\n    SmallUnitMerge: Node[] = [];\n    @property([RangerControl])\n    RangerControls: RangerControl[] = [];\n    @property([Node])\n    redLines: Node[] = [];\n    @property([Node])\n    PointRobos: Node[] = [];\n    @property([Node])\n    Lines: Node[] = [];\n\n    // Node 2D\n    @property(Node)\n    canvas2D: Node = null;\n    @property(Node)\n    Spine_Blast: Node = null;\n    @property(Node)\n    Spine_Blast2: Node = null;\n    @property(Node)\n    Spine_Blast3: Node = null;\n    @property(Node)\n    TryAgain: Node = null;\n\n\n    // state\n    currentPos: Vec3 = null;\n    initPos: Vec3 = null;\n\n    currentIndex: number = 0;\n\n    isTouch: boolean = false;\n    isRotate: boolean = false;\n    isMerged: boolean = false;\n    isPlayed: boolean = false;\n    isFighting: boolean = false;\n    isPlayBgSound: boolean = false;\n    isDoneMerge: boolean[] = [false, false, false, false, false, false, false, false];\n\n    RoboStates: object[] = [\n        {\n            x: -2.2,\n            y: -15.5,\n            z: 9.2,\n        },\n        {\n            x: -2.2,\n            y: -15.5,\n            z: 10.8,\n        },\n        {\n            x: -1.1,\n            y: -15.5,\n            z: 10.8,\n        },\n        {\n            x: 0,\n            y: -15.5,\n            z: 9.2,\n        },\n        {\n            x: 0,\n            y: -15.5,\n            z: 10.8,\n        },\n        {\n            x: 0,\n            y: -15.5,\n            z:7.6,\n        },\n        {\n            x: -1.1,\n            y: -15.5,\n            z: 7.6,\n        },\n        {\n            x: -2.2,\n            y: -15.5,\n            z: 7.6,\n        },\n    ]\n\n    // physics\n    physics: PhysicsSystem = PhysicsSystem.instance;\n\n\n    protected onLoad(): void {\n        PhysicsSystem.instance.enable = true;\n        this.text.active = false;\n        this.Lines.forEach(line => line.active = false);\n        this.TryAgain.active = false;\n    }\n\n\n    protected start(): void {\n        // this.AudioManager.bgSound.play();\n        this.handleGamePlay();\n        this.registerEvent();\n    }\n\n\n    private handleGamePlay(): void {\n        this.scheduleOnce(() => {\n            this.node.getComponent(Animation).play(\"UIAnim\");\n        }, 0.5);\n\n        this.scheduleOnce(() => {\n            if (this.isPlayed) return;\n\n            this.SmallUnitMerge.forEach((baby, index) => {\n                baby.active = false;\n            });\n\n        }, 2.5);\n\n        this.scheduleOnce(() => {\n            if (this.isPlayed) return;\n\n            this.SmallUnitMerge.forEach((baby, index) => {\n                baby.active = true;\n            });\n            this.node.getComponent(Animation).play(\"UIAnim\");\n        }, 3.6);\n\n        this.scheduleOnce(() => {\n            if (this.isPlayed) return;\n            this.SmallUnitMerge.forEach((baby, index) => {\n                baby.active = false;\n            });\n        }, 5.6);\n\n        this.scheduleOnce(() => {\n            if (this.isPlayed) return;\n            this.SmallUnitMerge.forEach((baby, index) => {\n                baby.active = true;\n            });\n            this.MergeUnit.active = false;\n            // this.text.active = true;\n            // this.text.getComponent(Animation).play(\"Blink\");\n\n            this.node.getComponent(Animation).play(\"UI_HintLoopAnim\");\n        }, 6.6);\n\n        this.Boss.getComponent(SkeletalAnimation).play(\"dancing\");\n        this.MergeUnit.getComponent(SkeletalAnimation).play(\"dancing\");\n        this.SmallUnit.forEach(ranger => {\n            ranger.getComponent(Animation).play(\"idle\");\n        });\n    }\n\n\n    private handleFight(): void {\n        if (this.isFighting) return;\n\n        this.HideMask.off(Node.EventType.TOUCH_START);\n        this.AudioManager.attackSound.play();\n        this.AudioManager.attackSound.loop = true;\n\n        this.isFighting = true;\n        this.Boss.getComponent(SkeletalAnimation).play(\"atk\");\n        this.MergeUnit.getComponent(SkeletalAnimation).play(\"atk\");\n\n        this.scheduleOnce(() => {\n            this.Spine_Blast2.getComponent(\"sp.Skeleton\").setAnimation(0, \"2\", false);\n            this.AudioManager.blastSound.play();\n        }, 0.7)\n\n        this.scheduleOnce(() => {\n            this.Spine_Blast.getComponent(\"sp.Skeleton\").setAnimation(0, \"2\", false);\n            this.AudioManager.blastSound.play();\n        }, 0.5);\n\n        this.scheduleOnce(() => {\n            this.Spine_Blast3.getComponent(\"sp.Skeleton\").setAnimation(0, \"2\", false);\n            this.AudioManager.blastSound.play();\n        }, 0.9)\n\n        this.scheduleOnce(() => {\n            this.Boss.getComponent(SkeletalAnimation).play(\"dancing\");\n            this.MergeUnit.getComponent(SkeletalAnimation).play(\"die\");\n            this.AudioManager.attackSound.stop();\n        }, 2);\n\n        this.scheduleOnce(() => {\n            this.MergeUnit.getComponent(SkeletalAnimation).stop();\n            // this.MergeUnit.active = false;\n            this.Boss.getComponent(SkeletalAnimation).play(\"dancing\");\n            this.handleEndGame();\n            this.AudioManager.loseSound.play();\n        }, 3);\n    }\n\n\n    private registerEvent(): void {\n        this.HideMask.on(Node.EventType.TOUCH_START, this.onHideMaskTouchStart, this);\n        this.HideMask.on(Node.EventType.TOUCH_MOVE, this.onHideMaskTouchMove, this);\n        this.HideMask.on(Node.EventType.TOUCH_END, this.onHideMaskTouchEnd, this);\n        this.HideMask.on(Node.EventType.TOUCH_CANCEL, this.onHideMaskTouchEnd, this);\n    }\n\n\n    private handleIronSource():void {\n        if(this.isPlayBgSound) {\n                return\n        }\n\n        this.isPlayBgSound = true;\n        this.AudioManager.bgSound.play();\n    }\n\n\n    private onHideMaskTouchStart(): void {\n        this.isPlayed = true;\n        this.isTouch = true;\n\n        if (!this.isMerged) {\n            this.node.getComponent(Animation).play(\"UIAnim\");\n            this.node.getComponent(Animation).stop();\n            this.ParentSmallUnit.forEach((unit,index) => {\n                unit.setPosition(new math.Vec3(this.RoboStates[index].x, this.RoboStates[index].y, this.RoboStates[index].z));\n                unit.setScale(new math.Vec3(8, 8, 8));\n            })\n            this.redLines.forEach(line => line.active = false);\n            this.hand.active = false;\n            this.SmallUnitMerge.forEach(unit => {\n                unit.active = true;\n                unit.setScale(new math.Vec3(5, 5, 5));\n                unit.setPosition(new math.Vec3(0, 0, 0));\n                this.MergeUnit.active = false;\n            });\n        }\n\n        this.handleIronSource();\n    }\n\n\n    private onHideMaskTouchMove(e: EventTouch): void {\n        this.JoyStick.stickMove(e, this.Point)\n        this.currentPos = this.JoyStick.pos;\n        this.initPos = new Vec3(this.currentPos.x - 1, this.currentPos.y, 0);\n        this.Point.setPosition(this.currentPos);\n        this.handleCheckCollideRoboPoint();\n    }\n\n\n    private onHideMaskTouchEnd(): void {\n        this.isTouch = false;\n\n        let result = this.isDoneMerge.find((status) => {\n            return status === false;\n        });\n\n        if (String(result) === \"false\") {\n            this.mergeFail();\n        } else {\n            this.mergeSuccess();\n        }\n    }\n\n\n\n    private handleCheckCollideRoboPoint(): void {\n        this.PointRobos.forEach((point, index) => {\n            if (point.getComponent(UITransform).getBoundingBox().intersects(this.Point.getComponent(UITransform).getBoundingBox())) {\n                this.handleCancelCallBack(index);\n            }\n        })\n    }\n\n\n    private handleCancelCallBack(index: number): void {\n        if (this.isDoneMerge[index]) {\n            return;\n        }\n\n        this.isDoneMerge[index] = true;\n        this.Lines[index].active = true;\n        this.SmallUnitMerge[index].getComponent(SkeletalAnimation).play(\"dancing\");\n    }\n\n\n    private mergeSuccess(): void {\n        if (this.isMerged) {\n            this.text.active = false;\n            this.line_white.active = false;\n            this.CharacterControl.isRun = true;\n            this.RangerControls.forEach(component => {\n                component.isRun = true;\n            });\n\n            // this.HideMask.off(Node.EventType.TOUCH_START);\n            this.HideMask.off(Node.EventType.TOUCH_MOVE);\n            return;\n        }\n\n        this.Camera.getComponent(Animation).play(\"CameraAnim\");\n        this.Lines.forEach(line => line.active = false);\n        this.text_90Per.active = false;\n\n        this.scheduleOnce(() => {\n            this.FX_Merge.play();\n            this.FX_Merge.loop = true;\n        }, 1);\n\n        this.scheduleOnce(() => {\n            this.isMerged = true;\n            this.node.getComponent(Animation).stop();\n            this.MergeUnit.active = true;\n            this.hand.active = false;\n            this.node.getComponent(Animation).play(\"UI_MergeAnim\");\n            this.scheduleOnce(() => {\n                this.FX_Merge.loop = false;\n                this.SmallUnitMerge.forEach(ranger => {\n                    ranger.active = false;\n                });\n                this.AudioManager.mergeSound.play();\n            }, 0.2);\n\n            this.scheduleOnce(() => {\n                this.text.active = true;\n                this.text.getComponent(Animation).play(\"Blink\");\n            }, 1);\n        }, 2)\n    }\n\n\n    private mergeFail(): void {\n        this.isDoneMerge[0] = false;\n        this.isDoneMerge[1] = false;\n        this.isDoneMerge[2] = false;\n        this.isDoneMerge[3] = false;\n        this.isDoneMerge[4] = false;\n        this.isDoneMerge[5] = false;\n        this.isDoneMerge[6] = false;\n        this.isDoneMerge[7] = false;\n\n        this.Lines.forEach(line => line.active = false);\n        this.SmallUnitMerge.forEach(unit => unit.getComponent(SkeletalAnimation).play(\"idle\"))\n    }\n\n\n    private handleEndGame(): void {\n        this.TryAgain.active = true;\n        this.TryAgain.getComponent(Animation).play(\"TryAgain_Anim\");\n\n        // others\n        this.TryAgain.on(Node.EventType.TOUCH_START, () => {\n            console.log(\"install\");\n            this.AudioManager.bgSound.stop();\n            this.GameController.installHandle();\n        })\n\n        // mtg && applovin\n        // this.HideMask.on(Node.EventType.TOUCH_START, () => {\n        //     console.log(\"install\");\n        //     this.AudioManager.bgSound.stop();\n        //     this.GameController.installHandle();\n        // });\n    }\n\n\n    protected update(dt: number): void {\n        if (this.CharacterControl.isFight && !this.isFighting) this.handleFight();\n    }\n}\n"]}