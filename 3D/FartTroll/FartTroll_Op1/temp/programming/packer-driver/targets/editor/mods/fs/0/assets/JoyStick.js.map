{"version":3,"sources":["file:///D:/Cocos2dx/CatEscape_OP1/assets/JoyStick.ts"],"names":["_decorator","Component","Node","screen","view","ccclass","property","JoyStick","start","console","log","node","position","onLoad","on","cc","EventType","TOUCH_START","stickStart","TOUCH_MOVE","stickMove","TOUCH_CANCEL","stickEnd","TOUCH_END","event","getUILocation","pos","convertToLocalLocation","stick","setPosition","value","width","getFrameSize","height","screenX","windowSize","screenY","localX","x","localY","y","result","Vec3"],"mappings":";;;;;;;;;;;;;;;;AACEA,MAAAA,U,OAAAA,U;AACAC,MAAAA,S,OAAAA,S;AACAC,MAAAA,I,OAAAA,I;AAIAC,MAAAA,M,OAAAA,M;AAIAC,MAAAA,I,OAAAA,I;;;;;;;OAGI;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;0BAGjBO,Q,WADZF,OAAO,CAAC,UAAD,C,UAELC,QAAQ,CAACJ,IAAD,C,oCAFX,MACaK,QADb,SAC8BN,SAD9B,CACwC;AAAA;AAAA;;AAAA;AAAA;;AAItCO,QAAAA,KAAK,GAAG;AACNC,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKC,IAAL,CAAUC,QAAtB;AACD;;AACDC,QAAAA,MAAM,GAAG;AACP,eAAKF,IAAL,CAAUG,EAAV,CAAaC,EAAE,CAACb,IAAH,CAAQc,SAAR,CAAkBC,WAA/B,EAA4C,KAAKC,UAAjD,EAA6D,IAA7D;AACA,eAAKP,IAAL,CAAUG,EAAV,CAAaC,EAAE,CAACb,IAAH,CAAQc,SAAR,CAAkBG,UAA/B,EAA2C,KAAKC,SAAhD,EAA2D,IAA3D;AACA,eAAKT,IAAL,CAAUG,EAAV,CAAaC,EAAE,CAACb,IAAH,CAAQc,SAAR,CAAkBK,YAA/B,EAA6C,KAAKC,QAAlD,EAA4D,IAA5D;AACA,eAAKX,IAAL,CAAUG,EAAV,CAAaC,EAAE,CAACb,IAAH,CAAQc,SAAR,CAAkBO,SAA/B,EAA0C,KAAKD,QAA/C,EAAyD,IAAzD;AACD;;AAEOJ,QAAAA,UAAU,CAACM,KAAD,EAAoB;AACpC,gBAAMrB,MAAM,GAAGqB,KAAK,CAACC,aAAN,EAAf;AACA,gBAAMC,GAAG,GAAG,KAAKC,sBAAL,CAA4BxB,MAA5B,CAAZ;AACA,eAAKyB,KAAL,CAAWC,WAAX,CAAuBH,GAAvB;AACD;;AAEON,QAAAA,SAAS,CAACI,KAAD,EAAoB;AACnCf,UAAAA,OAAO,CAACC,GAAR,CAAYc,KAAK,CAACC,aAAN,EAAZ;AACD;;AAEOH,QAAAA,QAAQ,CAACE,KAAD,EAAkB;AAChC,eAAKb,IAAL,CAAUkB,WAAV,CAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B;AACD;;AAEOF,QAAAA,sBAAsB,CAACG,KAAD,EAAc;AAC1C,gBAAMC,KAAK,GAAG3B,IAAI,CAAC4B,YAAL,GAAoBD,KAAlC;AACA,gBAAME,MAAM,GAAG7B,IAAI,CAAC4B,YAAL,GAAoBC,MAAnC;AACA,gBAAMC,OAAO,GAAG/B,MAAM,CAACgC,UAAP,CAAkBJ,KAAlC;AACA,gBAAMK,OAAO,GAAGjC,MAAM,CAACgC,UAAP,CAAkBF,MAAlC;AACA,gBAAMI,MAAc,GAAIP,KAAK,CAACQ,CAAN,GAAUP,KAAX,GAAoBG,OAApB,GAA8BH,KAAK,GAAG,CAA7D;AACA,gBAAMQ,MAAc,GAAIT,KAAK,CAACU,CAAN,GAAUP,MAAX,GAAqBG,OAArB,GAA+BH,MAAM,GAAG,CAA/D;AACA,gBAAMQ,MAAM,GAAG,IAAI1B,EAAE,CAAC2B,IAAP,CAAYL,MAAZ,EAAoBE,MAApB,EAA4B,CAA5B,CAAf;AACA,iBAAOE,MAAP;AACD;;AArCqC,O;;;;;iBAErB,I","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  UITransform,\n  v3,\n  Vec2,\n  screen,\n  Touch,\n  EventTouch,\n  v2,\n  view,\n  Vec3,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"JoyStick\")\nexport class JoyStick extends Component {\n  @property(Node)\n  stick: cc.Node = null;\n\n  start() {\n    console.log(this.node.position);\n  }\n  onLoad() {\n    this.node.on(cc.Node.EventType.TOUCH_START, this.stickStart, this);\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.stickMove, this);\n    this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.stickEnd, this);\n    this.node.on(cc.Node.EventType.TOUCH_END, this.stickEnd, this);\n  }\n\n  private stickStart(event: EventTouch) {\n    const screen = event.getUILocation();\n    const pos = this.convertToLocalLocation(screen);\n    this.stick.setPosition(pos);\n  }\n\n  private stickMove(event: EventTouch) {\n    console.log(event.getUILocation());\n  }\n\n  private stickEnd(event: cc.Touch) {\n    this.node.setPosition(0, 0, 0);\n  }\n\n  private convertToLocalLocation(value: Vec2) {\n    const width = view.getFrameSize().width;\n    const height = view.getFrameSize().height;\n    const screenX = screen.windowSize.width;\n    const screenY = screen.windowSize.height;\n    const localX: number = (value.x * width) / screenX - width / 2;\n    const localY: number = (value.y * height) / screenY - height / 2;\n    const result = new cc.Vec3(localX, localY, 0);\n    return result;\n  }\n}\n"]}