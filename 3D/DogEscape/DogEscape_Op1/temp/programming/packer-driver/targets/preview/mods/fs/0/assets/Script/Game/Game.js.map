{"version":3,"sources":["file:///D:/PA_2024/3D/DogEscape/DogEscape_Op1/assets/Script/Game/Game.ts"],"names":["_decorator","Component","Node","Vec3","CCFloat","v3","screen","Animation","director","GameController","JoyStick","Constants","AudioManager","ccclass","property","Game","start","reset","playSound","SoundTrack","bgSound","Cat","active","canvas2D","text","navigate","on","EventType","TOUCH_START","managerScene","isCollideDoor","laser","wallLaser","isEatFood","isWinGame","HideMask","installHandle","countDown","isTouch","isCatched","isCatLive","handleCountingTime","countingTime","isRing","timeline","setScale","clockSound","ironSource","isEndGame","EndGame","bool","CTA","getComponent","play","title","icon","JoyStickComponent","fakeBg","scheduleOnce","loadScene","winSound","CTA_Download","CTA_tryBtn","loseSound","stopSound","catAngrySound","handleIronSourceSound","e","step","pos","getUILocation","localPos","x","y","node","setPosition","stick","handleMuteSoundIronSource","State","parseInt","localStorage","getItem","SoundState","stopAllSound","update","deltaTime","responsive","windowSize","width","height","camera","_realHeight","_realWidth"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  Vec3,\n  CCFloat,\n  v3,\n  EventTouch,\n  screen,\n  Animation,\n  director,\n} from \"cc\";\nimport { GameController } from \"./GameController\";\nimport { JoyStick } from \"./JoyStick\";\nimport { Constants } from \"../Data/Constant\";\nimport AudioManager from \"../Plugin/AudioManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"Game\")\nexport class Game extends Component {\n\n\n  // component\n  @property(JoyStick)\n  JoyStickComponent: JoyStick = null;\n  @property(GameController)\n  GameController: GameController = null;\n  @property(AudioManager)\n  AudioManager: AudioManager = null;\n\n  //3D\n  @property(Node)\n  Cat: Node = null;\n\n  // 2D\n  @property(Node)\n  canvas2D: Node;\n  @property(Node)\n  icon: Node;\n  @property(Node)\n  navigate: Node;\n  @property(Node)\n  text: Node;\n  @property(Node)\n  title: Node;\n  @property(Node)\n  joyStick: Node;\n  @property(Node)\n  camera: Node = null;\n  @property\n  step: number = 1;\n\n\n  @property(Node)\n  HideMask: Node = null;\n  @property(Node)\n  CTA: Node = null;\n  @property(Node)\n  CTA_tryBtn: Node;\n  @property(Node)\n  CTA_Download: Node;\n\n\n  @property(CCFloat)\n  _realHeight: number = null;\n  @property(CCFloat)\n  _realWidth: number = null;\n\n  // state\n  meowSoundState: number = null;\n\n  // ironsource\n  ironSourceState: number = 1;\n  ironSourceSoundState: boolean = true;\n  isEndGame: boolean = false;\n  endGame: boolean = false;\n\n  start() {\n    this.reset();\n    this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n    // this.AudioManager.playSound(Constants.SoundTrack.catAngrySound);\n\n    this.Cat.active = true;\n    this.canvas2D.active = true;\n    this.text.active = true;\n    this.navigate.active = true;\n\n    this.canvas2D.on(Node.EventType.TOUCH_START, this.managerScene, this);\n  }\n\n\n  private reset(): void {\n    Constants.isCollideDoor = false;\n    Constants.laser = false;\n    Constants.wallLaser = true;\n    Constants.isEatFood = false;\n\n    // mtg & applovin\n    Constants.isWinGame && this.HideMask.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n  }\n\n\n  public countDown(): void {\n    if (Constants.isTouch || Constants.isCatched || !Constants.isCatLive) {\n      return;\n    }\n\n    // this.scheduleOnce(() => {\n    //   if (Constants.ironSource.isEndGame) {\n    //     return;\n    //   }\n    //   this.EndGame(false);\n    // }, 10);\n  }\n\n\n  private handleCountingTime(): void {\n    if (Constants.countingTime < 0 && Constants.isRing) {\n      this.timeline.setScale(0, 1, 1);\n      return;\n    }\n\n\n    if (Constants.countingTime < 0.5 && !Constants.isRing) {\n      this.AudioManager.playSound(Constants.SoundTrack.clockSound);\n      Constants.isRing = true;\n    }\n\n    if (!Constants.ironSource.isEndGame) {\n      Constants.countingTime -= 0.0017;\n\n      this.timeline.setScale(Constants.countingTime, 1, 1);\n    }\n  }\n\n\n  public EndGame(bool: boolean): void {\n    // Constants.ironSource.isEndGame = true;\n    this.CTA.getComponent(Animation).play(\"CTA_Anim\");\n    this.title.active = false;\n    this.icon.active = false;\n\n\n    if (bool) {\n      this.JoyStickComponent.fakeBg.getComponent(Animation).play();\n      this.scheduleOnce(() => { director.loadScene(\"CatScene2\") }, 1.5)\n      Constants.isWinGame = true;\n      // this.CTA_tryBtn.active = false;\n      // this.CTA_Download.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n      this.AudioManager.playSound(Constants.SoundTrack.winSound);\n    } else {\n      this.CTA_Download.active = false;\n      this.CTA_tryBtn.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n      this.AudioManager.playSound(Constants.SoundTrack.loseSound);\n      this.AudioManager.stopSound(Constants.SoundTrack.catAngrySound);\n\n      // mtg & applovin\n      this.HideMask.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n    }\n  }\n\n\n  private handleIronSourceSound(): void {\n    // if (this.isPlayBgSound) {\n    //   return;\n    // }\n\n    // if (this.ironSourceSoundState) {\n    //   this.catSound.setLoop(true);\n    //   this.catSound.play();\n    //   this.bg.setLoop(true);\n    //   this.bg.play();\n    // }\n\n    // this.isPlayBgSound = true;\n  }\n\n\n  managerScene(e: EventTouch) {\n    this.step++;\n    if (this.step === 2) {\n      let pos = e.getUILocation();\n      let localPos = new Vec3(pos.x - 160, pos.y - 240, 0);\n\n      // if (this.ironSourceSoundState) {\n      //   this.click.play();\n      // }\n\n      this.JoyStickComponent.node.setPosition(localPos);\n      this.JoyStickComponent.stick.setPosition(localPos);\n\n      this.text.active = false;\n      this.navigate.active = false;\n    }\n  }\n\n\n  private handleMuteSoundIronSource(): void {\n    Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n    if (Constants.ironSource.State) {\n      if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n        Constants.ironSource.SoundState = true;\n        this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n      }\n\n      if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n        Constants.ironSource.SoundState = false;\n        this.AudioManager.stopAllSound();\n      }\n    }\n  }\n\n\n  update(deltaTime: number) {\n    this.responsive();\n    // Constants.isTouch && !Constants.ironSource.isEndGame && this.handleCountingTime();\n    // this.handleMuteSoundIronSource();\n  }\n\n\n  private responsive(): void {\n    if (screen.windowSize.width > screen.windowSize.height) {\n      this.camera.setPosition(v3(-14.8, 24, 0));\n      this._realHeight = 480;\n      this._realWidth =\n        320 * (screen.windowSize.width / screen.windowSize.height);\n      // console.log(this._realWidth);\n      this.icon.setPosition((this._realWidth - 320) / 2 + 160, 0, 0);\n      this.title.setPosition((320 - this._realWidth) / 2 - 160, 0, 0);\n\n      this.icon.setScale(0.9, 0.9, 0.9);\n      this.title.setScale(0.35, 0.35, 0.35);\n    } else {\n      this.camera.setPosition(v3(-13, 24, 0));\n      if (screen.windowSize.height / screen.windowSize.width < 1.4) {\n        this._realWidth = 370;\n      } else {\n        this._realWidth = 320;\n      }\n      this._realHeight =\n        this._realWidth *\n        (screen.windowSize.height / screen.windowSize.width);\n\n      // this.title.y = (this._realHeight - 480) / 2 + 207;\n      // this.icon.y = (this._realHeight - 480) / 2 + 207;\n\n      this.icon.setPosition(56, 207 + (this._realHeight - 480) / 2, 0);\n      this.title.setPosition(-40, 207 + (this._realHeight - 480) / 2, 0);\n      this.icon.setScale(0.25, 0.25, 0.25);\n      this.title.setScale(0.2, 0.2, 0.2);\n    }\n  }\n}\n"]}