{"version":3,"sources":["file:///D:/PA_2024/3D/FishIO/FishIO_Op11/assets/Script/Game/GamePlay.ts"],"names":["_decorator","Component","Node","Vec2","VideoPlayer","GameController","AudioManager","Constants","UIController","ccclass","property","GamePlay","onLoad","CTA","active","start","isCanClick","handleVideo","registerEvent","Btn_Left","on","EventType","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","registerEventForBtnRight","Btn_Right","touchMoveWithBtnRight","offEvent","off","playSound","SoundTrack","bgSound","video","node","READY_TO_PLAY","initVideo","COMPLETED","endVideo","e","pos","getLocation","y","currentPos","playing","play","countingTimeVideo","console","log","swtichGameToBtnRight","isDoneLeftBtn","currentPos2","countingTimeVideoWithRightBtn","pause","pauseSound","scheduleOnce","handleMuteSoundIronSource","ironSource","State","parseInt","localStorage","getItem","SoundState","isEndGame","stopAllSound","volume","background","stayOnBottom","CTA_btn","TOUCH_START","installHandle","CTA_overlay","handleInstall","btn_accept","btn_decline","handleIronSourcePlaySound","isPlayBgSound","iphoneSound","switchVolume","update","dt"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Component, EventTouch, Node, PhysicsSystem, SkeletalAnimation, Vec2, Vec3, ParticleSystem, log, sp, view, UITransform, Label, Sprite, VideoPlayer, director, Button, ParticleSystem2D } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { GameController } from './GameController';\nimport { AudioManager } from './AudioManager';\nimport { Constants } from '../Data/constants';\nimport { UIController } from './UIController';\n\n@ccclass('GamePlay')\nexport class GamePlay extends Component {\n    // Component\n    @property(UIController)\n    UIController: UIController = null;\n    @property(GameController)\n    GameController: GameController = null;\n    @property(AudioManager)\n    AudioManager: AudioManager = null;\n\n    @property(Node)\n    background: Node = null;\n    @property(VideoPlayer)\n    video: VideoPlayer = null;\n    @property(Node)\n    HideMask: Node = null;\n\n\n    @property(Node)\n    CTA: Node = null;\n    @property(Node)\n    CTA_overlay: Node = null;\n    @property(Node)\n    CTA_icon: Node = null;\n    @property(Node)\n    CTA_logo: Node = null;\n    @property(Node)\n    CTA_btn: Node = null;\n\n\n    @property(Node)\n    layer: Node = null;\n\n    // state\n    currentPos: Vec2 = new Vec2(0, 0);\n    currentPos2: Vec2 = new Vec2(0, 0);\n    countingTimeVideo: number = 0;\n    countingTimeVideoWithRightBtn: number = 0;\n    isDoneLeftBtn: boolean = false;\n\n\n    protected onLoad(): void {\n        this.CTA.active = false;\n    }\n\n\n    protected start(): void {\n        Constants.isCanClick = true;\n        this.handleVideo();\n\n\n        // use if build ironSource\n        // this.background.active = false;\n        // this.video.stayOnBottom = true;\n        // this.AudioManager.bgSound.volume = 0;\n        // this.HideMask.on(Node.EventType.TOUCH_START, () => {\n        //     this.AudioManager.bgSound.volume = 1;\n        // }, this);\n        // ------------------\n    }\n\n\n    private registerEvent(): void {\n        this.UIController.Btn_Left.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\n        this.UIController.Btn_Left.on(Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.UIController.Btn_Left.on(Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\n    }\n\n\n    private registerEventForBtnRight(): void {\n        this.UIController.Btn_Right.on(Node.EventType.TOUCH_MOVE, this.touchMoveWithBtnRight, this);\n        this.UIController.Btn_Right.on(Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.UIController.Btn_Right.on(Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\n    }\n\n\n    private offEvent(): void {\n        this.UIController.Btn_Left.off(Node.EventType.TOUCH_MOVE);\n        this.UIController.Btn_Left.off(Node.EventType.TOUCH_END);\n        this.UIController.Btn_Left.off(Node.EventType.TOUCH_CANCEL);\n\n        this.UIController.Btn_Right.off(Node.EventType.TOUCH_MOVE);\n        this.UIController.Btn_Right.off(Node.EventType.TOUCH_END);\n        this.UIController.Btn_Right.off(Node.EventType.TOUCH_CANCEL);\n    }\n\n\n    private handleVideo(): void {\n        this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        this.video.node.on(VideoPlayer.EventType.READY_TO_PLAY, this.initVideo, this);\n        this.video.node.on(VideoPlayer.EventType.COMPLETED, this.endVideo, this);\n\n        // this.scheduleOnce(() => {\n        //     this.AudioManager.pauseSound(Constants.SoundTrack.bgSound);\n        //     this.video.pause();\n        //     this.registerEvent();\n        // }, 3.5);\n    }\n\n\n    private touchMove(e: EventTouch): void {\n        if (!Constants.isCanClick) {\n            return;\n        }\n\n        let pos = e.getLocation();\n        if (pos.y > this.currentPos.y) {\n            !this.AudioManager.bgSound.playing && this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n            this.video.play();\n            this.countingTimeVideo += 0.1;\n            if (this.countingTimeVideo >= 2.5) {\n                console.log(\"off ----------------------------\");\n                this.swtichGameToBtnRight();\n                this.offEvent();\n                this.isDoneLeftBtn = true;\n            }\n        }\n\n        this.currentPos = pos;\n    }\n\n\n    private touchMoveWithBtnRight(e: EventTouch): void {\n        if (!Constants.isCanClick) {\n            return;\n        }\n\n        let pos = e.getLocation();\n        if (pos.y > this.currentPos2.y) {\n            !this.AudioManager.bgSound.playing && this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n            this.video.play();\n            this.countingTimeVideoWithRightBtn += 0.1;\n            if (this.countingTimeVideoWithRightBtn >= 2.5) {\n                console.log(\"off ----------------------------\");\n                this.offEvent();\n            }\n        }\n\n        this.currentPos2 = pos;\n    }\n\n\n    private touchEnd(): void {\n        this.video.pause();\n        this.AudioManager.pauseSound(Constants.SoundTrack.bgSound);\n    }\n\n\n    private swtichGameToBtnRight(): void {\n        this.scheduleOnce(() => {\n            this.registerEventForBtnRight();\n            this.video.pause();\n            this.AudioManager.pauseSound(Constants.SoundTrack.bgSound);\n        }, 3.5)\n    }\n\n\n    private handleMuteSoundIronSource(): void {\n        Constants.ironSource.State = parseInt(localStorage.getItem(\"cocosSoundState\"), 10)\n\n        if (Constants.ironSource.State) {\n            if (Constants.ironSource.State === 1 && !Constants.ironSource.SoundState && !Constants.ironSource.isEndGame) {\n                Constants.ironSource.SoundState = true;\n            }\n\n            if (Constants.ironSource.State === 2 && Constants.ironSource.SoundState) {\n                Constants.ironSource.SoundState = false;\n                this.AudioManager.stopAllSound();\n            }\n        }\n    }\n\n\n    private initVideo(video: VideoPlayer) {\n        video.play();\n        video.volume = 0;\n    }\n\n\n    private endVideo(): void {\n        this.CTA.active = true;\n        this.background.active = false;\n        this.video.stayOnBottom = true;\n        this.CTA_btn.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n\n        // mtg & applovin\n        this.CTA_overlay.on(Node.EventType.TOUCH_START, this.GameController.installHandle, this);\n    }\n\n\n    private handleInstall(): void {\n        this.btn_accept.off(Node.EventType.TOUCH_START);\n        this.btn_decline.off(Node.EventType.TOUCH_START);\n        this.GameController.installHandle();\n    }\n\n\n    public handleIronSourcePlaySound(): void {\n        if (Constants.ironSource.isPlayBgSound) {\n            return;\n        }\n\n        if (Constants.ironSource.SoundState) {\n            this.AudioManager.playSound(Constants.SoundTrack.iphoneSound);\n            this.AudioManager.switchVolume(Constants.SoundTrack.iphoneSound, 0.7);\n        }\n\n        Constants.ironSource.isPlayBgSound = true;\n    }\n\n\n    protected update(dt: number): void {\n        // ironsource\n        // this.handleMuteSoundIronSource();\n    }\n}\n"]}