{"version":3,"sources":["file:///D:/PA_2024/3D/FishIO/FishIO_Op7/assets/scripts/Controller/GameController.ts"],"names":["_decorator","Animation","Component","director","Node","Constants","AudioManager","ccclass","property","GameController","start","window","gameReady","GamePlay","active","CanvasUI","startGame","flagVideo","Env_Overlay","getComponent","play","playSound","SoundTrack","bgSound","scheduleOnce","whooseSound","volume","flagReplay","bg_Horizontal","installHandle","console","log","ironSource","isEndGame","stopAllSound","gameEnd","playableSDK","openAppStore","ExitApi","exit","dapi","openStoreUrl","mraid","cc","sys","os","OS_ANDROID","ANDROID","open","OS_IOS","IPHONE","IPAD","install","update","dt","isCompleteVideo","forceReplay","isTouching","isPlayGame","loadScene"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Component, director, EPhysics2DDrawFlags, log, Node, physics, PhysicsSystem2D } from 'cc';\nimport { Constants } from '../Data/Constant';\nimport { AudioManager } from './AudioManager';\nconst { ccclass, property } = _decorator;\n\n\n@ccclass('GameController')\nexport class GameController extends Component {\n    @property(AudioManager)\n    AudioManager: AudioManager = null;\n    @property(Node)\n    Env_Overlay: Node = null;\n    @property(Node)\n    GamePlay: Node = null;\n    @property(Node)\n    CanvasUI: Node = null;\n    @property(Node)\n    bg_Horizontal: Node = null;\n\n    // state\n    flagVideo: boolean = false;\n    flagReplay: boolean = false;\n\n\n    protected start(): void {\n        window.gameReady && window.gameReady();\n        this.GamePlay.active = false;\n        this.CanvasUI.active = false;\n\n        // PhysicsSystem2D.instance.enable = true;\n        // PhysicsSystem2D.instance.debugDrawFlags = EPhysics2DDrawFlags.Shape;\n\n        // if(Constants.forceReplay) {\n        //     this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        // }\n    }\n\n\n    private startGame(): void {\n        this.flagVideo = true;\n        this.Env_Overlay.getComponent(Animation).play(\"Environment_OverlayAnim\");\n        this.AudioManager.playSound(Constants.SoundTrack.bgSound);\n        this.scheduleOnce(() => {\n            this.AudioManager.playSound(Constants.SoundTrack.whooseSound);\n            this.AudioManager.whooseSound.volume = 1.2;\n        }, 0.4);\n\n        this.scheduleOnce(() => {\n            this.GamePlay.active = true;\n            this.CanvasUI.active = true;\n        }, 0.6);\n\n        if(Constants.flagReplay) {\n            this.bg_Horizontal.active = false;\n        } else {\n            this.scheduleOnce(() => {\n                this.bg_Horizontal.active = false;\n            }, 1);\n        }\n    }\n\n\n    public installHandle(): void {\n        console.log(\"install\");\n        Constants.ironSource.isEndGame = true;\n        this.AudioManager.stopAllSound();\n\n        window.gameEnd && window.gameEnd();\n        //If ad network is tiktok\n        if (typeof (playableSDK) != \"undefined\") {\n            window.playableSDK.openAppStore();\n            return;\n        }\n\n        // If ad network is google ads\n        if (typeof (ExitApi) != \"undefined\") {\n            ExitApi.exit();\n            return;\n        }\n\n        // If ad netwrok is ironsources\n        if (typeof (dapi) != \"undefined\") {\n            dapi.openStoreUrl();\n            return;\n        }\n\n        // If ad network support MRAID 2.0\n        if (typeof (mraid) != \"undefined\") {\n            if (cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.ANDROID) {\n                mraid.open(\"https://play.google.com/store/apps/details?id=com.fishio.hungryfish\");\n                return;\n            }\n\n            if (cc.sys.os == cc.sys.OS_IOS || cc.sys.os == cc.sys.IPHONE || cc.sys.os == cc.sys.IPAD) {\n                mraid.open(\"https://itunes.apple.com/us/app/id6445980017?mt=8\");\n                return;\n            }\n\n            mraid.open(\"https://play.google.com/store/apps/details?id=com.fishio.hungryfish\");\n            return;\n        }\n        // If ad network is mindwork. window alway avaiable so skip undefined check\n        window.install && window.install();\n    }\n\n\n    protected update(dt: number): void {\n        if (Constants.isCompleteVideo && !this.flagVideo) {\n            this.startGame();\n        }\n\n\n        if(Constants.forceReplay && !Constants.flagReplay) {\n            Constants.isTouching = false;\n            Constants.isPlayGame = false;\n            Constants.flagReplay = true;\n            director.loadScene(\"Game\");\n        }\n\n    }\n}\n"]}